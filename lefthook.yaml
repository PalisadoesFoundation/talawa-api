pre-commit:
  commands:
    1_upgrade_drizzle_metadata:
      run: |
        set -e
        pnpm run upgrade_drizzle_metadata
        git add ./drizzle_migrations
    2_generate_drizzle_migrations:
      run: |
        set -e
        pnpm run generate_drizzle_migrations
        git add ./drizzle_migrations
    3_check_drizzle_migrations:
      run: pnpm run check_drizzle_migrations
    4_generate_graphql_sdl_file:
      run: |
        set -e
        pnpm generate_graphql_sdl_file
        git add ./schema.graphql
    5_generate_gql_tada_files:
      run: |
        set -e
        pnpm generate_gql_tada
        git add ./test/graphql/types/gql.tada-cache.d.ts
    6_check_gql_tada:
      run: pnpm check_gql_tada
    7_fix_code_quality:
      run: |
        set -e
        pnpm format:fix
        git add -- {staged_files}        
        git add docs/

    8_check_type_errors:
      run: pnpm typecheck

    9_check_mock_isolation:
      glob: "test/**/*.{test,spec}.{ts,tsx}"
      run: pnpm run check_mock_isolation {staged_files}

    11_generate_docs:
      run: |
        set -e
        pnpm generate:docs
        git add ./docs/docs/auto-docs/

    12_api_schema_docs:
      run: |
        set -e
        cd docs
        pnpm docusaurus graphql-to-doc
        git add docs/auto-schema

    13_check_biome_disable:
      run: |
        STAGED_FILES=$(git diff --cached --name-only --diff-filter=ACMRT | tr '\n' ' ')
        if [ -n "$STAGED_FILES" ]; then
          python .github/workflows/scripts/biome_disable_check.py --files $STAGED_FILES
        fi
    
    14_check_docstrings:
      run: |
        STAGED_FILES=$(git diff --cached --name-only --diff-filter=ACMRT | tr '\n' ' ')
        if [ -n "$STAGED_FILES" ]; then
          python .github/workflows/scripts/check_docstrings.py --files $STAGED_FILES
        fi
    
    15_check_sanitization_disable:
      run: |
        STAGED_FILES=$(git diff --cached --name-only --diff-filter=ACMRT | tr '\n' ' ')
        if [ -n "$STAGED_FILES" ]; then
          python .github/workflows/scripts/check_sanitization_disable.py --files $STAGED_FILES
        fi
    
    16_check_code_coverage_disable:
      run: |
        STAGED_FILES=$(git diff --cached --name-only --diff-filter=ACMRT | tr '\n' ' ')
        if [ -n "$STAGED_FILES" ]; then
          python .github/workflows/scripts/code_coverage_disable_check.py --files $STAGED_FILES
        fi
    
    17_detect_ts_ignore:
      run: |
        STAGED_FILES=$(git diff --cached --name-only --diff-filter=ACMRT | tr '\n' ' ')
        if [ -n "$STAGED_FILES" ]; then
          python .github/workflows/scripts/detect_ts_ignore.py --files $STAGED_FILES
        fi
    
    18_check_itskip_disable:
      run: |
        STAGED_FILES=$(git diff --cached --name-only --diff-filter=ACMRT | tr '\n' ' ')
        if [ -n "$STAGED_FILES" ]; then
          python .github/workflows/scripts/itskip_disable_check.py --files $STAGED_FILES
        fi
    
  piped: true