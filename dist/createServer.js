import fastifyCors from"@fastify/cors";import fastifyHelmet from"@fastify/helmet";import{fastifyJwt}from"@fastify/jwt";import fastifyRateLimit from"@fastify/rate-limit";import envSchema from"env-schema";import Fastify from"fastify";import{envConfigSchema,envSchemaAjv}from"./envConfigSchema.js";import plugins from"./plugins/index.js";import routes from"./routes/index.js";export const createServer=async options=>{const envConfig=envSchema({ajv:envSchemaAjv,dotenv:true,schema:envConfigSchema});Object.assign(envConfig,options?.envConfig);const fastify=Fastify({bodyLimit:0x3200000,logger:{level:envConfig.API_LOG_LEVEL,transport:envConfig.API_IS_PINO_PRETTY?{target:"pino-pretty"}:undefined}}).withTypeProvider();fastify.decorate("envConfig",envConfig);fastify.register(fastifyRateLimit,{});fastify.register(fastifyCors,{});fastify.register(fastifyHelmet,{contentSecurityPolicy:!fastify.envConfig.API_IS_GRAPHIQL});fastify.register(fastifyJwt,{secret:fastify.envConfig.API_JWT_SECRET});fastify.register(plugins,{});fastify.register(routes,{});return fastify};