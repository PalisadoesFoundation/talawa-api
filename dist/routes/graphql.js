import fastifyPlugin from"fastify-plugin";import{mercurius}from"mercurius";import{schema}from"../graphql/schema/index.js";export const createContext=async({drizzleClient})=>{return{drizzleClient}};export const graphql=fastifyPlugin(async fastify=>{fastify.register(mercurius,{context:(request,reply)=>createContext({drizzleClient:fastify.drizzleClient,isSubscription:false,log:fastify.log,request,reply}),graphiql:{enabled:fastify.envConfig.API_IS_GRAPHIQL},path:"/graphql",schema,subscription:{context:async(socket,request)=>await createContext({drizzleClient:fastify.drizzleClient,isSubscription:true,log:fastify.log,request,socket}),keepAlive:1e3*30,onConnect:data=>{return true},onDisconnect:ctx=>{},verifyClient:(info,next)=>{next(true)}}})});export default graphql;