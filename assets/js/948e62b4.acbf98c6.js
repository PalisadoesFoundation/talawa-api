"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[37887],{21828:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>h,frontMatter:()=>c,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"docs/developer-resources/best-practices/performance-monitoring","title":"Performance Monitoring","description":"Talawa API includes built-in performance monitoring to help DevOps teams track request-level performance metrics.","source":"@site/docs/docs/developer-resources/best-practices/performance-monitoring.md","sourceDirName":"docs/developer-resources/best-practices","slug":"/developer-resources/performance-monitoring","permalink":"/docs/developer-resources/performance-monitoring","draft":false,"unlisted":false,"editUrl":"https://github.com/PalisadoesFoundation/talawa-api/edit/develop/docs/docs/docs/developer-resources/best-practices/performance-monitoring.md","tags":[],"version":"current","sidebarPosition":60,"frontMatter":{"id":"performance-monitoring","title":"Performance Monitoring","slug":"/developer-resources/performance-monitoring","sidebar_position":60},"sidebar":"tutorialSidebar","previous":{"title":"Rate Limiting","permalink":"/docs/developer-resources/rate-limiting"},"next":{"title":"Error Handling Guide","permalink":"/docs/developer-resources/error-handling-guide"}}');var i=r(86070),t=r(55288);const c={id:"performance-monitoring",title:"Performance Monitoring",slug:"/developer-resources/performance-monitoring",sidebar_position:60},o="Performance Monitoring and Observability",l={},d=[{value:"Overview",id:"overview",level:2},{value:"How to Access Performance Monitoring",id:"how-to-access-performance-monitoring",level:2},{value:"Server-Timing Headers (Automatic)",id:"server-timing-headers-automatic",level:3},{value:"<code>/metrics/perf</code> Endpoint (API)",id:"metricsperf-endpoint-api",level:3},{value:"Programmatic Access (In Code)",id:"programmatic-access-in-code",level:3},{value:"Performance Metrics Reference",id:"performance-metrics-reference",level:2},{value:"Interpreting Metrics",id:"interpreting-metrics",level:3},{value:"Server-Timing Headers",id:"server-timing-headers",level:2},{value:"Header Components",id:"header-components",level:3},{value:"Viewing in Browser DevTools",id:"viewing-in-browser-devtools",level:3},{value:"<code>/metrics/perf</code> Endpoint",id:"metricsperf-endpoint",level:2},{value:"Accessing Metrics",id:"accessing-metrics",level:3},{value:"Response Schema",id:"response-schema",level:3},{value:"Retention",id:"retention",level:3},{value:"Integration Examples",id:"integration-examples",level:2},{value:"Monitoring Dashboard",id:"monitoring-dashboard",level:3},{value:"APM Tool Integration",id:"apm-tool-integration",level:3},{value:"Custom Alerting",id:"custom-alerting",level:3},{value:"Production Considerations",id:"production-considerations",level:2},{value:"Security",id:"security",level:3},{value:"Performance Impact",id:"performance-impact",level:3},{value:"Privacy",id:"privacy",level:3},{value:"Extending Performance Tracking",id:"extending-performance-tracking",level:2},{value:"Custom Operations",id:"custom-operations",level:3},{value:"Manual Timing",id:"manual-timing",level:3},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Metrics Not Appearing",id:"metrics-not-appearing",level:3},{value:"Endpoint Returns Empty Array",id:"endpoint-returns-empty-array",level:3},{value:"High <code>totalMs</code> Values",id:"high-totalms-values",level:3},{value:"Further Reading",id:"further-reading",level:2}];function a(e){const n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"performance-monitoring-and-observability",children:"Performance Monitoring and Observability"})}),"\n",(0,i.jsx)(n.p,{children:"Talawa API includes built-in performance monitoring to help DevOps teams track request-level performance metrics."}),"\n",(0,i.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,i.jsx)(n.p,{children:"The Performance Metrics Foundation provides:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Server-Timing headers"})," on all HTTP responses for browser-based performance analysis"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsxs)(n.strong,{children:[(0,i.jsx)(n.code,{children:"/metrics/perf"})," endpoint"]})," returning recent performance snapshots for monitoring dashboards"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Request-scoped tracking"})," of database operations, cache hits/misses, and total request duration"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"how-to-access-performance-monitoring",children:"How to Access Performance Monitoring"}),"\n",(0,i.jsx)(n.p,{children:"Performance monitoring is automatically enabled for all HTTP requests. There are three main ways to access performance metrics:"}),"\n",(0,i.jsx)(n.h3,{id:"server-timing-headers-automatic",children:"Server-Timing Headers (Automatic)"}),"\n",(0,i.jsxs)(n.p,{children:["Every HTTP response includes a ",(0,i.jsx)(n.code,{children:"Server-Timing"})," header with performance metrics. No configuration needed - it's automatically added to all responses."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Access via Browser DevTools:"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Open your browser's ",(0,i.jsx)(n.strong,{children:"Developer Tools"})," (F12 or right-click \u2192 Inspect)"]}),"\n",(0,i.jsxs)(n.li,{children:["Navigate to the ",(0,i.jsx)(n.strong,{children:"Network"})," tab"]}),"\n",(0,i.jsx)(n.li,{children:"Make any API request to your Talawa API server"}),"\n",(0,i.jsx)(n.li,{children:"Click on the request in the Network tab"}),"\n",(0,i.jsxs)(n.li,{children:["View the ",(0,i.jsx)(n.strong,{children:"Timing"})," or ",(0,i.jsx)(n.strong,{children:"Headers"})," section to see the ",(0,i.jsx)(n.code,{children:"Server-Timing"})," header"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Access via Command Line:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'curl -v http://localhost:4000/graphql\n# Look for the "Server-Timing" header in the response\n'})}),"\n",(0,i.jsxs)(n.h3,{id:"metricsperf-endpoint-api",children:[(0,i.jsx)(n.code,{children:"/metrics/perf"})," Endpoint (API)"]}),"\n",(0,i.jsx)(n.p,{children:"Query the metrics endpoint to retrieve recent performance snapshots programmatically:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"GET http://localhost:4000/metrics/perf\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Example Response:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "recent": [\n    {\n      "totalMs": 127.5,\n      "totalOps": 8,\n      "cacheHits": 12,\n      "cacheMisses": 3,\n      "hitRate": 0.8,\n      "ops": {\n        "db": { "count": 5, "ms": 45.2, "max": 18.3 }\n      },\n      "slow": [\n        { "op": "db", "ms": 18 }\n      ]\n    }\n  ]\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Use Cases:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Monitoring dashboards"}),"\n",(0,i.jsx)(n.li,{children:"Alerting systems"}),"\n",(0,i.jsx)(n.li,{children:"Performance analysis tools"}),"\n",(0,i.jsx)(n.li,{children:"Custom analytics"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"programmatic-access-in-code",children:"Programmatic Access (In Code)"}),"\n",(0,i.jsx)(n.p,{children:"Access the performance tracker directly in your GraphQL resolvers or route handlers:"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"In GraphQL Resolvers:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"export const myResolver = async (parent, args, ctx) => {\n  // Access the performance tracker\n  const perf = ctx.perf;\n  \n  // Get current snapshot\n  const snapshot = perf?.snapshot();\n  console.log(`Total operations: ${snapshot?.totalOps}`);\n  \n  // Track custom operations\n  const result = await perf?.time('custom-operation', async () => {\n    // Your code here\n    return await someAsyncOperation();\n  });\n  \n  return result;\n};\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"In Route Handlers:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"app.get('/my-route', async (req, reply) => {\n  // Access via request object\n  const perf = req.perf;\n  const snapshot = perf?.snapshot();\n  \n  return { metrics: snapshot };\n});\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Available Methods:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"perf.time(name, asyncFn)"})," - Track async operations"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"perf.start(name)"})," - Start manual timing (returns stop function)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"perf.trackDb(ms)"})," - Track database operation duration"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"perf.trackCacheHit()"})," - Record cache hit"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"perf.trackCacheMiss()"})," - Record cache miss"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"perf.trackComplexity(score)"})," - Track GraphQL query complexity"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"perf.snapshot()"})," - Get current performance snapshot"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"performance-metrics-reference",children:"Performance Metrics Reference"}),"\n",(0,i.jsx)(n.p,{children:"The following table explains all available performance metrics and their acceptable ranges:"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Metric"}),(0,i.jsx)(n.th,{children:"Type"}),(0,i.jsx)(n.th,{children:"Description"}),(0,i.jsx)(n.th,{children:"Acceptable Range"}),(0,i.jsx)(n.th,{children:"Notes"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"totalMs"})}),(0,i.jsx)(n.td,{children:"number"}),(0,i.jsx)(n.td,{children:"Total time (milliseconds) spent in all tracked operations during the request"}),(0,i.jsx)(n.td,{children:"< 500ms (good), < 1000ms (acceptable), > 1000ms (needs investigation)"}),(0,i.jsx)(n.td,{children:"Includes database queries, cache operations, and custom tracked operations. Does not include network latency or client processing time."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"totalOps"})}),(0,i.jsx)(n.td,{children:"number"}),(0,i.jsx)(n.td,{children:"Total count of tracked operations (database queries, cache operations, etc.)"}),(0,i.jsx)(n.td,{children:"Varies by endpoint. Simple queries: 1-5. Complex queries: 5-20. > 50 (may indicate N+1 problem)"}),(0,i.jsx)(n.td,{children:"Higher counts may indicate inefficient data fetching patterns. Monitor for sudden increases."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"cacheHits"})}),(0,i.jsx)(n.td,{children:"number"}),(0,i.jsx)(n.td,{children:"Number of successful cache retrievals"}),(0,i.jsx)(n.td,{children:"Higher is better. Target: > 70% of total cache operations"}),(0,i.jsx)(n.td,{children:"Reduces database load and improves response times."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"cacheMisses"})}),(0,i.jsx)(n.td,{children:"number"}),(0,i.jsx)(n.td,{children:"Number of cache lookups that required database queries"}),(0,i.jsx)(n.td,{children:"Lower is better. Target: < 30% of total cache operations"}),(0,i.jsx)(n.td,{children:"High miss rates indicate cache warming issues or short TTLs."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"hitRate"})}),(0,i.jsx)(n.td,{children:"number (0-1)"}),(0,i.jsxs)(n.td,{children:["Cache hit rate: ",(0,i.jsx)(n.code,{children:"cacheHits / (cacheHits + cacheMisses)"})]}),(0,i.jsx)(n.td,{children:"> 0.7 (good), 0.5-0.7 (acceptable), < 0.5 (needs optimization)"}),(0,i.jsx)(n.td,{children:"Calculated automatically. A value of 1.0 means all cache operations were hits."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"ops[name].count"})}),(0,i.jsx)(n.td,{children:"number"}),(0,i.jsx)(n.td,{children:"Number of times a specific operation was called"}),(0,i.jsx)(n.td,{children:"Varies by operation type"}),(0,i.jsx)(n.td,{children:"Track individual operation frequency to identify hotspots."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"ops[name].ms"})}),(0,i.jsx)(n.td,{children:"number"}),(0,i.jsx)(n.td,{children:"Total time (milliseconds) spent in a specific operation"}),(0,i.jsx)(n.td,{children:"Database: < 100ms per operation. Cache: < 10ms per operation"}),(0,i.jsxs)(n.td,{children:["Sum of all durations for this operation type. Divide by ",(0,i.jsx)(n.code,{children:"count"})," for average."]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"ops[name].max"})}),(0,i.jsx)(n.td,{children:"number"}),(0,i.jsx)(n.td,{children:"Maximum duration (milliseconds) for a single operation call"}),(0,i.jsx)(n.td,{children:"Database: < 200ms. Cache: < 50ms"}),(0,i.jsx)(n.td,{children:"Identifies slow outliers that may need optimization."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"slow"})}),(0,i.jsx)(n.td,{children:"Array"}),(0,i.jsx)(n.td,{children:"List of operations that exceeded the slow threshold (default: 200ms)"}),(0,i.jsx)(n.td,{children:"Empty array (ideal), < 5 entries (acceptable), > 10 entries (investigate)"}),(0,i.jsxs)(n.td,{children:["Each entry contains ",(0,i.jsx)(n.code,{children:"{ op: string, ms: number }"}),". Maximum 50 entries retained."]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"complexityScore"})}),(0,i.jsx)(n.td,{children:"number (optional)"}),(0,i.jsx)(n.td,{children:"GraphQL query complexity score"}),(0,i.jsx)(n.td,{children:"< 100 (simple), 100-500 (moderate), 500-1000 (complex), > 1000 (very complex)"}),(0,i.jsx)(n.td,{children:"Only present for GraphQL requests. Higher scores indicate more expensive queries that may need optimization or rate limiting."})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"interpreting-metrics",children:"Interpreting Metrics"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Good Performance Indicators:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"totalMs"})," < 500ms for most requests"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"hitRate"})," > 0.7 (70% cache hit rate)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"slow"})," array is empty or has < 5 entries"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"ops.db.max"})," < 200ms (no slow database queries)"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Warning Signs:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"totalMs"})," consistently > 1000ms"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"hitRate"})," < 0.5 (poor cache efficiency)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"slow"})," array frequently has > 10 entries"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"ops.db.max"})," > 500ms (very slow database queries)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"totalOps"})," > 50 (possible N+1 query problem)"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Action Required:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"totalMs"})," > 2000ms (request timeout risk)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"hitRate"})," < 0.3 (cache not working effectively)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"complexityScore"})," > 1000 (query may be too expensive)"]}),"\n",(0,i.jsxs)(n.li,{children:["Multiple operations with ",(0,i.jsx)(n.code,{children:"max"})," > 1000ms"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"server-timing-headers",children:"Server-Timing Headers"}),"\n",(0,i.jsxs)(n.p,{children:["Every API response includes a ",(0,i.jsx)(n.code,{children:"Server-Timing"})," header with performance breakdown:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'Server-Timing: db;dur=45, cache;desc="hit:12|miss:3", total;dur=127\n'})}),"\n",(0,i.jsx)(n.h3,{id:"header-components",children:"Header Components"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Metric"}),(0,i.jsx)(n.th,{children:"Description"}),(0,i.jsx)(n.th,{children:"Example"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"db;dur=X"})}),(0,i.jsx)(n.td,{children:"Total database operation time (ms)"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"db;dur=45"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:'cache;desc="hit:X|miss:Y"'})}),(0,i.jsx)(n.td,{children:"Cache hit and miss counts"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:'cache;desc="hit:12|miss:3"'})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"total;dur=X"})}),(0,i.jsx)(n.td,{children:"Total request duration (ms)"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"total;dur=127"})})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"viewing-in-browser-devtools",children:"Viewing in Browser DevTools"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Open your browser's ",(0,i.jsx)(n.strong,{children:"Developer Tools"})," (F12)"]}),"\n",(0,i.jsxs)(n.li,{children:["Go to the ",(0,i.jsx)(n.strong,{children:"Network"})," tab"]}),"\n",(0,i.jsx)(n.li,{children:"Click on any API request"}),"\n",(0,i.jsxs)(n.li,{children:["View the ",(0,i.jsx)(n.strong,{children:"Timing"})," tab to see the Server-Timing breakdown"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{src:"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Server-Timing#browser_compatibility",alt:"Server Timing Example"})}),"\n",(0,i.jsx)(n.p,{children:"Modern browsers (Chrome, Firefox, Edge) automatically visualize these metrics."}),"\n",(0,i.jsxs)(n.h2,{id:"metricsperf-endpoint",children:[(0,i.jsx)(n.code,{children:"/metrics/perf"})," Endpoint"]}),"\n",(0,i.jsx)(n.h3,{id:"accessing-metrics",children:"Accessing Metrics"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"GET http://localhost:4000/metrics/perf\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Response:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "recent": [\n    {\n      "totalMs": 127.5,\n      "cacheHits": 12,\n      "cacheMiss": 3,\n      "ops": {\n        "db": { "count": 5, "ms": 45.2, "max": 18.3 },\n        "query": { "count": 3, "ms": 32.1, "max": 15.8 }\n      }\n    }\n  ]\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"response-schema",children:"Response Schema"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Field"}),(0,i.jsx)(n.th,{children:"Type"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"recent"})}),(0,i.jsx)(n.td,{children:"Array"}),(0,i.jsx)(n.td,{children:"Last 50 performance snapshots (limited for memory)"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"totalMs"})}),(0,i.jsx)(n.td,{children:"number"}),(0,i.jsx)(n.td,{children:"Total time spent in tracked operations"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"cacheHits"})}),(0,i.jsx)(n.td,{children:"number"}),(0,i.jsx)(n.td,{children:"Number of cache hits during request"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"cacheMiss"})}),(0,i.jsx)(n.td,{children:"number"}),(0,i.jsx)(n.td,{children:"Number of cache misses during request"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"ops"})}),(0,i.jsx)(n.td,{children:"Object"}),(0,i.jsx)(n.td,{children:"Operation-level statistics"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"ops[name].count"})}),(0,i.jsx)(n.td,{children:"number"}),(0,i.jsx)(n.td,{children:"Number of times operation was called"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"ops[name].ms"})}),(0,i.jsx)(n.td,{children:"number"}),(0,i.jsx)(n.td,{children:"Total milliseconds spent in operation"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"ops[name].max"})}),(0,i.jsx)(n.td,{children:"number"}),(0,i.jsx)(n.td,{children:"Maximum duration for single operation call"})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"retention",children:"Retention"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"In-Memory Storage"}),": Last 200 snapshots are kept in memory"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Endpoint Returns"}),": Maximum 50 most recent snapshots"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"No Persistence"}),": Metrics reset on server restart"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"integration-examples",children:"Integration Examples"}),"\n",(0,i.jsx)(n.h3,{id:"monitoring-dashboard",children:"Monitoring Dashboard"}),"\n",(0,i.jsxs)(n.p,{children:["Poll the ",(0,i.jsx)(n.code,{children:"/metrics/perf"})," endpoint to display real-time performance:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"// Fetch performance metrics every 5 seconds\nsetInterval(async () => {\n  const response = await fetch('http://localhost:4000/metrics/perf');\n  const data = await response.json();\n  \n  // Display average database time\n  const avgDbTime = data.recent\n    .map(s => s.ops.db?.ms || 0)\n    .reduce((a, b) => a + b, 0) / data.recent.length;\n  \n  console.log(`Avg DB time: ${avgDbTime.toFixed(2)}ms`);\n}, 5000);\n"})}),"\n",(0,i.jsx)(n.h3,{id:"apm-tool-integration",children:"APM Tool Integration"}),"\n",(0,i.jsxs)(n.p,{children:["Many Application Performance Monitoring (APM) tools automatically capture ",(0,i.jsx)(n.code,{children:"Server-Timing"})," headers:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"New Relic"}),": Automatically captures custom timing metrics"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Datadog"}),": RUM integration reads Server-Timing headers"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Elastic APM"}),": Correlates server-side timing with user experience"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"custom-alerting",children:"Custom Alerting"}),"\n",(0,i.jsxs)(n.p,{children:["Monitor for slow requests using the ",(0,i.jsx)(n.code,{children:"/metrics/perf"})," endpoint:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"import requests\nimport time\n\nTHRESHOLD_MS = 500  # Alert on requests > 500ms\n\nwhile True:\n    response = requests.get('http://localhost:4000/metrics/perf')\n    data = response.json()\n    \n    slow_requests = [s for s in data['recent'] if s['totalMs'] > THRESHOLD_MS]\n    \n    if slow_requests:\n        print(f\"\u26a0\ufe0f  {len(slow_requests)} slow requests detected!\")\n        for req in slow_requests:\n            print(f\"  - Total: {req['totalMs']}ms, DB: {req['ops'].get('db', {}).get('ms', 0)}ms\")\n    \n    time.sleep(10)\n"})}),"\n",(0,i.jsx)(n.h2,{id:"production-considerations",children:"Production Considerations"}),"\n",(0,i.jsx)(n.h3,{id:"security",children:"Security"}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u26a0\ufe0f WARNING"}),": The ",(0,i.jsx)(n.code,{children:"/metrics/perf"})," endpoint currently has no authentication. For production deployments:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Add API key authentication, or"}),"\n",(0,i.jsx)(n.li,{children:"Restrict access to admin users only, or"}),"\n",(0,i.jsx)(n.li,{children:"Use network-level controls (VPN, internal-only access)"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"performance-impact",children:"Performance Impact"}),"\n",(0,i.jsx)(n.p,{children:"The performance tracking system is designed to be lightweight:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Memory overhead"}),": ~200 snapshots \xd7 ~500 bytes = ~100KB"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"CPU overhead"}),": Negligible (simple timestamp math)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"No I/O"}),": All metrics stored in-memory, no database writes"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"privacy",children:"Privacy"}),"\n",(0,i.jsxs)(n.p,{children:["Performance metrics ",(0,i.jsx)(n.strong,{children:"do not contain PII"})," (Personally Identifiable Information):"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u2705 Operation counts and timings"}),"\n",(0,i.jsx)(n.li,{children:"\u2705 Cache statistics"}),"\n",(0,i.jsx)(n.li,{children:"\u274c User IDs, emails, or other personal data"}),"\n",(0,i.jsx)(n.li,{children:"\u274c Request/response payloads"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"extending-performance-tracking",children:"Extending Performance Tracking"}),"\n",(0,i.jsx)(n.h3,{id:"custom-operations",children:"Custom Operations"}),"\n",(0,i.jsx)(n.p,{children:"Track custom operations in your code:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"// In a GraphQL resolver\nexport const myResolver = async (parent, args, ctx) => {\n  // Track external API call\n  const result = await ctx.request.perf?.time('external-api', async () => {\n    return await fetch('https://api.example.com/data');\n  });\n  \n  return result;\n};\n"})}),"\n",(0,i.jsx)(n.h3,{id:"manual-timing",children:"Manual Timing"}),"\n",(0,i.jsx)(n.p,{children:"For non-async operations:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"const stopTimer = ctx.request.perf?.start('computation');\n// ... expensive computation ...\nstopTimer?.();\n"})}),"\n",(0,i.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,i.jsx)(n.h3,{id:"metrics-not-appearing",children:"Metrics Not Appearing"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Check plugin registration"}),": Ensure ",(0,i.jsx)(n.code,{children:"performance.ts"})," plugin is loaded in ",(0,i.jsx)(n.code,{children:"src/fastifyPlugins/index.ts"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Verify headers"}),": Use ",(0,i.jsx)(n.code,{children:"curl -v"})," to inspect response headers"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Browser compatibility"}),": Ensure browser supports Server-Timing (Chrome 65+, Firefox 61+)"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"endpoint-returns-empty-array",children:"Endpoint Returns Empty Array"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Normal on server restart (metrics are in-memory)"}),"\n",(0,i.jsx)(n.li,{children:"Make some API requests to populate snapshots"}),"\n"]}),"\n",(0,i.jsxs)(n.h3,{id:"high-totalms-values",children:["High ",(0,i.jsx)(n.code,{children:"totalMs"})," Values"]}),"\n",(0,i.jsxs)(n.p,{children:["If ",(0,i.jsx)(n.code,{children:"totalMs"})," is unexpectedly high:"]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Check ",(0,i.jsx)(n.code,{children:"ops.db.ms"})," for slow database queries"]}),"\n",(0,i.jsxs)(n.li,{children:["Review ",(0,i.jsx)(n.code,{children:"cacheMiss"})," count (high misses = more DB hits)"]}),"\n",(0,i.jsx)(n.li,{children:"Inspect individual operation max times for bottlenecks"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"further-reading",children:"Further Reading"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Server-Timing",children:"MDN: Server-Timing"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://w3c.github.io/server-timing/",children:"W3C Server Timing Specification"})}),"\n",(0,i.jsxs)(n.li,{children:["Implementation: ",(0,i.jsx)(n.code,{children:"src/fastifyPlugins/performance.ts"})]}),"\n",(0,i.jsxs)(n.li,{children:["Tracker utility: ",(0,i.jsx)(n.code,{children:"src/utilities/metrics/performanceTracker.ts"})]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(a,{...e})}):a(e)}},55288:(e,n,r)=>{r.d(n,{R:()=>c,x:()=>o});var s=r(30758);const i={},t=s.createContext(i);function c(e){const n=s.useContext(t);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:c(e.components),s.createElement(t.Provider,{value:n},e.children)}}}]);