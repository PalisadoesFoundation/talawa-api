"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[37887],{21828:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>d,default:()=>h,frontMatter:()=>c,metadata:()=>r,toc:()=>a});const r=JSON.parse('{"id":"docs/developer-resources/best-practices/performance-monitoring","title":"Performance Monitoring","description":"Talawa API includes built-in performance monitoring to help DevOps teams track request-level performance metrics.","source":"@site/docs/docs/developer-resources/best-practices/performance-monitoring.md","sourceDirName":"docs/developer-resources/best-practices","slug":"/developer-resources/performance-monitoring","permalink":"/docs/developer-resources/performance-monitoring","draft":false,"unlisted":false,"editUrl":"https://github.com/PalisadoesFoundation/talawa-api/edit/develop/docs/docs/docs/developer-resources/best-practices/performance-monitoring.md","tags":[],"version":"current","sidebarPosition":60,"frontMatter":{"id":"performance-monitoring","title":"Performance Monitoring","slug":"/developer-resources/performance-monitoring","sidebar_position":60},"sidebar":"tutorialSidebar","previous":{"title":"Rate Limiting","permalink":"/docs/developer-resources/rate-limiting"},"next":{"title":"Error Handling Guide","permalink":"/docs/developer-resources/error-handling-guide"}}');var i=s(86070),t=s(55288);const c={id:"performance-monitoring",title:"Performance Monitoring",slug:"/developer-resources/performance-monitoring",sidebar_position:60},d="Performance Monitoring and Observability",l={},a=[{value:"Quick Reference",id:"quick-reference",level:2},{value:"Key Thresholds at a Glance",id:"key-thresholds-at-a-glance",level:3},{value:"Acceptable ranges: rationale",id:"acceptable-ranges-rationale",level:3},{value:"Remediation steps to bring parameters to acceptable ranges",id:"remediation-steps-to-bring-parameters-to-acceptable-ranges",level:3},{value:"Overview",id:"overview",level:2},{value:"How to Access Performance Monitoring",id:"how-to-access-performance-monitoring",level:2},{value:"Server-Timing Headers (Automatic)",id:"server-timing-headers-automatic",level:3},{value:"<code>/metrics/perf</code> Endpoint (API)",id:"metricsperf-endpoint-api",level:3},{value:"Response Schema",id:"response-schema",level:3},{value:"Retention",id:"retention",level:3},{value:"Programmatic Access (In Code)",id:"programmatic-access-in-code",level:3},{value:"Automatic DataLoader Metrics Tracking",id:"automatic-dataloader-metrics-tracking",level:3},{value:"Performance Metrics Reference",id:"performance-metrics-reference",level:2},{value:"Complete Metrics Schema",id:"complete-metrics-schema",level:3},{value:"Interpreting Results",id:"interpreting-results",level:3},{value:"Diagnosing Performance Issues",id:"diagnosing-performance-issues",level:2},{value:"High Response Time (<code>totalMs</code> &gt; 1000ms)",id:"high-response-time-totalms--1000ms",level:3},{value:"Low Cache Hit Rate (<code>hitRate</code> &lt; 0.5)",id:"low-cache-hit-rate-hitrate--05",level:3},{value:"N+1 Query Pattern (<code>totalOps</code> &gt; 50)",id:"n1-query-pattern-totalops--50",level:3},{value:"Slow Operations in <code>slow</code> Array",id:"slow-operations-in-slow-array",level:3},{value:"Real-World Scenarios",id:"real-world-scenarios",level:2},{value:"Scenario 1: Optimizing a User List Query",id:"scenario-1-optimizing-a-user-list-query",level:3},{value:"Scenario 2: Identifying a Slow Database Query",id:"scenario-2-identifying-a-slow-database-query",level:3},{value:"Scenario 3: Cache Warming on Startup",id:"scenario-3-cache-warming-on-startup",level:3},{value:"Integration Examples",id:"integration-examples",level:2},{value:"Monitoring Dashboard",id:"monitoring-dashboard",level:3},{value:"Custom Alerting Script",id:"custom-alerting-script",level:3},{value:"Metrics Configuration",id:"metrics-configuration",level:2},{value:"Environment Variables",id:"environment-variables",level:3},{value:"Example Configuration",id:"example-configuration",level:3},{value:"Accessing Protected Metrics",id:"accessing-protected-metrics",level:3},{value:"Metrics Aggregation Output",id:"metrics-aggregation-output",level:3},{value:"Programmatic Access to Aggregated Metrics",id:"programmatic-access-to-aggregated-metrics",level:4},{value:"Metrics Caching",id:"metrics-caching",level:3},{value:"Programmatic Access to Cached Metrics",id:"programmatic-access-to-cached-metrics",level:4},{value:"Extending Performance Tracking",id:"extending-performance-tracking",level:2},{value:"Resolver-level instrumentation (withMutationMetrics / withQueryMetrics)",id:"resolver-level-instrumentation-withmutationmetrics--withquerymetrics",level:3},{value:"Mutations: withMutationMetrics and manual patterns",id:"mutations-withmutationmetrics-and-manual-patterns",level:4},{value:"Using the Helper",id:"using-the-helper",level:5},{value:"Manual Instrumentation",id:"manual-instrumentation",level:5},{value:"Operation Naming",id:"operation-naming",level:5},{value:"Sub-operation Tracking",id:"sub-operation-tracking",level:5},{value:"Instrumenting GraphQL Queries",id:"instrumenting-graphql-queries",level:3},{value:"Using the Helper Utility",id:"using-the-helper-utility",level:4},{value:"Inline Execution: executeWithMetrics",id:"inline-execution-executewithmetrics",level:4},{value:"Manual Instrumentation",id:"manual-instrumentation-1",level:4},{value:"Operation Naming Convention",id:"operation-naming-convention",level:4},{value:"Integration with DataLoader Metrics",id:"integration-with-dataloader-metrics",level:4},{value:"Custom Operations",id:"custom-operations",level:3},{value:"Manual Timing",id:"manual-timing",level:3},{value:"Production Considerations",id:"production-considerations",level:2},{value:"Security",id:"security",level:3},{value:"Performance Impact",id:"performance-impact",level:3},{value:"Data Retention",id:"data-retention",level:3},{value:"Critical validations (mutation instrumentation)",id:"critical-validations-mutation-instrumentation",level:3},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Metrics Not Appearing",id:"metrics-not-appearing",level:3},{value:"Endpoint Returns Empty Array",id:"endpoint-returns-empty-array",level:3},{value:"High <code>totalMs</code> Values",id:"high-totalms-values",level:3},{value:"Browser Not Showing Server-Timing",id:"browser-not-showing-server-timing",level:3},{value:"Observability with OpenTelemetry",id:"observability-with-opentelemetry",level:2},{value:"Key Capabilities",id:"key-capabilities",level:3},{value:"Configuration",id:"configuration",level:3},{value:"Tracing Modes",id:"tracing-modes",level:3},{value:"Console Mode (Local Development)",id:"console-mode-local-development",level:4},{value:"External Mode (Production Monitoring)",id:"external-mode-production-monitoring",level:4},{value:"W3C Trace Context Propagation",id:"w3c-trace-context-propagation",level:3},{value:"Disabling Tracing",id:"disabling-tracing",level:3},{value:"W3C Trace Context Propagation",id:"w3c-trace-context-propagation-1",level:3},{value:"Disabling Tracing",id:"disabling-tracing-1",level:3},{value:"Database Operation Tracing",id:"database-operation-tracing",level:3},{value:"Trace Hierarchy",id:"trace-hierarchy",level:4},{value:"Usage",id:"usage",level:4},{value:"Error Handling",id:"error-handling",level:4},{value:"Sample Output",id:"sample-output",level:4},{value:"Best Practices",id:"best-practices",level:4},{value:"Security",id:"security-1",level:4},{value:"Contributor Guidelines",id:"contributor-guidelines",level:4},{value:"Further Reading",id:"further-reading",level:4},{value:"References",id:"references",level:2}];function o(e){const n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"performance-monitoring-and-observability",children:"Performance Monitoring and Observability"})}),"\n",(0,i.jsx)(n.p,{children:"Talawa API includes built-in performance monitoring to help DevOps teams track request-level performance metrics."}),"\n",(0,i.jsx)(n.h2,{id:"quick-reference",children:"Quick Reference"}),"\n",(0,i.jsx)(n.p,{children:"Use the table below to quickly find common commands and access points for performance monitoring:"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"What You Want"}),(0,i.jsx)(n.th,{children:"How to Get It"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"View metrics in browser"}),(0,i.jsxs)(n.td,{children:["Open DevTools \u2192 Network tab \u2192 Click request \u2192 Check ",(0,i.jsx)(n.code,{children:"Server-Timing"})," header"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"View metrics via CLI"}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"curl -v http://localhost:4000/graphql"})," \u2192 Look for ",(0,i.jsx)(n.code,{children:"Server-Timing"})," header"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Get recent metrics (API)"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"curl http://localhost:4000/metrics/perf"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Track custom operation"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"await ctx.perf?.time('my-op', async () => { ... })"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Instrument a mutation"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:'withMutationMetrics({ operationName: "mutation:createUser" }, resolver)'})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Instrument a query"}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:'withQueryMetrics({ operationName: "query:user" }, resolver)'})," or ",(0,i.jsx)(n.code,{children:'executeWithMetrics(ctx, "query:event", fn)'})]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"View DataLoader metrics"}),(0,i.jsxs)(n.td,{children:["Check ",(0,i.jsx)(n.code,{children:'ops["db:users.byId"]'})," etc. in snapshot"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Access aggregated metrics"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"fastify.getMetricsSnapshots(windowMinutes?)"})})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"key-thresholds-at-a-glance",children:"Key Thresholds at a Glance"}),"\n",(0,i.jsx)(n.p,{children:"The following thresholds help you quickly identify whether your system performance is healthy, needs attention, or requires immediate action:"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Metric"}),(0,i.jsx)(n.th,{children:"\u2705 Good"}),(0,i.jsx)(n.th,{children:"\u26a0\ufe0f Warning"}),(0,i.jsx)(n.th,{children:"\u274c Critical"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"totalMs"})}),(0,i.jsx)(n.td,{children:"< 500ms"}),(0,i.jsx)(n.td,{children:"500-1000ms"}),(0,i.jsx)(n.td,{children:"> 1000ms"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"hitRate"})}),(0,i.jsx)(n.td,{children:"> 0.7"}),(0,i.jsx)(n.td,{children:"0.5-0.7"}),(0,i.jsx)(n.td,{children:"< 0.5"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"totalOps"})}),(0,i.jsx)(n.td,{children:"< 20"}),(0,i.jsx)(n.td,{children:"20-50"}),(0,i.jsx)(n.td,{children:"> 50"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"ops.db.max"})}),(0,i.jsx)(n.td,{children:"< 100ms"}),(0,i.jsx)(n.td,{children:"100-200ms"}),(0,i.jsx)(n.td,{children:"> 200ms"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"slow"})," array"]}),(0,i.jsx)(n.td,{children:"Empty"}),(0,i.jsx)(n.td,{children:"1-5 entries"}),(0,i.jsx)(n.td,{children:"> 5 entries"})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"acceptable-ranges-rationale",children:"Acceptable ranges: rationale"}),"\n",(0,i.jsx)(n.p,{children:"The thresholds above are based on typical API and user-experience goals:"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Parameter"}),(0,i.jsx)(n.th,{children:"Acceptable range"}),(0,i.jsx)(n.th,{children:"Why"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"totalMs"})}),(0,i.jsx)(n.td,{children:"< 500ms (good), 500\u20131000ms (warning), > 1000ms (critical)"}),(0,i.jsx)(n.td,{children:"Response time strongly affects perceived performance; under 500ms feels responsive, over 1s risks timeouts and poor UX."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"hitRate"})}),(0,i.jsx)(n.td,{children:"> 0.7 (good), 0.5\u20130.7 (warning), < 0.5 (critical)"}),(0,i.jsx)(n.td,{children:"High hit rate reduces database load and latency; below 50% means the cache is not effectively offloading the DB."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"totalOps"})}),(0,i.jsx)(n.td,{children:"< 20 (good), 20\u201350 (warning), > 50 (critical)"}),(0,i.jsx)(n.td,{children:"Fewer operations mean less overhead and fewer round-trips; > 50 often indicates N+1 patterns and unnecessary work."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"ops.db.max"})," (or per-op ",(0,i.jsx)(n.code,{children:"max"}),")"]}),(0,i.jsx)(n.td,{children:"< 100ms (good), 100\u2013200ms (warning), > 200ms (critical)"}),(0,i.jsx)(n.td,{children:'Single operations over 200ms are treated as "slow" and usually indicate missing indexes, heavy queries, or external latency.'})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"slow"})," array length"]}),(0,i.jsx)(n.td,{children:"0 (good), 1\u20135 (warning), > 5 (critical)"}),(0,i.jsx)(n.td,{children:"Each entry is an operation over the slow threshold; many entries mean multiple bottlenecks to fix."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"complexityScore"})}),(0,i.jsx)(n.td,{children:"< 100 (simple), 100\u2013500 (moderate), > 1000 (very complex)"}),(0,i.jsx)(n.td,{children:"Higher complexity increases CPU and risk of abuse; very high values may need query depth/limit controls."})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"remediation-steps-to-bring-parameters-to-acceptable-ranges",children:"Remediation steps to bring parameters to acceptable ranges"}),"\n",(0,i.jsx)(n.p,{children:"When a parameter is outside the acceptable range, use these steps to bring it back:"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Parameter out of range"}),(0,i.jsx)(n.th,{children:"Remediation steps"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"totalMs"})})," too high"]}),(0,i.jsxs)(n.td,{children:["1. Identify the main cost: check ",(0,i.jsx)(n.code,{children:"ops"})," and ",(0,i.jsx)(n.code,{children:"slow"})," to see which operation types dominate. 2. If DB: add indexes, use DataLoaders, or optimize queries (see ",(0,i.jsx)(n.code,{children:"ops.db.max"})," and N+1). 3. If cache: improve hit rate (see ",(0,i.jsx)(n.code,{children:"hitRate"}),"). 4. If external APIs: add caching, timeouts, or async processing. 5. Re-run the request and compare ",(0,i.jsx)(n.code,{children:"totalMs"})," and ",(0,i.jsx)(n.code,{children:"ops"})," until within target."]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"hitRate"})})," too low"]}),(0,i.jsxs)(n.td,{children:["1. Confirm cache is enabled and keys are stable (no random or per-request-only keys). 2. Review TTL: increase for read-heavy, rarely changing data. 3. Add cache warming for critical paths after deploy or cold start. 4. Avoid over-invalidation: invalidate only when data actually changes. 5. Re-check ",(0,i.jsx)(n.code,{children:"cacheHits"}),", ",(0,i.jsx)(n.code,{children:"cacheMisses"}),", and ",(0,i.jsx)(n.code,{children:"hitRate"})," after changes."]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"totalOps"})})," too high (e.g. N+1)"]}),(0,i.jsxs)(n.td,{children:["1. Use DataLoaders for batched lookups by ID (users, organizations, events, etc.). 2. Replace N single-query resolvers with one batched loader call per entity type. 3. Consider JOINs or denormalization where batching is not enough. 4. Add field-level caching for hot, read-heavy fields. 5. Verify with metrics: ",(0,i.jsx)(n.code,{children:"totalOps"})," and ",(0,i.jsx)(n.code,{children:"ops.db.count"})," should drop."]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"ops[name].max"})})," or ",(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"slow"})})," entries too high"]}),(0,i.jsxs)(n.td,{children:["1. For DB: run ",(0,i.jsx)(n.code,{children:"EXPLAIN ANALYZE"})," on the slow queries, add indexes on filter/sort columns, and simplify or split very heavy queries. 2. For external APIs: add timeouts, response caching, and circuit breakers. 3. Move non-critical work to background jobs where possible. 4. Re-check ",(0,i.jsx)(n.code,{children:"slow"})," and per-operation ",(0,i.jsx)(n.code,{children:"max"})," after changes."]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"complexityScore"})})," too high"]}),(0,i.jsx)(n.td,{children:"1. Enforce query depth and breadth limits in the GraphQL schema or middleware. 2. Add pagination (e.g. cursor-based) for list fields. 3. Consider cost/complexity analysis and reject or throttle very expensive queries. 4. Re-test with representative queries and confirm score stays within target."})]})]})]}),"\n",(0,i.jsxs)(n.p,{children:["After applying remediation, re-check the same request or workload via ",(0,i.jsx)(n.code,{children:"/metrics/perf"})," or Server-Timing to confirm parameters are within the acceptable ranges above."]}),"\n",(0,i.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,i.jsx)(n.p,{children:"The Performance Metrics Foundation provides:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Server-Timing headers"})," on all HTTP responses for browser-based performance analysis"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsxs)(n.strong,{children:[(0,i.jsx)(n.code,{children:"/metrics/perf"})," endpoint"]})," returning recent performance snapshots for monitoring dashboards"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Request-scoped tracking"})," of database operations, cache hits/misses, and total request duration"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"how-to-access-performance-monitoring",children:"How to Access Performance Monitoring"}),"\n",(0,i.jsx)(n.p,{children:"Performance monitoring is automatically enabled for all HTTP requests. There are three main ways to access performance metrics:"}),"\n",(0,i.jsx)(n.h3,{id:"server-timing-headers-automatic",children:"Server-Timing Headers (Automatic)"}),"\n",(0,i.jsx)(n.p,{children:"Server-Timing headers provide real-time performance breakdown directly in HTTP responses, making them ideal for browser-based debugging and monitoring."}),"\n",(0,i.jsxs)(n.p,{children:["Every HTTP response includes a ",(0,i.jsx)(n.code,{children:"Server-Timing"})," header with performance metrics. No configuration needed."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Access via Browser DevTools:"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Open your browser's ",(0,i.jsx)(n.strong,{children:"Developer Tools"})," (F12 or right-click \u2192 Inspect)"]}),"\n",(0,i.jsxs)(n.li,{children:["Navigate to the ",(0,i.jsx)(n.strong,{children:"Network"})," tab"]}),"\n",(0,i.jsx)(n.li,{children:"Make any API request to your Talawa API server"}),"\n",(0,i.jsx)(n.li,{children:"Click on the request in the Network tab"}),"\n",(0,i.jsxs)(n.li,{children:["View the ",(0,i.jsx)(n.strong,{children:"Timing"})," or ",(0,i.jsx)(n.strong,{children:"Headers"})," section to see the ",(0,i.jsx)(n.code,{children:"Server-Timing"})," header"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Access via Command Line:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'curl -v http://localhost:4000/graphql \\\n  -H "Content-Type: application/json" \\\n  -d \'{"query":"{ __typename }"}\'\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Sample Output:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'*   Trying 127.0.0.1:4000...\n* Connected to localhost (127.0.0.1) port 4000 (#0)\n> POST /graphql HTTP/1.1\n> Host: localhost:4000\n> Content-Type: application/json\n>\n< HTTP/1.1 200 OK\n< content-type: application/json; charset=utf-8\n< Server-Timing: db;dur=45, cache;desc="hit:12|miss:3", total;dur=127\n< content-length: 31\n<\n{"data":{"__typename":"Query"}}\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Understanding the Output:"})}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Header Component"}),(0,i.jsx)(n.th,{children:"Example"}),(0,i.jsx)(n.th,{children:"Meaning"}),(0,i.jsx)(n.th,{children:"Status"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"db;dur=45"})}),(0,i.jsx)(n.td,{children:"45ms database time"}),(0,i.jsx)(n.td,{children:"Total time spent in database operations"}),(0,i.jsx)(n.td,{children:"\u2705 Good (< 100ms)"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:'cache;desc="hit:12|miss:3"'})}),(0,i.jsx)(n.td,{children:"12 hits, 3 misses"}),(0,i.jsx)(n.td,{children:"80% cache hit rate"}),(0,i.jsx)(n.td,{children:"\u2705 Good (> 70%)"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"total;dur=127"})}),(0,i.jsx)(n.td,{children:"127ms total"}),(0,i.jsx)(n.td,{children:"End-to-end request processing time"}),(0,i.jsx)(n.td,{children:"\u2705 Good (< 500ms)"})]})]})]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Server-Timing Header Components:"})}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Metric"}),(0,i.jsx)(n.th,{children:"Description"}),(0,i.jsx)(n.th,{children:"Example"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"db;dur=X"})}),(0,i.jsx)(n.td,{children:"Total database operation time (ms)"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"db;dur=45"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:'cache;desc="hit:X|miss:Y"'})}),(0,i.jsx)(n.td,{children:"Cache hit and miss counts"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:'cache;desc="hit:12|miss:3"'})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"total;dur=X"})}),(0,i.jsx)(n.td,{children:"Total request duration (ms)"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"total;dur=127"})})]})]})]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Sample Browser DevTools View (Chrome):"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Timing\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nQueueing:           0.52 ms\nStalled:            1.23 ms\nDNS Lookup:         0.00 ms\nInitial connection: 0.00 ms\nSSL:                0.00 ms\nRequest sent:       0.15 ms\nWaiting (TTFB):     127.45 ms  \u2190 Server processing time\nContent Download:   0.89 ms\n\nServer Timing\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\ndb:     45.00 ms    \u2190 Database operations\ncache:  hit:12|miss:3\ntotal:  127.00 ms   \u2190 Total server time\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Viewing in Browser DevTools:"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Open your browser's ",(0,i.jsx)(n.strong,{children:"Developer Tools"})," (F12)"]}),"\n",(0,i.jsxs)(n.li,{children:["Go to the ",(0,i.jsx)(n.strong,{children:"Network"})," tab"]}),"\n",(0,i.jsx)(n.li,{children:"Click on any API request"}),"\n",(0,i.jsxs)(n.li,{children:["View the ",(0,i.jsx)(n.strong,{children:"Timing"})," tab to see the Server-Timing breakdown"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Modern browsers (Chrome 65+, Firefox 61+, Edge 79+) automatically visualize these metrics in the Timing tab."}),"\n",(0,i.jsxs)(n.h3,{id:"metricsperf-endpoint-api",children:[(0,i.jsx)(n.code,{children:"/metrics/perf"})," Endpoint (API)"]}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"/metrics/perf"})," endpoint provides a JSON feed of performance data, suitable for integration with monitoring dashboards and alerting systems."]}),"\n",(0,i.jsx)(n.p,{children:"Query the metrics endpoint to retrieve recent performance snapshots programmatically:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"curl http://localhost:4000/metrics/perf | jq '.'\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Sample Output (Healthy System):"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "recent": [\n    {\n      "totalMs": 89,\n      "totalOps": 4,\n      "cacheHits": 8,\n      "cacheMisses": 2,\n      "hitRate": 0.8,\n      "ops": {\n        "db": { "count": 3, "ms": 67.2, "max": 28.5 },\n        "validation": { "count": 1, "ms": 12.1, "max": 12.1 }\n      },\n      "slow": []\n    }\n  ]\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Sample Output (System with Performance Issues):"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "recent": [\n    {\n      "totalMs": 3456,\n      "totalOps": 127,\n      "cacheHits": 3,\n      "cacheMisses": 89,\n      "hitRate": 0.03,\n      "ops": {\n        "db": { "count": 124, "ms": 2890.5, "max": 567.8 },\n        "external-api": { "count": 3, "ms": 456.2, "max": 234.1 }\n      },\n      "slow": [\n        { "op": "db", "ms": 568 },\n        { "op": "db", "ms": 445 },\n        { "op": "db", "ms": 389 }\n      ],\n      "complexityScore": 1250\n    }\n  ]\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Field-by-Field Analysis:"})}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Field"}),(0,i.jsx)(n.th,{children:"Healthy Value"}),(0,i.jsx)(n.th,{children:"Problematic Value"}),(0,i.jsx)(n.th,{children:"Issue Detected"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"totalMs"})}),(0,i.jsx)(n.td,{children:"89"}),(0,i.jsx)(n.td,{children:"3456"}),(0,i.jsx)(n.td,{children:"\u274c Request taking 3.4 seconds"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"totalOps"})}),(0,i.jsx)(n.td,{children:"4"}),(0,i.jsx)(n.td,{children:"127"}),(0,i.jsx)(n.td,{children:"\u274c N+1 query pattern (124 DB calls)"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"hitRate"})}),(0,i.jsx)(n.td,{children:"0.8 (80%)"}),(0,i.jsx)(n.td,{children:"0.03 (3%)"}),(0,i.jsx)(n.td,{children:"\u274c Cache not working"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"ops.db.max"})}),(0,i.jsx)(n.td,{children:"28.5ms"}),(0,i.jsx)(n.td,{children:"567.8ms"}),(0,i.jsx)(n.td,{children:"\u274c Slow database query"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"slow"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"[]"})}),(0,i.jsx)(n.td,{children:"3 entries"}),(0,i.jsx)(n.td,{children:"\u274c Multiple slow operations"})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"response-schema",children:"Response Schema"}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"/metrics/perf"})," endpoint returns performance data with the following schema:"]}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Field"}),(0,i.jsx)(n.th,{children:"Type"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"recent"})}),(0,i.jsx)(n.td,{children:"Array"}),(0,i.jsx)(n.td,{children:"Last 50 performance snapshots (limited for memory)"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"totalMs"})}),(0,i.jsx)(n.td,{children:"number"}),(0,i.jsx)(n.td,{children:"Total time spent in tracked operations"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"cacheHits"})}),(0,i.jsx)(n.td,{children:"number"}),(0,i.jsx)(n.td,{children:"Number of cache hits during request"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"cacheMisses"})}),(0,i.jsx)(n.td,{children:"number"}),(0,i.jsx)(n.td,{children:"Number of cache misses during request"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"ops"})}),(0,i.jsx)(n.td,{children:"Object"}),(0,i.jsx)(n.td,{children:"Operation-level statistics"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"ops[name].count"})}),(0,i.jsx)(n.td,{children:"number"}),(0,i.jsx)(n.td,{children:"Number of times operation was called"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"ops[name].ms"})}),(0,i.jsx)(n.td,{children:"number"}),(0,i.jsx)(n.td,{children:"Total milliseconds spent in operation"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"ops[name].max"})}),(0,i.jsx)(n.td,{children:"number"}),(0,i.jsx)(n.td,{children:"Maximum duration for single operation call"})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"retention",children:"Retention"}),"\n",(0,i.jsx)(n.p,{children:"Performance metrics are stored in-memory with the following retention policy:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"In-Memory Storage"}),": Last 200 snapshots are kept in memory"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Endpoint Returns"}),": Maximum 50 most recent snapshots"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"No Persistence"}),": Metrics reset on server restart"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"programmatic-access-in-code",children:"Programmatic Access (In Code)"}),"\n",(0,i.jsx)(n.p,{children:"Access the performance tracker directly in your GraphQL resolvers or route handlers:"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"In GraphQL Resolvers:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"export const myResolver = async (parent, args, ctx) => {\n  // Access the performance tracker\n  const perf = ctx.perf;\n  \n  // Track a custom operation\n  const result = await perf?.time('external-api-call', async () => {\n    return await fetch('https://api.example.com/data');\n  });\n  \n  // Get current snapshot for logging\n  const snapshot = perf?.snapshot();\n  console.log(`Operations so far: ${snapshot?.totalOps}`);\n  \n  return result;\n};\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Sample Console Output:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Operations so far: 3\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"In Route Handlers:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"app.get('/health', async (req, reply) => {\n  const perf = req.perf;\n  const snapshot = perf?.snapshot();\n  \n  return {\n    status: 'healthy',\n    metrics: snapshot\n  };\n});\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Sample Response:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "status": "healthy",\n  "metrics": {\n    "totalMs": 45,\n    "totalOps": 2,\n    "cacheHits": 5,\n    "cacheMisses": 1,\n    "hitRate": 0.83,\n    "ops": {\n      "db": { "count": 2, "ms": 38.5, "max": 22.1 }\n    },\n    "slow": []\n  }\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Available Methods:"})}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Method"}),(0,i.jsx)(n.th,{children:"Description"}),(0,i.jsx)(n.th,{children:"Example"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"perf.time(name, asyncFn)"})}),(0,i.jsx)(n.td,{children:"Track async operation duration"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"await perf.time('db-query', async () => {...})"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"perf.start(name)"})}),(0,i.jsx)(n.td,{children:"Start manual timing"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"const stop = perf.start('compute'); ... stop();"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"perf.trackDb(ms)"})}),(0,i.jsx)(n.td,{children:"Record database operation"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"perf.trackDb(45.2)"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"perf.trackCacheHit()"})}),(0,i.jsx)(n.td,{children:"Record cache hit"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"perf.trackCacheHit()"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"perf.trackCacheMiss()"})}),(0,i.jsx)(n.td,{children:"Record cache miss"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"perf.trackCacheMiss()"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"perf.trackComplexity(score)"})}),(0,i.jsx)(n.td,{children:"Track GraphQL complexity"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"perf.trackComplexity(150)"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"perf.snapshot()"})}),(0,i.jsx)(n.td,{children:"Get current metrics"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"const metrics = perf.snapshot()"})})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"automatic-dataloader-metrics-tracking",children:"Automatic DataLoader Metrics Tracking"}),"\n",(0,i.jsxs)(n.p,{children:["DataLoaders automatically track performance metrics when a performance tracker is provided to ",(0,i.jsx)(n.code,{children:"createDataloaders()"}),". This provides visibility into batch loading operation timing and helps identify N+1 query patterns. ",(0,i.jsx)(n.strong,{children:"Note:"})," This is separate from OpenTelemetry tracing (see ",(0,i.jsx)(n.a,{href:"#database-operation-tracing",children:"Database Operation Tracing"}),"); metrics tracking focuses on performance timing, while tracing focuses on distributed request flow."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"How It Works:"})}),"\n",(0,i.jsx)(n.p,{children:"When you create DataLoaders with a performance tracker:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"const dataloaders = createDataloaders(db, cache, ctx.perf);\nconst user = await dataloaders.user.load(userId);\n"})}),"\n",(0,i.jsxs)(n.p,{children:["The DataLoader batch function is automatically wrapped with performance metrics tracking. Each batch operation is tracked with the operation name pattern: ",(0,i.jsx)(n.code,{children:"db:{loaderName}.byId"}),". These metrics appear in the performance snapshot (accessible via ",(0,i.jsx)(n.code,{children:"/metrics/perf"})," endpoint or ",(0,i.jsx)(n.code,{children:"ctx.perf?.snapshot()"}),")."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Operation Names:"})}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"DataLoader"}),(0,i.jsx)(n.th,{children:"Operation Name"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"User Loader"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"db:users.byId"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Organization Loader"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"db:organizations.byId"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Event Loader"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"db:events.byId"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Action Item Loader"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"db:actionItems.byId"})})]})]})]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Example Snapshot with DataLoader Metrics:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "totalMs": 156,\n  "totalOps": 3,\n  "ops": {\n    "db:users.byId": { "count": 1, "ms": 45.2, "max": 45.2 },\n    "db:organizations.byId": { "count": 1, "ms": 32.1, "max": 32.1 },\n    "db:events.byId": { "count": 1, "ms": 28.7, "max": 28.7 }\n  }\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Benefits:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Automatic tracking - no manual instrumentation needed"}),"\n",(0,i.jsxs)(n.li,{children:["Identifies N+1 query patterns (high ",(0,i.jsx)(n.code,{children:"count"})," values)"]}),"\n",(0,i.jsxs)(n.li,{children:["Detects slow batch operations (high ",(0,i.jsx)(n.code,{children:"max"})," values)"]}),"\n",(0,i.jsx)(n.li,{children:"Works seamlessly with cache metrics (cache hits reduce DB calls)"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"performance-metrics-reference",children:"Performance Metrics Reference"}),"\n",(0,i.jsx)(n.h3,{id:"complete-metrics-schema",children:"Complete Metrics Schema"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Metric"}),(0,i.jsx)(n.th,{children:"Type"}),(0,i.jsx)(n.th,{children:"Description"}),(0,i.jsx)(n.th,{children:"Acceptable Range"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"totalMs"})}),(0,i.jsx)(n.td,{children:"number"}),(0,i.jsx)(n.td,{children:"Total time (ms) in all tracked operations"}),(0,i.jsx)(n.td,{children:"< 500ms (good), < 1000ms (acceptable), > 1000ms (investigate)"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"totalOps"})}),(0,i.jsx)(n.td,{children:"number"}),(0,i.jsx)(n.td,{children:"Total count of tracked operations"}),(0,i.jsx)(n.td,{children:"Simple: 1-5, Complex: 5-20, > 50 (N+1 problem)"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"cacheHits"})}),(0,i.jsx)(n.td,{children:"number"}),(0,i.jsx)(n.td,{children:"Successful cache retrievals"}),(0,i.jsx)(n.td,{children:"Higher is better, target > 70% of total"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"cacheMisses"})}),(0,i.jsx)(n.td,{children:"number"}),(0,i.jsx)(n.td,{children:"Cache lookups requiring database queries"}),(0,i.jsx)(n.td,{children:"Lower is better, target < 30% of total"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"hitRate"})}),(0,i.jsx)(n.td,{children:"number (0-1)"}),(0,i.jsxs)(n.td,{children:["Cache hit rate: ",(0,i.jsx)(n.code,{children:"hits / (hits + misses)"})]}),(0,i.jsx)(n.td,{children:"> 0.7 (good), 0.5-0.7 (acceptable), < 0.5 (optimize)"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"ops[name].count"})}),(0,i.jsx)(n.td,{children:"number"}),(0,i.jsx)(n.td,{children:"Times a specific operation was called"}),(0,i.jsx)(n.td,{children:"Varies by operation type"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"ops[name].ms"})}),(0,i.jsx)(n.td,{children:"number"}),(0,i.jsx)(n.td,{children:"Total time (ms) in a specific operation"}),(0,i.jsx)(n.td,{children:"DB: < 100ms, Cache: < 10ms"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"ops[name].max"})}),(0,i.jsx)(n.td,{children:"number"}),(0,i.jsx)(n.td,{children:"Maximum duration (ms) for single operation"}),(0,i.jsx)(n.td,{children:"DB: < 200ms, Cache: < 50ms"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"slow"})}),(0,i.jsx)(n.td,{children:"Array"}),(0,i.jsx)(n.td,{children:"Operations exceeding 200ms threshold"}),(0,i.jsx)(n.td,{children:"Empty (ideal), < 5 (acceptable), > 10 (investigate)"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"complexityScore"})}),(0,i.jsx)(n.td,{children:"number"}),(0,i.jsx)(n.td,{children:"GraphQL query complexity score"}),(0,i.jsx)(n.td,{children:"< 100 (simple), 100-500 (moderate), > 1000 (very complex)"})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"interpreting-results",children:"Interpreting Results"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"\u2705 Good Performance Indicators:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"totalMs"})," < 500ms for most requests"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"hitRate"})," > 0.7 (70% cache hit rate)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"slow"})," array is empty or has < 5 entries"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"ops.db.max"})," < 200ms (no slow database queries)"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"\u26a0\ufe0f Warning Signs:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"totalMs"})," consistently > 1000ms"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"hitRate"})," < 0.5 (poor cache efficiency)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"slow"})," array frequently has > 10 entries"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"ops.db.max"})," > 500ms (very slow database queries)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"totalOps"})," > 50 (possible N+1 query problem)"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"\u274c Action Required:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"totalMs"})," > 2000ms (request timeout risk)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"hitRate"})," < 0.3 (cache not working effectively)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"complexityScore"})," > 1000 (query may be too expensive)"]}),"\n",(0,i.jsxs)(n.li,{children:["Multiple operations with ",(0,i.jsx)(n.code,{children:"max"})," > 1000ms"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"diagnosing-performance-issues",children:"Diagnosing Performance Issues"}),"\n",(0,i.jsxs)(n.h3,{id:"high-response-time-totalms--1000ms",children:["High Response Time (",(0,i.jsx)(n.code,{children:"totalMs"})," > 1000ms)"]}),"\n",(0,i.jsx)(n.p,{children:"When response times exceed 1000ms, use the following diagnostic approach to identify the bottleneck:"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Diagnostic Command:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"curl http://localhost:4000/metrics/perf | jq '.recent[0] | {totalMs, ops, slow}'\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Sample Output Indicating Problem:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "totalMs": 2340,\n  "ops": {\n    "db": { "count": 15, "ms": 1890.5, "max": 456.2 },\n    "external-api": { "count": 3, "ms": 420.1, "max": 180.3 }\n  },\n  "slow": [\n    { "op": "db", "ms": 456 },\n    { "op": "db", "ms": 312 }\n  ]\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Analysis:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Database operations taking 1890ms (80% of total time)"}),"\n",(0,i.jsx)(n.li,{children:"15 database operations suggest potential N+1 issue"}),"\n",(0,i.jsx)(n.li,{children:"Two slow queries (456ms, 312ms) need optimization"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Recommendations:"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Add database indexes"})," for frequently queried columns"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Implement DataLoader"})," to batch the 15 database operations"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsxs)(n.strong,{children:["Use ",(0,i.jsx)(n.code,{children:"EXPLAIN ANALYZE"})]})," to identify slow query plans"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Cache external API responses"})," to reduce 420ms overhead"]}),"\n"]}),"\n",(0,i.jsxs)(n.h3,{id:"low-cache-hit-rate-hitrate--05",children:["Low Cache Hit Rate (",(0,i.jsx)(n.code,{children:"hitRate"})," < 0.5)"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Diagnostic Command:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"curl http://localhost:4000/metrics/perf | jq '.recent[0] | {cacheHits, cacheMisses, hitRate}'\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Sample Output Indicating Problem:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "cacheHits": 2,\n  "cacheMisses": 18,\n  "hitRate": 0.1\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Analysis:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Only 10% cache hit rate (2 hits vs 18 misses)"}),"\n",(0,i.jsx)(n.li,{children:"Cache is not being utilized effectively"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Recommendations:"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Review cache keys"})," - ensure they're consistent and not including request-specific data"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Increase TTL"})," - if data doesn't change frequently, extend cache time-to-live"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Implement cache warming"})," - pre-populate cache for frequently accessed data on startup"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Check cache invalidation"})," - overly aggressive invalidation causes low hit rates"]}),"\n"]}),"\n",(0,i.jsxs)(n.h3,{id:"n1-query-pattern-totalops--50",children:["N+1 Query Pattern (",(0,i.jsx)(n.code,{children:"totalOps"})," > 50)"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Diagnostic Command:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"curl http://localhost:4000/metrics/perf | jq '.recent[0] | {totalOps, \"db_count\": .ops.db.count}'\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Sample Output Indicating Problem:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "totalOps": 87,\n  "db_count": 82\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Analysis:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"82 database operations for a single request"}),"\n",(0,i.jsx)(n.li,{children:"Classic N+1 query pattern (1 query + N related queries)"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Recommendations:"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Implement DataLoader"})," for batching related queries"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Use JOIN queries"})," to fetch related data in a single query"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Review resolver structure"})," - check if resolvers make individual queries for related data"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Add field-level caching"})," for frequently accessed fields"]}),"\n"]}),"\n",(0,i.jsxs)(n.h3,{id:"slow-operations-in-slow-array",children:["Slow Operations in ",(0,i.jsx)(n.code,{children:"slow"})," Array"]}),"\n",(0,i.jsxs)(n.p,{children:["When operations appear in the ",(0,i.jsx)(n.code,{children:"slow"})," array, they have exceeded the 200ms threshold and require investigation:"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Diagnostic Command:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"curl http://localhost:4000/metrics/perf | jq '.recent[0].slow'\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Sample Output Indicating Problem:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'[\n  { "op": "db", "ms": 567 },\n  { "op": "db", "ms": 445 },\n  { "op": "external-api", "ms": 312 }\n]\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Analysis:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Three operations exceeded the 200ms slow threshold"}),"\n",(0,i.jsx)(n.li,{children:"Two database queries and one external API call need attention"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Recommendations:"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"For slow database queries:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Run ",(0,i.jsx)(n.code,{children:"EXPLAIN ANALYZE"})," to identify missing indexes"]}),"\n",(0,i.jsx)(n.li,{children:"Add indexes on frequently queried columns"}),"\n",(0,i.jsx)(n.li,{children:"Consider query restructuring or denormalization"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"For slow external API calls:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Implement circuit breakers for resilience"}),"\n",(0,i.jsx)(n.li,{children:"Add response caching with appropriate TTL"}),"\n",(0,i.jsx)(n.li,{children:"Consider async processing for non-critical calls"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"real-world-scenarios",children:"Real-World Scenarios"}),"\n",(0,i.jsx)(n.p,{children:"The following scenarios demonstrate how to use performance metrics to diagnose and resolve common issues in production environments."}),"\n",(0,i.jsx)(n.h3,{id:"scenario-1-optimizing-a-user-list-query",children:"Scenario 1: Optimizing a User List Query"}),"\n",(0,i.jsx)(n.p,{children:"This scenario shows how DataLoader batching can dramatically reduce database load and response times."}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Before Optimization:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"curl http://localhost:4000/metrics/perf | jq '.recent[0]'\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "totalMs": 1850,\n  "totalOps": 52,\n  "cacheHits": 0,\n  "cacheMisses": 50,\n  "hitRate": 0,\n  "ops": {\n    "db": { "count": 51, "ms": 1720.5, "max": 89.2 }\n  },\n  "slow": []\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Problem:"})," Fetching 50 users triggers 51 database queries (1 for list + 50 for related data)."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"After Implementing DataLoader:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "totalMs": 156,\n  "totalOps": 3,\n  "cacheHits": 48,\n  "cacheMisses": 2,\n  "hitRate": 0.96,\n  "ops": {\n    "db": { "count": 2, "ms": 89.3, "max": 52.1 }\n  },\n  "slow": []\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Improvement:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Response time: 1850ms \u2192 156ms (92% faster)"}),"\n",(0,i.jsx)(n.li,{children:"Database queries: 51 \u2192 2 (96% reduction)"}),"\n",(0,i.jsx)(n.li,{children:"Cache hit rate: 0% \u2192 96%"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"scenario-2-identifying-a-slow-database-query",children:"Scenario 2: Identifying a Slow Database Query"}),"\n",(0,i.jsx)(n.p,{children:"This scenario demonstrates how to identify and fix a slow database query using performance metrics and database tooling."}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Metrics showing the problem:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "totalMs": 892,\n  "ops": {\n    "db": { "count": 3, "ms": 845.2, "max": 678.5 }\n  },\n  "slow": [\n    { "op": "db", "ms": 679 }\n  ]\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Investigation steps:"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"One query taking 678ms out of 845ms total DB time"}),"\n",(0,i.jsx)(n.li,{children:"Enable query logging to identify the slow query"}),"\n",(0,i.jsxs)(n.li,{children:["Run ",(0,i.jsx)(n.code,{children:"EXPLAIN ANALYZE"})," on the identified query"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"After adding index:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "totalMs": 124,\n  "ops": {\n    "db": { "count": 3, "ms": 78.4, "max": 35.2 }\n  },\n  "slow": []\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Improvement:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Response time: 892ms \u2192 124ms (86% faster)"}),"\n",(0,i.jsx)(n.li,{children:"Max query time: 678ms \u2192 35ms (95% faster)"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"scenario-3-cache-warming-on-startup",children:"Scenario 3: Cache Warming on Startup"}),"\n",(0,i.jsx)(n.p,{children:"This scenario shows the impact of cache warming on first-request performance after a cold start."}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Before cache warming (cold start):"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "totalMs": 456,\n  "cacheHits": 0,\n  "cacheMisses": 12,\n  "hitRate": 0,\n  "ops": {\n    "db": { "count": 12, "ms": 398.5, "max": 45.2 }\n  }\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"After cache warming:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "totalMs": 67,\n  "cacheHits": 12,\n  "cacheMisses": 0,\n  "hitRate": 1,\n  "ops": {\n    "db": { "count": 0, "ms": 0, "max": 0 }\n  }\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Improvement:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Response time: 456ms \u2192 67ms (85% faster)"}),"\n",(0,i.jsx)(n.li,{children:"Database queries: 12 \u2192 0 (100% reduction)"}),"\n",(0,i.jsx)(n.li,{children:"Cache hit rate: 0% \u2192 100%"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"integration-examples",children:"Integration Examples"}),"\n",(0,i.jsx)(n.h3,{id:"monitoring-dashboard",children:"Monitoring Dashboard"}),"\n",(0,i.jsxs)(n.p,{children:["Poll the ",(0,i.jsx)(n.code,{children:"/metrics/perf"})," endpoint to display real-time performance:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"// Fetch performance metrics every 5 seconds\nasync function monitorPerformance() {\n  const response = await fetch('http://localhost:4000/metrics/perf');\n  const data = await response.json();\n  \n  if (data.recent.length === 0) {\n    console.log('No metrics available yet');\n    return;\n  }\n  \n  // Calculate averages\n  const avgTotalMs = data.recent.reduce((sum, s) => sum + s.totalMs, 0) / data.recent.length;\n  const avgHitRate = data.recent.reduce((sum, s) => sum + s.hitRate, 0) / data.recent.length;\n  const avgDbTime = data.recent.reduce((sum, s) => sum + (s.ops.db?.ms || 0), 0) / data.recent.length;\n  \n  console.log(`\nPerformance Summary (last ${data.recent.length} requests):\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nAvg Response Time:  ${avgTotalMs.toFixed(2)}ms ${avgTotalMs < 500 ? '\u2705' : avgTotalMs < 1000 ? '\u26a0\ufe0f' : '\u274c'}\nAvg Cache Hit Rate: ${(avgHitRate * 100).toFixed(1)}% ${avgHitRate > 0.7 ? '\u2705' : avgHitRate > 0.5 ? '\u26a0\ufe0f' : '\u274c'}\nAvg DB Time:        ${avgDbTime.toFixed(2)}ms ${avgDbTime < 100 ? '\u2705' : avgDbTime < 500 ? '\u26a0\ufe0f' : '\u274c'}\n  `);\n}\n\nsetInterval(monitorPerformance, 5000);\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Sample Console Output:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Performance Summary (last 50 requests):\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nAvg Response Time:  156.78ms \u2705\nAvg Cache Hit Rate: 76.3% \u2705\nAvg DB Time:        89.45ms \u2705\n"})}),"\n",(0,i.jsx)(n.h3,{id:"custom-alerting-script",children:"Custom Alerting Script"}),"\n",(0,i.jsx)(n.p,{children:"The following Python script monitors performance metrics and sends alerts when thresholds are exceeded:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"import requests\nimport time\nfrom datetime import datetime\n\nTHRESHOLDS = {\n    'totalMs': 500,\n    'hitRate': 0.5,\n    'totalOps': 50,\n    'dbMax': 200\n}\n\ndef check_metrics():\n    response = requests.get('http://localhost:4000/metrics/perf')\n    data = response.json()\n    \n    alerts = []\n    for req in data.get('recent', []):\n        if req['totalMs'] > THRESHOLDS['totalMs']:\n            alerts.append(f\"Slow request: {req['totalMs']}ms (threshold: {THRESHOLDS['totalMs']}ms)\")\n        \n        if req['hitRate'] < THRESHOLDS['hitRate']:\n            alerts.append(f\"Low cache hit rate: {req['hitRate']*100:.1f}% (threshold: {THRESHOLDS['hitRate']*100}%)\")\n        \n        if req['totalOps'] > THRESHOLDS['totalOps']:\n            alerts.append(f\"High operation count: {req['totalOps']} (threshold: {THRESHOLDS['totalOps']})\")\n        \n        db_max = req.get('ops', {}).get('db', {}).get('max', 0)\n        if db_max > THRESHOLDS['dbMax']:\n            alerts.append(f\"Slow DB query: {db_max}ms (threshold: {THRESHOLDS['dbMax']}ms)\")\n    \n    if alerts:\n        print(f\"\\n\u26a0\ufe0f  ALERTS at {datetime.now().strftime('%H:%M:%S')}:\")\n        for alert in alerts:\n            print(f\"   \u2022 {alert}\")\n    else:\n        print(f\"\u2705 All metrics healthy at {datetime.now().strftime('%H:%M:%S')}\")\n\nwhile True:\n    check_metrics()\n    time.sleep(10)\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Sample Alert Output:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"\u26a0\ufe0f  ALERTS at 14:32:15:\n   \u2022 Slow request: 1234ms (threshold: 500ms)\n   \u2022 Low cache hit rate: 23.5% (threshold: 50.0%)\n   \u2022 High operation count: 89 (threshold: 50)\n\n\u2705 All metrics healthy at 14:32:25\n\n\u26a0\ufe0f  ALERTS at 14:32:35:\n   \u2022 Slow DB query: 456ms (threshold: 200ms)\n"})}),"\n",(0,i.jsx)(n.h2,{id:"metrics-configuration",children:"Metrics Configuration"}),"\n",(0,i.jsx)(n.p,{children:"Customize the metrics system behavior using environment variables to match your deployment needs."}),"\n",(0,i.jsx)(n.h3,{id:"environment-variables",children:"Environment Variables"}),"\n",(0,i.jsx)(n.p,{children:"The metrics aggregation system is configurable through the following environment variables:"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Variable"}),(0,i.jsx)(n.th,{children:"Default"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"API_METRICS_ENABLED"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"true"})}),(0,i.jsx)(n.td,{children:"Master switch to enable or disable metrics collection and aggregation"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"API_METRICS_AGGREGATION_ENABLED"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"true"})}),(0,i.jsx)(n.td,{children:"Enable or disable the metrics aggregation background worker"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"API_METRICS_AGGREGATION_CRON_SCHEDULE"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"*/5 * * * *"})}),(0,i.jsx)(n.td,{children:"Cron schedule for running metrics aggregation (default: every 5 minutes)"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"API_METRICS_AGGREGATION_WINDOW_MINUTES"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"5"})}),(0,i.jsx)(n.td,{children:"Time window in minutes for aggregating snapshots"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"API_METRICS_SNAPSHOT_RETENTION_COUNT"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"1000"})}),(0,i.jsx)(n.td,{children:"Maximum number of performance snapshots to retain in memory"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"API_METRICS_SLOW_OPERATION_MS"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"200"})}),(0,i.jsx)(n.td,{children:"Threshold in milliseconds for considering an operation as slow"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"API_METRICS_SLOW_REQUEST_MS"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"500"})}),(0,i.jsx)(n.td,{children:"Threshold in milliseconds for considering a request as slow"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"API_METRICS_CACHE_TTL_SECONDS"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"300"})}),(0,i.jsx)(n.td,{children:"Time-to-live in seconds for cached aggregated metrics (5 minutes)"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"API_METRICS_API_KEY"})}),(0,i.jsx)(n.td,{children:"(none)"}),(0,i.jsxs)(n.td,{children:["API key to protect the ",(0,i.jsx)(n.code,{children:"/metrics/perf"})," endpoint. When set, requests require ",(0,i.jsx)(n.code,{children:"Authorization: Bearer <key>"})," header"]})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"example-configuration",children:"Example Configuration"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'# Enable metrics collection (default: true)\nAPI_METRICS_ENABLED=true\n\n# Enable metrics aggregation (default: true)\nAPI_METRICS_AGGREGATION_ENABLED=true\n\n# Run aggregation every 10 minutes\nAPI_METRICS_AGGREGATION_CRON_SCHEDULE="*/10 * * * *"\n\n# Aggregate last 10 minutes of snapshots\nAPI_METRICS_AGGREGATION_WINDOW_MINUTES=10\n\n# Keep last 2000 snapshots in memory\nAPI_METRICS_SNAPSHOT_RETENTION_COUNT=2000\n\n# Configure slow operation threshold (default: 200ms)\nAPI_METRICS_SLOW_OPERATION_MS=300\n\n# Configure slow request threshold (default: 500ms)\nAPI_METRICS_SLOW_REQUEST_MS=1000\n\n# Configure metrics cache TTL (default: 300 seconds)\nAPI_METRICS_CACHE_TTL_SECONDS=600\n\n# Protect metrics endpoint with API key (recommended for production)\nAPI_METRICS_API_KEY=your-secure-api-key-here\n'})}),"\n",(0,i.jsx)(n.h3,{id:"accessing-protected-metrics",children:"Accessing Protected Metrics"}),"\n",(0,i.jsxs)(n.p,{children:["When the ",(0,i.jsx)(n.code,{children:"API_METRICS_API_KEY"})," environment variable is set, all requests to the metrics endpoint require authentication. Use the Authorization header to access protected endpoints:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'curl -H "Authorization: Bearer your-secure-api-key-here" \\\n  http://localhost:4000/metrics/perf\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Sample Output:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "recent": [\n    {\n      "totalMs": 89,\n      "totalOps": 4,\n      "cacheHits": 8,\n      "cacheMisses": 2,\n      "hitRate": 0.8\n    }\n  ]\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"metrics-aggregation-output",children:"Metrics Aggregation Output"}),"\n",(0,i.jsxs)(n.p,{children:["The background worker automatically aggregates performance snapshots at the configured interval (default: every 5 minutes) and logs the results to standard output. This log appears in your server console without any command - it runs automatically based on the ",(0,i.jsx)(n.code,{children:"API_METRICS_AGGREGATION_CRON_SCHEDULE"})," setting."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Example Server Console Log:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "level": 30,\n  "time": 1705234567890,\n  "msg": "Metrics aggregation completed successfully",\n  "duration": "15ms",\n  "windowMinutes": 5,\n  "snapshotCount": 120,\n  "requestCount": 120,\n  "operationCount": 4,\n  "slowOperationCount": 2,\n  "cacheHitRate": "85.50%"\n}\n'})}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Note:"})," This log appears automatically in your server console. To view it, simply monitor your server logs with ",(0,i.jsx)(n.code,{children:"pnpm run dev"})," or check your logging system in production."]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Key Fields:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"windowMinutes"}),": Time window used for aggregation"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"snapshotCount"}),": Number of snapshots processed"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"requestCount"}),": Total requests in the window"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"slowOperationCount"}),": Number of operations potentially needing optimization"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"cacheHitRate"}),": Global cache efficiency for the period"]}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"programmatic-access-to-aggregated-metrics",children:"Programmatic Access to Aggregated Metrics"}),"\n",(0,i.jsx)(n.p,{children:"Access aggregated metrics programmatically via the Fastify instance:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'// Get all recent snapshots\nconst snapshots = fastify.getMetricsSnapshots();\n\n// Get snapshots from last 10 minutes\nconst recentSnapshots = fastify.getMetricsSnapshots(10);\n\n// Use in custom endpoints or monitoring\nfastify.get("/admin/metrics", async (req, reply) => {\n  const snapshots = fastify.getMetricsSnapshots(5); // Last 5 minutes\n  return {\n    window: "5 minutes",\n    count: snapshots.length,\n    snapshots: snapshots.slice(0, 20) // Return top 20\n  };\n});\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Use Cases:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Custom monitoring dashboards"}),"\n",(0,i.jsx)(n.li,{children:"Alerting systems"}),"\n",(0,i.jsx)(n.li,{children:"Performance trend analysis"}),"\n",(0,i.jsx)(n.li,{children:"Capacity planning"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"metrics-caching",children:"Metrics Caching"}),"\n",(0,i.jsx)(n.p,{children:"Aggregated metrics can be cached to improve performance when accessing metrics data. The metrics cache service provides:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Timestamp-based caching"}),": Cache metrics by timestamp identifier"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Time-windowed caching"}),": Cache hourly and daily aggregations with longer TTLs"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Configurable TTL"}),": Control cache expiration via ",(0,i.jsx)(n.code,{children:"API_METRICS_CACHE_TTL_SECONDS"})]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Cache Key Patterns:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Timestamp-based: ",(0,i.jsx)(n.code,{children:"talawa:v1:metrics:aggregated:{timestamp}"})]}),"\n",(0,i.jsxs)(n.li,{children:["Hourly: ",(0,i.jsx)(n.code,{children:"talawa:v1:metrics:aggregated:hourly:{YYYY-MM-DD-HH}"})]}),"\n",(0,i.jsxs)(n.li,{children:["Daily: ",(0,i.jsx)(n.code,{children:"talawa:v1:metrics:aggregated:daily:{YYYY-MM-DD}"})]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Default TTLs:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Timestamp-based metrics: 300 seconds (5 minutes)"}),"\n",(0,i.jsx)(n.li,{children:"Hourly aggregations: 3600 seconds (1 hour)"}),"\n",(0,i.jsx)(n.li,{children:"Daily aggregations: 86400 seconds (24 hours)"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["The metrics cache service is automatically initialized when the performance plugin starts and is available via ",(0,i.jsx)(n.code,{children:"fastify.metricsCache"}),". Cache failures are handled gracefully and do not affect metrics collection."]}),"\n",(0,i.jsx)(n.h4,{id:"programmatic-access-to-cached-metrics",children:"Programmatic Access to Cached Metrics"}),"\n",(0,i.jsxs)(n.p,{children:["Access cached aggregated metrics via the metrics cache service (",(0,i.jsx)(n.code,{children:"fastify.metricsCache"}),"):"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'// Get by timestamp\nconst cached = await fastify.metricsCache.getCachedMetrics(timestamp);\n\n// Get by time window (hourly or daily)\nconst hourly = await fastify.metricsCache.getCachedMetricsByWindow("hourly", "2024-01-15-14");\nconst daily = await fastify.metricsCache.getCachedMetricsByWindow("daily", "2024-01-15");\n\n// Cache aggregated metrics (metrics object first, then timestamp, then optional TTL)\nawait fastify.metricsCache.cacheAggregatedMetrics(aggregatedMetrics, timestamp, 600);\n\n// Invalidate: no args = all metrics; pattern = e.g. "aggregated:hourly:*"\nawait fastify.metricsCache.invalidateMetricsCache();\nawait fastify.metricsCache.invalidateMetricsCache("aggregated:hourly:*");\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Cache Invalidation Strategies:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Time-based"}),": Let TTL expire naturally (default)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Event-based"}),": Invalidate on significant events (deployments, config changes)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Manual"}),": Invalidate specific time windows when data is known to be stale"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"extending-performance-tracking",children:"Extending Performance Tracking"}),"\n",(0,i.jsx)(n.p,{children:"You can extend the built-in performance tracking by adding custom operations and manual timing to monitor application-specific code paths."}),"\n",(0,i.jsx)(n.h3,{id:"resolver-level-instrumentation-withmutationmetrics--withquerymetrics",children:"Resolver-level instrumentation (withMutationMetrics / withQueryMetrics)"}),"\n",(0,i.jsx)(n.p,{children:"The codebase provides helpers that wrap GraphQL resolvers for consistent operation naming and timing:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"withMutationMetrics"})})," (from ",(0,i.jsx)(n.code,{children:"~/src/graphql/utils/withMutationMetrics"}),") \u2014 wraps mutation resolvers with ",(0,i.jsx)(n.code,{children:"ctx.perf?.time(operationName, ...)"})," so each mutation is recorded under a name like ",(0,i.jsx)(n.code,{children:"mutation:createUser"}),". Options: ",(0,i.jsx)(n.code,{children:"{ operationName: string }"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"withQueryMetrics"})})," \u2014 analogous for query resolvers (see ",(0,i.jsx)(n.a,{href:"#instrumenting-graphql-queries",children:"Instrumenting GraphQL Queries"}),")."]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["These utilities only add ",(0,i.jsx)(n.strong,{children:"resolver-level"})," timing. They do not implement request-scoped wiring, Server-Timing header integration, aggregation workers, the ",(0,i.jsx)(n.code,{children:"/metrics/perf"})," endpoint, or DataLoader/cache instrumentation; those are part of the broader performance foundation and are documented elsewhere in this guide. When linking PRs to issues that cover the full foundation, consider either (a) limiting the issue link to the resolver-level change and adding a checklist of remaining tasks, or (b) implementing the remaining pieces before marking the issue resolved."]}),"\n",(0,i.jsx)(n.h4,{id:"mutations-withmutationmetrics-and-manual-patterns",children:"Mutations: withMutationMetrics and manual patterns"}),"\n",(0,i.jsx)(n.p,{children:"Track performance metrics for GraphQL mutations to identify slow operations."}),"\n",(0,i.jsx)(n.h5,{id:"using-the-helper",children:"Using the Helper"}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"withMutationMetrics"})," helper takes an ",(0,i.jsx)(n.strong,{children:"options object"})," with ",(0,i.jsx)(n.code,{children:"operationName"})," and the resolver:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'import { withMutationMetrics } from "~/src/graphql/utils/withMutationMetrics";\n\nconst resolve = withMutationMetrics(\n  { operationName: "mutation:createUser" },\n  async (_parent, args, ctx) => {\n    // Your mutation logic here\n    const user = await ctx.drizzleClient.insert(usersTable).values({...});\n    return user;\n  },\n);\n'})}),"\n",(0,i.jsx)(n.h5,{id:"manual-instrumentation",children:"Manual Instrumentation"}),"\n",(0,i.jsx)(n.p,{children:"For more control, instrument mutations manually:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'export const createEvent = async (parent, args, ctx) => {\n  return await ctx.perf?.time("mutation:createEvent", async () => {\n    // Main mutation logic\n    const event = await createEventInDb(args);\n\n    // Track sub-operations\n    await ctx.perf?.time("mutation:createEvent:notification:enqueue", async () => {\n      ctx.notification?.enqueueEventCreated({...});\n    });\n\n    await ctx.perf?.time("mutation:createEvent:notification:flush", async () => {\n      await ctx.notification?.flush(ctx);\n    });\n\n    return event;\n  });\n};\n'})}),"\n",(0,i.jsx)(n.h5,{id:"operation-naming",children:"Operation Naming"}),"\n",(0,i.jsxs)(n.p,{children:["Mutations follow the pattern: ",(0,i.jsx)(n.code,{children:"mutation:{mutationName}"})]}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Mutation"}),(0,i.jsx)(n.th,{children:"Operation Name"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"createUser"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"mutation:createUser"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"createOrganization"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"mutation:createOrganization"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"createEvent"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"mutation:createEvent"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"updateOrganization"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"mutation:updateOrganization"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"deleteOrganization"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"mutation:deleteOrganization"})})]})]})]}),"\n",(0,i.jsx)(n.h5,{id:"sub-operation-tracking",children:"Sub-operation Tracking"}),"\n",(0,i.jsx)(n.p,{children:"For complex mutations with multiple steps, track sub-operations:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'// Track notification operations separately\n"mutation:createEvent:notification:enqueue"\n"mutation:createEvent:notification:flush"\n\n// Track validation separately from DB operations\n"mutation:updateOrganization:validation"\n"mutation:updateOrganization:database"\n'})}),"\n",(0,i.jsx)(n.p,{children:"This provides granular visibility into where time is spent within complex mutations."}),"\n",(0,i.jsx)(n.h3,{id:"instrumenting-graphql-queries",children:"Instrumenting GraphQL Queries"}),"\n",(0,i.jsx)(n.p,{children:"Track performance metrics for GraphQL queries to identify slow operations and optimize data fetching."}),"\n",(0,i.jsx)(n.h4,{id:"using-the-helper-utility",children:"Using the Helper Utility"}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"withQueryMetrics"})," helper takes an ",(0,i.jsx)(n.strong,{children:"options object"})," with ",(0,i.jsx)(n.code,{children:"operationName"})," and the resolver:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'import { withQueryMetrics } from "~/src/graphql/utils/withQueryMetrics";\n\nconst resolve = withQueryMetrics(\n  { operationName: "query:user" },\n  async (_parent, args, ctx) => {\n    const user = await ctx.drizzleClient.query.usersTable.findFirst({\n      where: (f, op) => op.eq(f.id, args.input.id),\n    });\n    return user;\n  },\n);\n'})}),"\n",(0,i.jsx)(n.h4,{id:"inline-execution-executewithmetrics",children:"Inline Execution: executeWithMetrics"}),"\n",(0,i.jsxs)(n.p,{children:["For inline execution (e.g. inside a resolver with branching logic), use ",(0,i.jsx)(n.code,{children:"executeWithMetrics"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'import { executeWithMetrics } from "~/src/graphql/utils/withQueryMetrics";\n\n// Inside resolver\nreturn await executeWithMetrics(ctx, "query:event", async () => {\n  return await fetchEvent(args.id, ctx);\n});\n'})}),"\n",(0,i.jsx)(n.h4,{id:"manual-instrumentation-1",children:"Manual Instrumentation"}),"\n",(0,i.jsx)(n.p,{children:"For more control, instrument queries manually:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'export const organizations = async (parent, args, ctx) => {\n  return await ctx.perf?.time("query:organizations", async () => {\n    // Query logic with filtering, pagination\n    const orgs = await ctx.drizzleClient.query.organizationsTable.findMany({\n      where: (fields, ops) => ops.ilike(fields.name, `%${args.filter}%`),\n      limit: args.limit,\n      offset: args.offset,\n    });\n    return orgs;\n  });\n};\n'})}),"\n",(0,i.jsx)(n.h4,{id:"operation-naming-convention",children:"Operation Naming Convention"}),"\n",(0,i.jsxs)(n.p,{children:["Queries follow the naming pattern: ",(0,i.jsx)(n.code,{children:"query:{queryName}"})]}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Query"}),(0,i.jsx)(n.th,{children:"Operation Name"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"user"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"query:user"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"organization"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"query:organization"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"event"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"query:event"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"organizations"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"query:organizations"})})]})]})]}),"\n",(0,i.jsx)(n.h4,{id:"integration-with-dataloader-metrics",children:"Integration with DataLoader Metrics"}),"\n",(0,i.jsx)(n.p,{children:"Query instrumentation works seamlessly with DataLoader metrics. When a query uses DataLoaders, both metrics appear in the snapshot:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "totalMs": 234,\n  "ops": {\n    "query:organization": { "count": 1, "ms": 234, "max": 234 },\n    "db:organizations.byId": { "count": 1, "ms": 45, "max": 45 },\n    "db:users.byId": { "count": 1, "ms": 32, "max": 32 }\n  }\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:"This shows:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Total query time: 234ms"}),"\n",(0,i.jsx)(n.li,{children:"Organization DataLoader: 45ms"}),"\n",(0,i.jsx)(n.li,{children:"User DataLoader (for creator): 32ms"}),"\n",(0,i.jsx)(n.li,{children:"Overhead (validation, etc.): ~157ms"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"custom-operations",children:"Custom Operations"}),"\n",(0,i.jsxs)(n.p,{children:["Track custom operations in your code to measure specific functionality. For detailed examples of mutation and query instrumentation, see ",(0,i.jsx)(n.a,{href:"#resolver-level-instrumentation-withmutationmetrics--withquerymetrics",children:"Resolver-level instrumentation (withMutationMetrics / withQueryMetrics)"})," and ",(0,i.jsx)(n.a,{href:"#instrumenting-graphql-queries",children:"Instrumenting GraphQL Queries"}),"."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"// In a GraphQL resolver\nexport const myResolver = async (parent, args, ctx) => {\n  // Track external API call\n  const result = await ctx.request.perf?.time('external-api', async () => {\n    return await fetch('https://api.example.com/data');\n  });\n  \n  return result;\n};\n"})}),"\n",(0,i.jsx)(n.h3,{id:"manual-timing",children:"Manual Timing"}),"\n",(0,i.jsxs)(n.p,{children:["For non-async operations, use manual timing. For resolver-level examples using ",(0,i.jsx)(n.code,{children:"perf.time()"}),", see ",(0,i.jsx)(n.a,{href:"#mutations-withmutationmetrics-and-manual-patterns",children:"Mutations: withMutationMetrics and manual patterns"})," and ",(0,i.jsx)(n.a,{href:"#instrumenting-graphql-queries",children:"Instrumenting GraphQL Queries"}),"."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"const stopTimer = ctx.request.perf?.start('computation');\n// ... expensive computation ...\nstopTimer?.();\n"})}),"\n",(0,i.jsx)(n.h2,{id:"production-considerations",children:"Production Considerations"}),"\n",(0,i.jsx)(n.p,{children:"Before deploying performance monitoring to production, review the following security, performance, and data retention guidelines."}),"\n",(0,i.jsx)(n.h3,{id:"security",children:"Security"}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u26a0\ufe0f IMPORTANT"}),": The ",(0,i.jsx)(n.code,{children:"/metrics/perf"})," endpoint supports API key authentication via the ",(0,i.jsx)(n.code,{children:"API_METRICS_API_KEY"})," environment variable. For production deployments:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsxs)(n.strong,{children:["Set ",(0,i.jsx)(n.code,{children:"API_METRICS_API_KEY"})]})," to protect the endpoint (recommended)"]}),"\n",(0,i.jsx)(n.li,{children:"Use network-level controls (VPN, internal-only access) as additional security"}),"\n",(0,i.jsxs)(n.li,{children:["If ",(0,i.jsx)(n.code,{children:"API_METRICS_API_KEY"})," is not set, the endpoint is unprotected (suitable for development only)"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"performance-impact",children:"Performance Impact"}),"\n",(0,i.jsx)(n.p,{children:"The performance tracking system is designed to have minimal overhead on your application:"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Aspect"}),(0,i.jsx)(n.th,{children:"Impact"}),(0,i.jsx)(n.th,{children:"Details"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Memory"}),(0,i.jsx)(n.td,{children:"~100KB"}),(0,i.jsx)(n.td,{children:"~200 snapshots \xd7 ~500 bytes"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"CPU"}),(0,i.jsx)(n.td,{children:"Negligible"}),(0,i.jsx)(n.td,{children:"Simple timestamp math"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"I/O"}),(0,i.jsx)(n.td,{children:"None"}),(0,i.jsx)(n.td,{children:"All metrics stored in-memory"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Latency"}),(0,i.jsx)(n.td,{children:"< 1ms"}),(0,i.jsx)(n.td,{children:"Minimal overhead per request"})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"data-retention",children:"Data Retention"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"In-Memory Storage"}),": Last 200 snapshots kept in memory"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Endpoint Returns"}),": Maximum 50 most recent snapshots"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"No Persistence"}),": Metrics reset on server restart"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"No PII"}),": Metrics contain only timing data, no user information"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"critical-validations-mutation-instrumentation",children:"Critical validations (mutation instrumentation)"}),"\n",(0,i.jsxs)(n.p,{children:["When adding or changing resolver-level mutation instrumentation (e.g. ",(0,i.jsx)(n.code,{children:"withMutationMetrics"}),", ",(0,i.jsx)(n.code,{children:"createEvent"})," notification tracking), complete these validations before merge:"]}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Validation"}),(0,i.jsx)(n.th,{children:"Required actions"}),(0,i.jsx)(n.th,{children:"Addressed in repo"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsxs)(n.strong,{children:["1. Transaction boundary (",(0,i.jsx)(n.code,{children:"createEvent"}),")"]})}),(0,i.jsxs)(n.td,{children:["Notification enqueue runs ",(0,i.jsx)(n.strong,{children:"outside"})," the database transaction (after commit). If enqueue fails, DB changes are ",(0,i.jsx)(n.strong,{children:"not"})," rolled back (fire-and-forget). Accept and document."]}),(0,i.jsxs)(n.td,{children:["Design documented in ",(0,i.jsx)(n.code,{children:"createEvent.ts"})," (comment above notification enqueue block)."]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"2. Performance overhead"})}),(0,i.jsxs)(n.td,{children:["Run load tests measuring per-mutation overhead (target: ",(0,i.jsx)(n.strong,{children:"<1\u20132 ms"}),"). Verify no memory leaks; confirm ",(0,i.jsx)(n.code,{children:"perf.snapshot()"})," does not delay responses."]}),(0,i.jsxs)(n.td,{children:["Automated test ",(0,i.jsx)(n.code,{children:"test/graphql/utils/withMutationMetrics.overhead.test.ts"})," asserts average overhead ",(0,i.jsx)(n.strong,{children:"<2 ms"})," per mutation. Leak/snapshot checks: run under load if needed."]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"3. Error stack trace preservation"})}),(0,i.jsxs)(n.td,{children:["Verify ",(0,i.jsx)(n.code,{children:"perf.time()"})," wrapper does not swallow error stack traces; full error context preserved for debugging."]}),(0,i.jsxs)(n.td,{children:["Automated test in ",(0,i.jsx)(n.code,{children:"withMutationMetrics.test.ts"}),": ",(0,i.jsx)(n.code,{children:'"should preserve error stack trace when resolver throws"'})," (same error reference, non-empty ",(0,i.jsx)(n.code,{children:"stack"}),")."]})]})]})]}),"\n",(0,i.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,i.jsx)(n.p,{children:"Use the following diagnostic commands and solutions to resolve common performance monitoring issues."}),"\n",(0,i.jsx)(n.h3,{id:"metrics-not-appearing",children:"Metrics Not Appearing"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Diagnostic Command:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'curl -v http://localhost:4000/graphql \\\n  -H "Content-Type: application/json" \\\n  -d \'{"query":"{ __typename }"}\'\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Expected Output (look for Server-Timing header):"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'< Server-Timing: db;dur=0, cache;desc="hit:0|miss:0", total;dur=15\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"If header is missing:"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Check plugin registration in ",(0,i.jsx)(n.code,{children:"src/fastifyPlugins/index.ts"})]}),"\n",(0,i.jsx)(n.li,{children:"Verify the performance plugin is loaded"}),"\n",(0,i.jsx)(n.li,{children:"Check for errors in server startup logs"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"endpoint-returns-empty-array",children:"Endpoint Returns Empty Array"}),"\n",(0,i.jsxs)(n.p,{children:["An empty ",(0,i.jsx)(n.code,{children:"recent"})," array is normal immediately after server startup since metrics are stored in-memory.\n",(0,i.jsx)(n.strong,{children:"Diagnostic Command:"})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"curl http://localhost:4000/metrics/perf | jq '.recent | length'\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Sample Output:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"0\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsxs)(n.strong,{children:["If output is ",(0,i.jsx)(n.code,{children:"0"}),":"]})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Normal after server restart (metrics are in-memory)"}),"\n",(0,i.jsx)(n.li,{children:"Make some API requests to populate snapshots:"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'# Populate metrics with test requests\nfor i in {1..5}; do\n  curl -s http://localhost:4000/graphql \\\n    -H "Content-Type: application/json" \\\n    -d \'{"query":"{ __typename }"}\' > /dev/null\ndone\n\n# Verify metrics are now available\ncurl http://localhost:4000/metrics/perf | jq \'.recent | length\'\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Sample Output:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"5\n"})}),"\n",(0,i.jsxs)(n.h3,{id:"high-totalms-values",children:["High ",(0,i.jsx)(n.code,{children:"totalMs"})," Values"]}),"\n",(0,i.jsxs)(n.p,{children:["If ",(0,i.jsx)(n.code,{children:"totalMs"})," is unexpectedly high, use the following diagnostic steps:"]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsxs)(n.strong,{children:["Check ",(0,i.jsx)(n.code,{children:"ops.db.ms"})]})," for slow database queries"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsxs)(n.strong,{children:["Review ",(0,i.jsx)(n.code,{children:"cacheMisses"})," count"]})," - high misses mean more database hits"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Inspect individual operation max times"})," for bottlenecks"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Diagnostic Command:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"curl http://localhost:4000/metrics/perf | jq '.recent[0] | {totalMs, ops, cacheMisses}'\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Sample Output Indicating Issue:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "totalMs": 2450,\n  "ops": {\n    "db": { "count": 45, "ms": 2100, "max": 890 }\n  },\n  "cacheMisses": 42\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:"This output shows 42 cache misses causing 45 database queries totaling 2100ms - the root cause of the high response time."}),"\n",(0,i.jsx)(n.h3,{id:"browser-not-showing-server-timing",children:"Browser Not Showing Server-Timing"}),"\n",(0,i.jsxs)(n.p,{children:["If the Server-Timing header is not visible in your browser's developer tools, verify the following:\n",(0,i.jsx)(n.strong,{children:"Requirements:"})]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Chrome 65+ / Firefox 61+ / Edge 79+"}),"\n",(0,i.jsx)(n.li,{children:"HTTPS connection (some browsers require secure context)"}),"\n",(0,i.jsx)(n.li,{children:"No browser extensions blocking headers"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Verification:"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Open DevTools \u2192 Network tab"}),"\n",(0,i.jsx)(n.li,{children:"Click on the request"}),"\n",(0,i.jsxs)(n.li,{children:['Check "Headers" tab for ',(0,i.jsx)(n.code,{children:"Server-Timing"})]}),"\n",(0,i.jsx)(n.li,{children:'Check "Timing" tab for visual breakdown'}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"observability-with-opentelemetry",children:"Observability with OpenTelemetry"}),"\n",(0,i.jsx)(n.p,{children:"Talawa API uses OpenTelemetry to provide end-to-end visibility into incoming requests, internal processing, and outgoing calls."}),"\n",(0,i.jsx)(n.h3,{id:"key-capabilities",children:"Key Capabilities"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"End-to-end request tracing"}),"\n",(0,i.jsx)(n.li,{children:"Context propagation across services"}),"\n",(0,i.jsx)(n.li,{children:"Configurable sampling"}),"\n",(0,i.jsx)(n.li,{children:"Zero-overhead when disabled"}),"\n",(0,i.jsx)(n.li,{children:"Console-based tracing for local development"}),"\n",(0,i.jsx)(n.li,{children:"OTLP-based exporting for production/development"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"configuration",children:"Configuration"}),"\n",(0,i.jsx)(n.p,{children:"Tracing behavior is controlled through environment variables:"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Variable"}),(0,i.jsx)(n.th,{children:"Required"}),(0,i.jsx)(n.th,{children:"Description"}),(0,i.jsx)(n.th,{children:"Default"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"API_OTEL_ENABLED"})}),(0,i.jsx)(n.td,{children:"Yes"}),(0,i.jsx)(n.td,{children:"Enable/disable tracing"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"false"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"API_OTEL_EXPORTER_TYPE"})}),(0,i.jsx)(n.td,{children:"Yes"}),(0,i.jsxs)(n.td,{children:["Runtime environment (",(0,i.jsx)(n.code,{children:"console"})," or ",(0,i.jsx)(n.code,{children:"otlp"}),")"]}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"console"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"API_OTEL_TRACE_EXPORTER_ENDPOINT"})}),(0,i.jsx)(n.td,{children:"No"}),(0,i.jsx)(n.td,{children:"OTLP HTTP endpoint for traces"}),(0,i.jsx)(n.td,{})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"API_OTEL_METRIC_EXPORTER_ENDPOINT"})}),(0,i.jsx)(n.td,{children:"No"}),(0,i.jsx)(n.td,{children:"OTLP HTTP endpoint for metrics"}),(0,i.jsx)(n.td,{})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"API_OTEL_SAMPLING_RATIO"})}),(0,i.jsx)(n.td,{children:"No"}),(0,i.jsx)(n.td,{children:"Trace sampling ratio (0-1)"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"1"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"API_OTEL_SERVICE_NAME"})}),(0,i.jsx)(n.td,{children:"No"}),(0,i.jsx)(n.td,{children:"Service identifier"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"talawa-api"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"API_OTEL_EXPORTER_ENABLED"})}),(0,i.jsx)(n.td,{children:"Yes"}),(0,i.jsx)(n.td,{children:"Enable spans exporting"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"false"})})]})]})]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Recommended Settings by Environment:"})}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Environment"}),(0,i.jsx)(n.th,{children:(0,i.jsx)(n.code,{children:"ENABLED"})}),(0,i.jsx)(n.th,{children:(0,i.jsx)(n.code,{children:"SAMPLING_RATIO"})}),(0,i.jsx)(n.th,{children:"Notes"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Local/Dev"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"true"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"1"})}),(0,i.jsx)(n.td,{children:"Capture all traces for debugging"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Staging"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"true"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"0.5"})}),(0,i.jsx)(n.td,{children:"Balance visibility and overhead"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Production (low traffic)"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"true"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"0.3"})}),(0,i.jsx)(n.td,{children:"Good visibility"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Production (high traffic)"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"true"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"0.1"})}),(0,i.jsx)(n.td,{children:"Reduce telemetry cost"})]})]})]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Sampling Behavior Example:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"API_OTEL_SAMPLING_RATIO=0.1\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"~10% of new root traces will be sampled"}),"\n",(0,i.jsx)(n.li,{children:"Child spans automatically inherit the parent's sampling decision"}),"\n",(0,i.jsx)(n.li,{children:"This allows high-volume production systems to reduce telemetry cost without losing trace continuity"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"tracing-modes",children:"Tracing Modes"}),"\n",(0,i.jsxs)(n.p,{children:["Talawa API supports two distinct tracing modes: ",(0,i.jsx)(n.strong,{children:"Console Mode"})," for local development and debugging, and ",(0,i.jsx)(n.strong,{children:"External Mode"})," for production monitoring with external dashboard services."]}),"\n",(0,i.jsx)(n.h4,{id:"console-mode-local-development",children:"Console Mode (Local Development)"}),"\n",(0,i.jsx)(n.p,{children:"Console mode outputs spans directly to stdout, ideal for local development and debugging without external dependencies."}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Configuration:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"API_OTEL_ENABLED=true\nAPI_OTEL_EXPORTER_TYPE=console\nAPI_OTEL_EXPORTER_ENABLED=true\nAPI_OTEL_SAMPLING_RATIO=1\nAPI_OTEL_SERVICE_NAME=talawa-api\n"})}),"\n",(0,i.jsx)(n.h4,{id:"external-mode-production-monitoring",children:"External Mode (Production Monitoring)"}),"\n",(0,i.jsx)(n.p,{children:"External mode exports spans to an external OpenTelemetry-compatible dashboard service using OTLP protocol, enabling centralized monitoring and analysis."}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Configuration:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"API_OTEL_ENABLED=true\nAPI_OTEL_EXPORTER_TYPE=otlp\nAPI_OTEL_EXPORTER_ENABLED=true\nAPI_OTEL_TRACE_EXPORTER_ENDPOINT=your-service-endpoint\nAPI_OTEL_METRIC_EXPORTER_ENDPOINT=your-service-endpoint\nAPI_OTEL_SAMPLING_RATIO=0.5\nAPI_OTEL_SERVICE_NAME=talawa-api\n"})}),"\n",(0,i.jsx)(n.h3,{id:"w3c-trace-context-propagation",children:"W3C Trace Context Propagation"}),"\n",(0,i.jsx)(n.p,{children:"Talawa API supports distributed tracing by automatically propagating trace context across service boundaries using the W3C standard format."}),"\n",(0,i.jsxs)(n.p,{children:["Talawa API automatically propagates trace context using the ",(0,i.jsx)(n.code,{children:"traceparent"})," header:"]}),"\n",(0,i.jsx)(n.h3,{id:"disabling-tracing",children:"Disabling Tracing"}),"\n",(0,i.jsx)(n.p,{children:"To completely disable OpenTelemetry tracing with zero runtime overhead, set the following environment variable:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"API_OTEL_ENABLED=false\n"})}),"\n",(0,i.jsx)(n.p,{children:"When disabled:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"SDK is not initialized"}),"\n",(0,i.jsx)(n.li,{children:"No instrumentation is registered"}),"\n",(0,i.jsx)(n.li,{children:"No performance impact is introduced"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Start the server and make a request:"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Terminal 1: Start server"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"pnpm run dev\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Terminal 2: Make request"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'curl http://localhost:4000/graphql \\\n  -H "Content-Type: application/json" \\\n  -d \'{"query":"{ __typename }"}\'\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Expected Console Output:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "traceId": "347cb51fc1fd41662d768bb1142acff1",\n  "parentId": undefined,\n  "id": "fd6b2a8046d8cc77",\n  "name": "POST /graphql",\n  "kind": 1,\n  "timestamp": 1705312456789000,\n  "duration": 19356500,\n  "attributes": {\n    "http.method": "POST",\n    "http.url": "http://localhost:4000/graphql",\n    "http.target": "/graphql",\n    "http.status_code": 200\n  },\n  "status": { "code": 0 }\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Understanding the Output:"})}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Field"}),(0,i.jsx)(n.th,{children:"Example"}),(0,i.jsx)(n.th,{children:"Meaning"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"traceId"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"347cb51..."})}),(0,i.jsx)(n.td,{children:"Unique identifier for the entire trace"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"id"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"fd6b2a80..."})}),(0,i.jsx)(n.td,{children:"Unique identifier for this span"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"name"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"POST /graphql"})}),(0,i.jsx)(n.td,{children:"Operation being traced"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"kind"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"1"})}),(0,i.jsx)(n.td,{children:"SERVER span (incoming request)"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"duration"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"19356500"})}),(0,i.jsx)(n.td,{children:"Duration in nanoseconds (19.36ms)"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"status.code"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"0"})}),(0,i.jsx)(n.td,{children:"0=OK, 1=ERROR"})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"w3c-trace-context-propagation-1",children:"W3C Trace Context Propagation"}),"\n",(0,i.jsx)(n.p,{children:"Talawa API supports distributed tracing by automatically propagating trace context across service boundaries using the W3C standard format."}),"\n",(0,i.jsxs)(n.p,{children:["Talawa API automatically propagates trace context using the ",(0,i.jsx)(n.code,{children:"traceparent"})," header:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'curl -H "traceparent: 00-a1b2c3d4e5f67890abcdef1234567890-1234567890abcdef-01" \\\n     -H "Content-Type: application/json" \\\n     -d \'{"query":"{ __typename }"}\' \\\n     http://localhost:4000/graphql\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Expected Behavior:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["The response will include ",(0,i.jsx)(n.code,{children:'{"data":{"__typename":"Query"}}'})]}),"\n",(0,i.jsxs)(n.li,{children:["In the server console, the trace will show the provided ",(0,i.jsx)(n.code,{children:"traceId"})," (",(0,i.jsx)(n.code,{children:"a1b2c3d4e5f67890abcdef1234567890"}),")"]}),"\n",(0,i.jsx)(n.li,{children:"Child spans will inherit this trace context, enabling end-to-end distributed tracing"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["The trace will continue with the provided ",(0,i.jsx)(n.code,{children:"traceId"}),", enabling distributed tracing across services."]}),"\n",(0,i.jsx)(n.h3,{id:"disabling-tracing-1",children:"Disabling Tracing"}),"\n",(0,i.jsx)(n.p,{children:"To completely disable OpenTelemetry tracing with zero runtime overhead, set the following environment variable:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"API_OTEL_ENABLED=false\n"})}),"\n",(0,i.jsx)(n.p,{children:"When disabled:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"SDK is not initialized"}),"\n",(0,i.jsx)(n.li,{children:"No instrumentation is registered"}),"\n",(0,i.jsx)(n.li,{children:"No performance impact is introduced"}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"database-operation-tracing",children:"Database Operation Tracing"}),"\n",(0,i.jsxs)(n.p,{children:["Talawa API instruments database operations using the ",(0,i.jsx)(n.code,{children:"traceable"})," utility, providing visibility into database queries through DataLoaders."]}),"\n",(0,i.jsx)(n.h4,{id:"trace-hierarchy",children:"Trace Hierarchy"}),"\n",(0,i.jsx)(n.p,{children:"Database operations create child spans under their parent context:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"HTTP Request \u2192 GraphQL Resolver \u2192 DataLoader \u2192 db:users.batchLoad\n"})}),"\n",(0,i.jsx)(n.p,{children:"This enables end-to-end tracing, bottleneck identification, and N+1 query detection."}),"\n",(0,i.jsx)(n.h4,{id:"usage",children:"Usage"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Import:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'import { traceable } from "~/src/utilities/db/traceableQuery";\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Basic Usage:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'const users = await traceable("users", "batchLoad", async () => {\n  return await db.select().from(usersTable).where(inArray(usersTable.id, userIds));\n});\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"DataLoader Example:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'export const createUserLoader = (): DataLoader<string, User | null> => {\n  return new DataLoader(async (userIds) => {\n    const rows = await traceable("users", "batchLoad", async () => {\n      return await db.select().from(usersTable).where(inArray(usersTable.id, [...userIds]));\n    });\n    const userMap = new Map(rows.map((user) => [user.id, user]));\n    return userIds.map((id) => userMap.get(id) ?? null);\n  });\n};\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Span Attributes:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"db.system"}),": ",(0,i.jsx)(n.code,{children:'"postgresql"'})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"db.operation"}),": Operation type (e.g., ",(0,i.jsx)(n.code,{children:'"batchLoad"'}),")"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"db.model"}),": Table name (e.g., ",(0,i.jsx)(n.code,{children:'"users"'}),")"]}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"error-handling",children:"Error Handling"}),"\n",(0,i.jsx)(n.p,{children:"Errors are automatically captured with stack traces and marked with ERROR status. The error is then re-thrown for normal application handling."}),"\n",(0,i.jsx)(n.h4,{id:"sample-output",children:"Sample Output"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Local Console Output:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "name": "db:users.batchLoad",\n  "traceId": "347cb51fc1fd41662d768bb1142acff1",\n  "parentId": "a8f3d9e2c1b4a567",\n  "duration": 45238.125,\n  "attributes": {\n    "db.system": "postgresql",\n    "db.operation": "batchLoad",\n    "db.model": "users"\n  },\n  "status": { "code": 0 }\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Production Visualization:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Trace: 347cb51fc1fd41662d768bb1142acff1\n\u251c\u2500 POST /graphql (125ms)\n   \u251c\u2500 db:users.batchLoad (45ms)\n   \u251c\u2500 db:organizations.batchLoad (32ms)\n   \u2514\u2500 db:events.batchLoad (28ms)\n"})}),"\n",(0,i.jsx)(n.h4,{id:"best-practices",children:"Best Practices"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Use descriptive operation names"}),": ",(0,i.jsx)(n.code,{children:'"findByEmail"'})," not ",(0,i.jsx)(n.code,{children:'"query"'})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Wrap only DB operations"}),": Exclude business logic from traced functions"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Match model names to tables"}),": Use ",(0,i.jsx)(n.code,{children:'"users"'})," for ",(0,i.jsx)(n.code,{children:"usersTable"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Primary use case"}),": DataLoaders batch loading"]}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"security-1",children:"Security"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"\u26a0\ufe0f Never include sensitive data in model/operation names"})}),"\n",(0,i.jsx)(n.p,{children:"What is captured:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u2705 Table names, operation types, timing"}),"\n",(0,i.jsx)(n.li,{children:"\u274c Query parameters, result data (not captured)"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["For production, use TLS/HTTPS for OTLP endpoints and consider sampling (",(0,i.jsx)(n.code,{children:"API_OTEL_SAMPLING_RATIO=0.1"}),")."]}),"\n",(0,i.jsx)(n.h4,{id:"contributor-guidelines",children:"Contributor Guidelines"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsxs)(n.strong,{children:["When to use ",(0,i.jsx)(n.code,{children:"traceable"}),":"]})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u2705 DataLoader batch functions (required)"}),"\n",(0,i.jsx)(n.li,{children:"\u2705 Complex multi-table queries"}),"\n",(0,i.jsx)(n.li,{children:"\u274c Simple single-row lookups"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["Verify spans locally: Set ",(0,i.jsx)(n.code,{children:"API_OTEL_ENABLED=true"})," and ",(0,i.jsx)(n.code,{children:"API_OTEL_ENVIRONMENT=local"})]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Tests:"})," ",(0,i.jsx)(n.code,{children:"test/utilities/db/traceableQuery.test.ts"})]}),"\n",(0,i.jsx)(n.h4,{id:"further-reading",children:"Further Reading"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Implementation: ",(0,i.jsx)(n.code,{children:"src/utilities/db/traceableQuery.ts"})]}),"\n",(0,i.jsxs)(n.li,{children:["DataLoader examples: ",(0,i.jsx)(n.code,{children:"src/utilities/dataloaders/"})]}),"\n",(0,i.jsxs)(n.li,{children:["OpenTelemetry: ",(0,i.jsx)(n.a,{href:"https://opentelemetry.io/docs/instrumentation/js/",children:"https://opentelemetry.io/docs/instrumentation/js/"})]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"references",children:"References"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Server-Timing",children:"MDN: Server-Timing"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://w3c.github.io/server-timing/",children:"W3C Server Timing Specification"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://opentelemetry.io/docs/",children:"OpenTelemetry Documentation"})}),"\n",(0,i.jsxs)(n.li,{children:["Implementation: ",(0,i.jsx)(n.code,{children:"src/fastifyPlugins/performance.ts"})]}),"\n",(0,i.jsxs)(n.li,{children:["Tracker utility: ",(0,i.jsx)(n.code,{children:"src/utilities/metrics/performanceTracker.ts"})]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(o,{...e})}):o(e)}},55288:(e,n,s)=>{s.d(n,{R:()=>c,x:()=>d});var r=s(30758);const i={},t=r.createContext(i);function c(e){const n=r.useContext(t);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:c(e.components),r.createElement(t.Provider,{value:n},e.children)}}}]);