"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[80597],{55288:(e,n,s)=>{s.d(n,{R:()=>t,x:()=>c});var o=s(30758);const i={},r=o.createContext(i);function t(e){const n=o.useContext(r);return o.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:t(e.components),o.createElement(r.Provider,{value:n},e.children)}},62590:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>c,default:()=>h,frontMatter:()=>t,metadata:()=>o,toc:()=>a});const o=JSON.parse('{"id":"docs/developer-resources/testing/troubleshooting","title":"Troubleshooting","description":"Introduction","source":"@site/docs/docs/developer-resources/testing/troubleshooting.md","sourceDirName":"docs/developer-resources/testing","slug":"/developer-resources/troubleshooting","permalink":"/docs/developer-resources/troubleshooting","draft":false,"unlisted":false,"editUrl":"https://github.com/PalisadoesFoundation/talawa-api/edit/develop/docs/docs/docs/developer-resources/testing/troubleshooting.md","tags":[],"version":"current","sidebarPosition":1000,"frontMatter":{"id":"troubleshooting","title":"Troubleshooting","slug":"/developer-resources/troubleshooting","sidebar_position":1000},"sidebar":"tutorialSidebar","previous":{"title":"Testing & Validation","permalink":"/docs/developer-resources/testing-validation"},"next":{"title":"EmailEnvConfig","permalink":"/docs/auto-docs/config/emailConfig/type-aliases/EmailEnvConfig"}}');var i=s(86070),r=s(55288);const t={id:"troubleshooting",title:"Troubleshooting",slug:"/developer-resources/troubleshooting",sidebar_position:1e3},c=void 0,d={},a=[{value:"Introduction",id:"introduction",level:2},{value:"Docker",id:"docker",level:2},{value:"Status Validation",id:"status-validation",level:3},{value:"Checking Running Ports",id:"checking-running-ports",level:3},{value:"Accessing The Container CLI",id:"accessing-the-container-cli",level:3},{value:"Viewing Container Logs",id:"viewing-container-logs",level:3},{value:"Docker Rootless Mode",id:"docker-rootless-mode",level:2},{value:"Permission Denied on Docker Socket",id:"permission-denied-on-docker-socket",level:3},{value:"Socket Not Found",id:"socket-not-found",level:3},{value:"Bind Mount Permission Issues",id:"bind-mount-permission-issues",level:3},{value:"Container Fails to Start",id:"container-fails-to-start",level:3}];function l(e){const n={code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h2,{id:"introduction",children:"Introduction"}),"\n",(0,i.jsx)(n.p,{children:"This page provides basic troubleshooting steps for the applications."}),"\n",(0,i.jsx)(n.h2,{id:"docker",children:"Docker"}),"\n",(0,i.jsx)(n.p,{children:"When running the application using docker it may seem difficult at first to troubleshoot failures. This section covers some basic troubleshooting strategies."}),"\n",(0,i.jsx)(n.h3,{id:"status-validation",children:"Status Validation"}),"\n",(0,i.jsxs)(n.p,{children:["You can get a summary of all the running docker containers using the ",(0,i.jsx)(n.code,{children:"docker ps"})," command."]}),"\n",(0,i.jsx)(n.p,{children:"It will provide this information under these headings:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"CONTAINER ID"}),": Container IDs"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"IMAGE"}),": Image names on which the containers are based"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"COMMAND"}),": The command that created the containers"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"CREATED"}),": The time of containers"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"STATUS"}),": Whether or not the containers are healthy"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"PORTS"}),": The exposed ports they use"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"NAMES"}),": The names of the running containers"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Here is an example:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'CONTAINER ID   IMAGE           COMMAND                CREATED        STATUS        PORTS                    NAMES\n3a6743b03029   docker-app      "docker-entrypoint.s\u2026" 42 minutes ago Up 41 minutes 0.0.0.0:4321->4321/tcp   docker-app-1\nf86a9f480819   talawa-api-dev  "/bin/bash /init-dat\u2026" 42 minutes ago Up 42 minutes 0.0.0.0:4000->4000/tcp   talawa-api-dev\n83ae5ff56a3f   redis:8.0       "docker-entrypoint.s\u2026" 42 minutes ago Up 42 minutes 0.0.0.0:6379->6379/tcp   talawa-api-redis\n44c8a0f38b04   minio/minio     "/usr/bin/docker-ent\u2026" 42 minutes ago Up 42 minutes 0.0.0.0:9000->9001/tcp   talawa-api-minio-1\n3a9deccdb68e   caddy/caddy:2.9 "caddy run --config \u2026" 42 minutes ago Up 42 minutes 0.0.0.0:9080->9080/tcp   caddy-service\n132dacf0aff4   mongo           "/bin/bash /init-mon\u2026" 42 minutes ago Up 42 minutes 0.0.0.0:27017->27017/tcp mongo\n'})}),"\n",(0,i.jsx)(n.p,{children:"You can get information on each of the headings by using filters like this:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["CONTAINER ID: ",(0,i.jsx)(n.code,{children:"docker ps --format '{{.ID}}'"})]}),"\n",(0,i.jsxs)(n.li,{children:["IMAGE: ",(0,i.jsx)(n.code,{children:"docker ps --format '{{.Names}}'"})]}),"\n",(0,i.jsxs)(n.li,{children:["COMMAND: ",(0,i.jsx)(n.code,{children:"docker ps --format '{{.Command}}'"})]}),"\n",(0,i.jsxs)(n.li,{children:["CREATED: ",(0,i.jsx)(n.code,{children:"docker ps --format '{{.RunningFor}}'"})]}),"\n",(0,i.jsxs)(n.li,{children:["STATUS: ",(0,i.jsx)(n.code,{children:"docker ps --format '{{.Status}}'"})]}),"\n",(0,i.jsxs)(n.li,{children:["PORTS: ",(0,i.jsx)(n.code,{children:"docker ps --format '{{.Ports}}'"})]}),"\n",(0,i.jsxs)(n.li,{children:["NAMES: ",(0,i.jsx)(n.code,{children:"docker ps --format '{{.Names}}'"})]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"checking-running-ports",children:"Checking Running Ports"}),"\n",(0,i.jsx)(n.p,{children:"To quickly check which application ports are running and which are not, you can use the provided port check script:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"bash scripts/port-check/port.sh\n"})}),"\n",(0,i.jsx)(n.h3,{id:"accessing-the-container-cli",children:"Accessing The Container CLI"}),"\n",(0,i.jsxs)(n.p,{children:["You can access the CLI of each container using the docker interactive TTY mode flags ",(0,i.jsx)(n.code,{children:"-it"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:["Here is an example accessing the ",(0,i.jsx)(n.code,{children:"/bin/bash"})," CLI of the ",(0,i.jsx)(n.code,{children:"talawa-api-dev"})," container:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"$ docker exec -it talawa-api-dev /bin/bash\nroot@f86a9f480819:/usr/src/app# ls\nCODEOWNERS          Caddyfile         Dockerfile.prod\nCODE_OF_CONDUCT.md  DOCUMENTATION.md  INSTALLATION.md\nCONTRIBUTING.md     Dockerfile.dev    ISSUE_GUIDELINES.md\nroot@f86a9f480819:/usr/src/app# exit\n$\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Here is an example accessing the ",(0,i.jsx)(n.code,{children:"/bin/mongosh"})," CLI of the ",(0,i.jsx)(n.code,{children:"mongo"})," container:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"$ docker exec -it mongo /bin/mongosh\n...\n...\n...\nrs0 [direct: primary] test> show databases\nadmin        80.00 KiB\nconfig      356.00 KiB\nlocal         1.92 MiB\ntalawa-api    2.49 MiB\nrs0 [direct: primary] test> exit\n$\n"})}),"\n",(0,i.jsx)(n.h3,{id:"viewing-container-logs",children:"Viewing Container Logs"}),"\n",(0,i.jsxs)(n.p,{children:["You can view the container logs in real time by using the ",(0,i.jsx)(n.code,{children:"docker logs -f"})," command. The output will update dynamically as you run the app."]}),"\n",(0,i.jsxs)(n.p,{children:["In this case we see the logs of the ",(0,i.jsx)(n.code,{children:"mongo"})," container. The ",(0,i.jsx)(n.code,{children:"-n 10"})," flag makes the output start with the most recent 10 rows of logs which makes the output less verbose."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"$ docker logs -f mongo -n 10\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'mongosh","version":"6.12.0|2.3.8"},"platform":"Node.js v20.18.1, LE","os":{"name":"linux","architecture":"x64","version":"3.10.0-327.22.2.el7.x86_64","type":"Linux"},"env":{"container":{"runtime":"docker"}}}}}\n{"t":{"$date":"2025-02-22T01:14:08.038+00:00"},"s":"I",  "c":"NETWORK",  "id":51800,   "ctx":"conn2194","msg":"client metadata","attr":{"remote":"127.0.0.1:36844","client":"conn2194","negotiatedCompressors":[],"doc":{"application":{"name":"mongosh 2.3.8"},"driver":{"name":"nodejs|mongosh","version":"6.12.0|2.3.8"},"platform":"Node.js v20.18.1, LE","os":{"name":"linux","architecture":"x64","version":"3.10.0-327.22.2.el7.x86_64","type":"Linux"},"env":{"container":{"runtime":"docker"}}}}}\n{"t":{"$date":"2025-02-22T01:14:08.040+00:00"},"s":"I",  "c":"NETWORK",  "id":6788700, "ctx":"conn2193","msg":"Received first command on ingress connection since session start or auth handshake","attr":{"elapsedMillis":2}}\n{"t":{"$date":"2025-02-22T01:14:08.040+00:00"},"s":"I",  "c":"NETWORK",  "id":22943,   "ctx":"listener","msg":"Connection accepted","attr":{"remote":"127.0.0.1:36848","uuid":{"uuid":{"$uuid":"1ef5fcbd-4913-45fe-bc66-7bc3600a941a"}},"connectionId":2195,"connectionCount":24}}\n{"t":{"$date":"2025-02-22T01:14:08.043+00:00"},"s":"I",  "c":"NETWORK",  "id":22943,   "ctx":"listener","msg":"Connection accepted","attr":{"remote":"127.0.0.1:36854","uuid":{"uuid":{"$uuid":"48522796-7b00-46df-a5d1-3e2a9ec7edd8"}},"connectionId":2196,"connectionCount":25}}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"docker-rootless-mode",children:"Docker Rootless Mode"}),"\n",(0,i.jsx)(n.p,{children:"This section covers troubleshooting specific to running the devcontainer in Docker Rootless mode."}),"\n",(0,i.jsx)(n.h3,{id:"permission-denied-on-docker-socket",children:"Permission Denied on Docker Socket"}),"\n",(0,i.jsx)(n.p,{children:"If the container cannot access the Docker socket, verify the following:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["The socket exists at the expected path:","\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"ls -la ${XDG_RUNTIME_DIR:-/run/user/$(id -u)}/docker.sock\n"})}),"\n"]}),"\n",(0,i.jsx)(n.li,{children:"Your user has read/write access to the socket file."}),"\n",(0,i.jsxs)(n.li,{children:["The ",(0,i.jsx)(n.code,{children:"XDG_RUNTIME_DIR"})," environment variable is set correctly:","\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"echo $XDG_RUNTIME_DIR\n# Should output something like /run/user/1000\n"})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"socket-not-found",children:"Socket Not Found"}),"\n",(0,i.jsx)(n.p,{children:"If Docker reports that the socket cannot be found:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Check your ",(0,i.jsx)(n.code,{children:"DOCKER_HOST"})," variable:","\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"echo $DOCKER_HOST\n# Should output something like unix:///run/user/1000/docker.sock\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["Ensure ",(0,i.jsx)(n.code,{children:"XDG_RUNTIME_DIR"})," is set on your host machine ",(0,i.jsx)(n.strong,{children:"before"})," starting VS Code or the devcontainer CLI:","\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"export UID=$(id -u)\nexport XDG_RUNTIME_DIR=/run/user/$UID\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["Verify the Docker daemon is running in rootless mode:","\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"docker info --format '{{.SecurityOptions}}'\n# Should include \"rootless\" in the output\n"})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"bind-mount-permission-issues",children:"Bind Mount Permission Issues"}),"\n",(0,i.jsxs)(n.p,{children:["In rootless Docker mode, the container runs as ",(0,i.jsx)(n.code,{children:"root"})," internally, but this maps to your non-root host user due to user namespace remapping. If you encounter permission issues with bind-mounted directories:"]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Verify that the workspace directory is owned by your host user:","\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"ls -la /path/to/talawa-api\n"})}),"\n"]}),"\n",(0,i.jsx)(n.li,{children:"Ensure no files are owned by a different user or root."}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"container-fails-to-start",children:"Container Fails to Start"}),"\n",(0,i.jsx)(n.p,{children:"If the rootless devcontainer fails to start:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Verify Docker rootless is installed and running:","\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"systemctl --user status docker\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["Check Docker rootless logs:","\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"journalctl --user -u docker\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["Ensure the environment variables are exported in the same shell session where you launch VS Code:","\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"export UID=$(id -u)\nexport XDG_RUNTIME_DIR=/run/user/$UID\nexport DOCKER_HOST=unix://$XDG_RUNTIME_DIR/docker.sock\ncode .\n"})}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}}}]);