"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[983],{55288:(e,n,i)=>{i.d(n,{R:()=>t,x:()=>d});var s=i(30758);const r={},l=s.createContext(r);function t(e){const n=s.useContext(l);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:t(e.components),s.createElement(l.Provider,{value:n},e.children)}},93907:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>d,default:()=>h,frontMatter:()=>t,metadata:()=>s,toc:()=>a});const s=JSON.parse('{"id":"docs/developer-resources/features/events/events-overview","title":"Events Overview","description":"This guide explains how events work in Talawa, including standalone events and recurring event series.","source":"@site/docs/docs/developer-resources/features/events/events-overview.md","sourceDirName":"docs/developer-resources/features/events","slug":"/developer-resources/events-overview","permalink":"/docs/developer-resources/events-overview","draft":false,"unlisted":false,"editUrl":"https://github.com/PalisadoesFoundation/talawa-api/edit/develop/docs/docs/docs/developer-resources/features/events/events-overview.md","tags":[],"version":"current","sidebarPosition":10,"frontMatter":{"id":"events-overview","title":"Events Overview","slug":"/developer-resources/events-overview","sidebar_position":10},"sidebar":"tutorialSidebar","previous":{"title":"Plugin System","permalink":"/docs/developer-resources/plugin"},"next":{"title":"Event Action Items","permalink":"/docs/developer-resources/action-items"}}');var r=i(86070),l=i(55288);const t={id:"events-overview",title:"Events Overview",slug:"/developer-resources/events-overview",sidebar_position:10},d=void 0,c={},a=[{value:"Overview",id:"overview",level:2},{value:"Data Model",id:"data-model",level:2},{value:"Tables Overview",id:"tables-overview",level:3},{value:"Events Table",id:"events-table",level:4},{value:"Recurrence Rules Table",id:"recurrence-rules-table",level:4},{value:"Recurring Event Instances Table",id:"recurring-event-instances-table",level:4},{value:"Event Exceptions Table",id:"event-exceptions-table",level:4},{value:"Event Generation Windows Table",id:"event-generation-windows-table",level:4},{value:"Event Types",id:"event-types",level:3},{value:"Background Processing",id:"background-processing",level:2},{value:"Instance Creation",id:"instance-creation",level:3},{value:"Operations",id:"operations",level:2},{value:"Updating Recurring Series",id:"updating-recurring-series",level:3},{value:"Update This Event Only",id:"update-this-event-only",level:4},{value:"Update Entire Series",id:"update-entire-series",level:4},{value:"Update This and Following",id:"update-this-and-following",level:4},{value:"Deleting Recurring Events",id:"deleting-recurring-events",level:3},{value:"Delete This Event Only",id:"delete-this-event-only",level:4},{value:"Delete This and Following",id:"delete-this-and-following",level:4},{value:"Delete Entire Series",id:"delete-entire-series",level:4},{value:"Data Access",id:"data-access",level:2},{value:"Reading and Merging",id:"reading-and-merging",level:3},{value:"Scheduling and Cleanup",id:"scheduling-and-cleanup",level:3},{value:"Edge Cases",id:"edge-cases",level:2},{value:"Code References",id:"code-references",level:2}];function o(e){const n={code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",strong:"strong",ul:"ul",...(0,l.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.p,{children:"This guide explains how events work in Talawa, including standalone events and recurring event series."}),"\n",(0,r.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["There are two kinds of events:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Standalone events"}),": single occurrence stored directly in ",(0,r.jsx)(n.code,{children:"events"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Recurring events"}),": defined by a template in ",(0,r.jsx)(n.code,{children:"events"})," + a recurrence rule in ",(0,r.jsx)(n.code,{children:"recurrence_rules"}),", with materialized child instances in ",(0,r.jsx)(n.code,{children:"recurring_event_instances"}),"."]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.li,{children:"Users never edit the template rows directly. They work with instances or with high-level actions (entire series, this and following, this instance only)."}),"\n",(0,r.jsx)(n.li,{children:'A background worker pre-creates instances within a 12\u2011month "hot window" and keeps cleaning old ones. Cron runs hourly (generation) and daily (cleanup).'}),"\n",(0,r.jsx)(n.li,{children:"Updates support three scopes: this instance only, entire series (name/description), and this and following (split the series)."}),"\n",(0,r.jsx)(n.li,{children:"Deletes support three scopes: this instance only, this and following, and entire series."}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"data-model",children:"Data Model"}),"\n",(0,r.jsx)(n.h3,{id:"tables-overview",children:"Tables Overview"}),"\n",(0,r.jsx)(n.p,{children:"Tables in talawa-api (Drizzle ORM):"}),"\n",(0,r.jsx)(n.h4,{id:"events-table",children:"Events Table"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"events"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Stores both standalone events and recurring templates."}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"is_recurring_template"})," (aka ",(0,r.jsx)(n.code,{children:"isRecurringEventTemplate"}),") tells if a row is a recurring template."]}),"\n",(0,r.jsxs)(n.li,{children:["Standalone events: ",(0,r.jsx)(n.code,{children:"is_recurring_template = false"})," and their own ",(0,r.jsx)(n.code,{children:"start_at"}),"/",(0,r.jsx)(n.code,{children:"end_at"})," are final."]}),"\n",(0,r.jsxs)(n.li,{children:["Recurring templates: ",(0,r.jsx)(n.code,{children:"is_recurring_template = true"})," and act as the parent/defaults for instances."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"recurrence-rules-table",children:"Recurrence Rules Table"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"recurrence_rules"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"One per recurring template."}),"\n",(0,r.jsxs)(n.li,{children:["Holds the RRULE-like data (",(0,r.jsx)(n.code,{children:"frequency"}),", ",(0,r.jsx)(n.code,{children:"interval"}),", ",(0,r.jsx)(n.code,{children:"byDay"}),", ",(0,r.jsx)(n.code,{children:"byMonth"}),", ",(0,r.jsx)(n.code,{children:"byMonthDay"}),", ",(0,r.jsx)(n.code,{children:"recurrenceStartDate"}),", optional ",(0,r.jsx)(n.code,{children:"recurrenceEndDate"})," or ",(0,r.jsx)(n.code,{children:"count"}),")."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"base_recurring_event_id"})," links back to the template in ",(0,r.jsx)(n.code,{children:"events"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"original_series_id"})," ties together all splits of the same logical series across time."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"recurring-event-instances-table",children:"Recurring Event Instances Table"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"recurring_event_instances"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Materialized occurrences for recurring series inside the hot window."}),"\n",(0,r.jsxs)(n.li,{children:["Key fields:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"base_recurring_event_id"})," \u2192 template"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"recurrence_rule_id"})," \u2192 source rule"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"original_series_id"})," \u2192 logical series identity across splits"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"original_instance_start_time"})," \u2192 when the RRULE said it should start"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"actual_start_time"}),"/",(0,r.jsx)(n.code,{children:"actual_end_time"})," \u2192 after applying exceptions and duration"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"sequence_number"}),", ",(0,r.jsx)(n.code,{children:"total_count"})," (if finite), ",(0,r.jsx)(n.code,{children:"is_cancelled"})]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"event-exceptions-table",children:"Event Exceptions Table"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"event_exceptions"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Stores per-instance overrides when a user edits a single occurrence (e.g., rename just one date, shift time, etc.)."}),"\n",(0,r.jsx)(n.li,{children:"Exception JSON holds only the fields that differ from the template."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"event-generation-windows-table",children:"Event Generation Windows Table"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"event_generation_windows"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Per-organization config for the hot window and retention:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"hot_window_months_ahead"})," default 12 (1 year forward)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"history_retention_months"})," default 3 (cleanup window)"]}),"\n",(0,r.jsx)(n.li,{children:"Tracks window boundaries and processing metadata."}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"event-types",children:"Event Types"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Standalone event"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Single row in ",(0,r.jsx)(n.code,{children:"events"}),", shown directly in calendars and lists."]}),"\n",(0,r.jsx)(n.li,{children:"Users edit/delete the event itself."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Recurring template (parent)"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Row in ",(0,r.jsx)(n.code,{children:"events"})," with ",(0,r.jsx)(n.code,{children:"is_recurring_template = true"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["Paired with a ",(0,r.jsx)(n.code,{children:"recurrence_rules"})," row."]}),"\n",(0,r.jsx)(n.li,{children:"Not directly shown or edited by users as an event occurrence."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Recurring instance (child)"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Row in ",(0,r.jsx)(n.code,{children:"recurring_event_instances"})," created by the background worker."]}),"\n",(0,r.jsx)(n.li,{children:"Inherits default fields (name, description, location, visibility, registerable, etc.) from the template."}),"\n",(0,r.jsxs)(n.li,{children:["May have a matching ",(0,r.jsx)(n.code,{children:"event_exceptions"})," row to override specific fields for that one occurrence."]}),"\n",(0,r.jsx)(n.li,{children:"What users usually see and interact with on the calendar."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"background-processing",children:"Background Processing"}),"\n",(0,r.jsx)(n.h3,{id:"instance-creation",children:"Instance Creation"}),"\n",(0,r.jsx)(n.p,{children:"Talawa pre-creates occurrences for recurring events in a forward window to make queries fast and simple."}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Window"}),": The default hot window is 12 months ahead; retention keeps ~3 months of history. Config lives in ",(0,r.jsx)(n.code,{children:"event_generation_windows"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Cron"}),": A background worker runs on a schedule (node-cron). Defaults:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Generation: hourly (",(0,r.jsx)(n.code,{children:"API_RECURRING_EVENT_GENERATION_CRON_SCHEDULE"}),", default ",(0,r.jsx)(n.code,{children:"0 * * * *"}),")."]}),"\n",(0,r.jsxs)(n.li,{children:["Cleanup: daily at 02:00 UTC (",(0,r.jsx)(n.code,{children:"API_OLD_EVENT_INSTANCES_CLEANUP_CRON_SCHEDULE"}),", default ",(0,r.jsx)(n.code,{children:"0 2 * * *"}),")."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Pipeline (high level)"}),":","\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Discover work: find orgs whose window needs extension and their recurring templates."}),"\n",(0,r.jsx)(n.li,{children:"Normalize recurrence rules (convert COUNT to a derived end date for consistent window math)."}),"\n",(0,r.jsx)(n.li,{children:"Calculate all occurrences between window start and window end."}),"\n",(0,r.jsxs)(n.li,{children:["Insert only missing instances (dedupe by ",(0,r.jsx)(n.code,{children:"original_instance_start_time"}),")."]}),"\n",(0,r.jsx)(n.li,{children:"Update housekeeping (window end, last processed counts, etc.)."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Key behavior"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"If a rule is never-ending (no end date and no count), we only generate up to window end."}),"\n",(0,r.jsx)(n.li,{children:"If a rule has COUNT, the engine estimates/derives completion and stops accordingly."}),"\n",(0,r.jsx)(n.li,{children:"Instances store both the original schedule and the final start/end \u2014 so exceptions and re-calculations remain consistent."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"operations",children:"Operations"}),"\n",(0,r.jsx)(n.h3,{id:"updating-recurring-series",children:"Updating Recurring Series"}),"\n",(0,r.jsx)(n.p,{children:"Three user-facing options map to distinct backend behaviors."}),"\n",(0,r.jsx)(n.h4,{id:"update-this-event-only",children:"Update This Event Only"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Mutation: ",(0,r.jsx)(n.code,{children:"updateSingleRecurringEventInstance"})]}),"\n",(0,r.jsxs)(n.li,{children:["What happens:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["We write an ",(0,r.jsx)(n.code,{children:"event_exceptions"})," row for that instance with only changed fields (e.g., ",(0,r.jsx)(n.code,{children:"name"}),", ",(0,r.jsx)(n.code,{children:"description"}),", ",(0,r.jsx)(n.code,{children:"location"}),", ",(0,r.jsx)(n.code,{children:"allDay"}),", ",(0,r.jsx)(n.code,{children:"isPublic"}),", ",(0,r.jsx)(n.code,{children:"isRegisterable"}),", ",(0,r.jsx)(n.code,{children:"startAt"}),", ",(0,r.jsx)(n.code,{children:"endAt"}),")."]}),"\n",(0,r.jsxs)(n.li,{children:["If times are changed, we also update ",(0,r.jsx)(n.code,{children:"actual_start_time"}),"/",(0,r.jsx)(n.code,{children:"actual_end_time"})," on the instance."]}),"\n",(0,r.jsx)(n.li,{children:"Other instances are unaffected."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"update-entire-series",children:"Update Entire Series"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Mutation: ",(0,r.jsx)(n.code,{children:"updateEntireRecurringEventSeries"})]}),"\n",(0,r.jsxs)(n.li,{children:["What happens:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["We resolve the logical series via ",(0,r.jsx)(n.code,{children:"original_series_id"})," which is template."]}),"\n",(0,r.jsxs)(n.li,{children:["We update only safe, series-wide fields on all base templates across the whole logical series (even if the series was split earlier):","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Supported: ",(0,r.jsx)(n.code,{children:"name"}),", ",(0,r.jsx)(n.code,{children:"description"})]}),"\n",(0,r.jsx)(n.li,{children:"Not changed here: timing/recurrence/location/visibility/registration flags"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["We bump ",(0,r.jsx)(n.code,{children:"last_updated_at"})," on instances so caches and clients know something changed."]}),"\n",(0,r.jsx)(n.li,{children:"Because instances inherit name/description, the change is reflected everywhere (past/present/future), unless an instance has its own exception for those fields."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"update-this-and-following",children:"Update This and Following"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Mutation: ",(0,r.jsx)(n.code,{children:"updateThisAndFollowingEvents"})]}),"\n",(0,r.jsxs)(n.li,{children:["What happens:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:['We "cut" the current template\'s recurrence by setting its ',(0,r.jsx)(n.code,{children:"recurrence_end_date"})," to just before the targeted instance."]}),"\n",(0,r.jsx)(n.li,{children:"We delete materialized instances from this point forward for the current template."}),"\n",(0,r.jsxs)(n.li,{children:["We create a brand-new template event, apply provided changes (name, desc, location, timing, flags), and create a new ",(0,r.jsx)(n.code,{children:"recurrence_rules"})," row for it."]}),"\n",(0,r.jsxs)(n.li,{children:["We set the new rule's ",(0,r.jsx)(n.code,{children:"original_series_id"})," (used as the logical series identifier going forward)."]}),"\n",(0,r.jsx)(n.li,{children:"The background worker immediately generates future instances for the new template within the hot window."}),"\n",(0,r.jsx)(n.li,{children:"Net effect in the UI: everything before the split stays as-is under the old template; the targeted instance becomes the first occurrence of a new series with your updates; everything after follows the new pattern."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsxs)(n.strong,{children:["Notes on ",(0,r.jsx)(n.code,{children:"original_series_id"})]})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"This field links templates and instances that belong to the same logical series across splits."}),"\n",(0,r.jsxs)(n.li,{children:['Actions like "update entire series" and "delete this and following" consult ',(0,r.jsx)(n.code,{children:"original_series_id"})," to operate across all templates created from earlier splits."]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"deleting-recurring-events",children:"Deleting Recurring Events"}),"\n",(0,r.jsx)(n.p,{children:"Three user-facing options:"}),"\n",(0,r.jsx)(n.h4,{id:"delete-this-event-only",children:"Delete This Event Only"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Mutation: ",(0,r.jsx)(n.code,{children:"deleteSingleEventInstance"})]}),"\n",(0,r.jsxs)(n.li,{children:["What happens:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"We delete action items linked to this instance."}),"\n",(0,r.jsxs)(n.li,{children:["We set ",(0,r.jsx)(n.code,{children:"is_cancelled = true"})," on the instance (kept for history/reporting), and update ",(0,r.jsx)(n.code,{children:"last_updated_at"}),"."]}),"\n",(0,r.jsx)(n.li,{children:"Other instances/series are unaffected."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"delete-this-and-following",children:"Delete This and Following"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Mutation: ",(0,r.jsx)(n.code,{children:"deleteThisAndFollowingEvents"})]}),"\n",(0,r.jsxs)(n.li,{children:["What happens:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["We set the current rule's ",(0,r.jsx)(n.code,{children:"recurrence_end_date"})," to just before this occurrence (effectively trimming the series)."]}),"\n",(0,r.jsxs)(n.li,{children:["We find all instances with the same ",(0,r.jsx)(n.code,{children:"original_series_id"})," whose ",(0,r.jsx)(n.code,{children:"actual_start_time >="})," this instance and delete them."]}),"\n",(0,r.jsx)(n.li,{children:"We also delete their exceptions and action items."}),"\n",(0,r.jsx)(n.li,{children:"Past instances remain."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"delete-entire-series",children:"Delete Entire Series"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Mutation: ",(0,r.jsx)(n.code,{children:"deleteEntireRecurringEventSeries"})]}),"\n",(0,r.jsx)(n.li,{children:"Input is the template (base event) ID."}),"\n",(0,r.jsxs)(n.li,{children:["What happens:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Using the template's rule, we get its ",(0,r.jsx)(n.code,{children:"original_series_id"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["We delete, in order: action items (for all templates and instances), instance exceptions, all instances in the series, all recurrence rules in the series, and finally all template rows in ",(0,r.jsx)(n.code,{children:"events"})," that belong to this logical series."]}),"\n",(0,r.jsx)(n.li,{children:"Attachments for the requested template are cleaned up from storage."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"data-access",children:"Data Access"}),"\n",(0,r.jsx)(n.h3,{id:"reading-and-merging",children:"Reading and Merging"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["The GraphQL ",(0,r.jsx)(n.code,{children:"Event"})," type represents both standalone events and recurring instances with a unified shape."]}),"\n",(0,r.jsx)(n.li,{children:'For recurring instances, "resolved" fields come from: template defaults + per-instance exceptions + instance timing.'}),"\n",(0,r.jsxs)(n.li,{children:["Useful instance metadata:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"sequenceNumber"}),' (e.g., "5 of 12"), ',(0,r.jsx)(n.code,{children:"totalCount"})," when finite."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"hasExceptions"})," and ",(0,r.jsx)(n.code,{children:"appliedExceptionData"})," flags to indicate customizations."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"scheduling-and-cleanup",children:"Scheduling and Cleanup"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Generation cron (hourly by default) grows the forward window and materializes missing instances."}),"\n",(0,r.jsxs)(n.li,{children:["Cleanup cron (daily by default) removes old instances beyond ",(0,r.jsx)(n.code,{children:"history_retention_months"})," for each org and advances ",(0,r.jsx)(n.code,{children:"retention_start_date"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["Defaults live in ",(0,r.jsx)(n.code,{children:"event_generation_windows"})," and can be tuned per organization."]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"edge-cases",children:"Edge Cases"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Never-ending series: only materialized up to the current hot window; cron extends as time moves on."}),"\n",(0,r.jsx)(n.li,{children:"Count-based rules: internally normalized to derive an end date for consistent generation; the original count semantics are preserved when calculating occurrences."}),"\n",(0,r.jsxs)(n.li,{children:["Instance de-duplication: before inserting, generation checks for existing ",(0,r.jsx)(n.code,{children:"original_instance_start_time"})," within the window to avoid duplicates."]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"code-references",children:"Code References"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Tables: ",(0,r.jsx)(n.code,{children:"src/drizzle/tables/events.ts"}),", ",(0,r.jsx)(n.code,{children:"recurrenceRules.ts"}),", ",(0,r.jsx)(n.code,{children:"recurringEventInstances.ts"}),", ",(0,r.jsx)(n.code,{children:"recurringEventExceptions.ts"}),", ",(0,r.jsx)(n.code,{children:"eventGenerationWindows.ts"})]}),"\n",(0,r.jsxs)(n.li,{children:["Generation service: ",(0,r.jsx)(n.code,{children:"src/services/eventGeneration/*"})]}),"\n",(0,r.jsxs)(n.li,{children:["Background workers and cron: ",(0,r.jsx)(n.code,{children:"src/workers/backgroundWorkerService.ts"}),", ",(0,r.jsx)(n.code,{children:"src/workers/eventGeneration/*"}),", ",(0,r.jsx)(n.code,{children:"src/workers/eventCleanupWorker.ts"})]}),"\n",(0,r.jsxs)(n.li,{children:["GraphQL mutations: ",(0,r.jsx)(n.code,{children:"src/graphql/types/Mutation/*RecurringEvent*"})," and related inputs."]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(o,{...e})}):o(e)}}}]);