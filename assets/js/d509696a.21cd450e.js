"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[18211],{55288:(e,n,s)=>{s.d(n,{R:()=>a,x:()=>l});var i=s(30758);const t={},r=i.createContext(t);function a(e){const n=i.useContext(r);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:a(e.components),i.createElement(r.Provider,{value:n},e.children)}},96292:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>l,default:()=>h,frontMatter:()=>a,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"docs/developer-resources/testing/testing-validation","title":"Testing & Validation","description":"This section covers important tests to validate the operation of the API.","source":"@site/docs/docs/developer-resources/testing/testing-validation.md","sourceDirName":"docs/developer-resources/testing","slug":"/developer-resources/testing-validation","permalink":"/docs/developer-resources/testing-validation","draft":false,"unlisted":false,"editUrl":"https://github.com/PalisadoesFoundation/talawa-api/edit/develop/docs/docs/docs/developer-resources/testing/testing-validation.md","tags":[],"version":"current","sidebarPosition":70,"frontMatter":{"id":"testing-validation","title":"Testing & Validation","slug":"/developer-resources/testing-validation","sidebar_position":70},"sidebar":"tutorialSidebar","previous":{"title":"Event Volunteers and Volunteer Groups","permalink":"/docs/developer-resources/volunteers"},"next":{"title":"Troubleshooting","permalink":"/docs/developer-resources/troubleshooting"}}');var t=s(86070),r=s(55288);const a={id:"testing-validation",title:"Testing & Validation",slug:"/developer-resources/testing-validation",sidebar_position:70},l=void 0,o={},d=[{value:"Introduction",id:"introduction",level:2},{value:"Developers Using Microsoft Windows",id:"developers-using-microsoft-windows",level:3},{value:"The <code>tests/</code> Directory",id:"the-tests-directory",level:3},{value:"Quick Start",id:"quick-start",level:2},{value:"Running Tests",id:"running-tests",level:3},{value:"Linting and Formatting",id:"linting-and-formatting",level:3},{value:"Type Checking",id:"type-checking",level:3},{value:"Code Coverage Flags",id:"code-coverage-flags",level:2},{value:"Unit Flag",id:"unit-flag",level:3},{value:"Integration Flag",id:"integration-flag",level:3},{value:"Linting &amp; Static Analysis",id:"linting--static-analysis",level:2},{value:"Biome Plugins",id:"biome-plugins",level:3},{value:"<code>require_escapeHTML</code>",id:"require_escapehtml",level:4},{value:"Why is this important?",id:"why-is-this-important",level:5},{value:"What it detects",id:"what-it-detects",level:5},{value:"False Positives &amp; Limitations",id:"false-positives--limitations",level:5},{value:"How to Suppress",id:"how-to-suppress",level:5},{value:"Testing Philosophy",id:"testing-philosophy",level:2},{value:"Unit Tests vs Integration Testing",id:"unit-tests-vs-integration-testing",level:3},{value:"Integration Testing",id:"integration-testing",level:4},{value:"Unit Testing",id:"unit-testing",level:4},{value:"Directory Structure",id:"directory-structure",level:3},{value:"Mock GraphQL Context Factory Function",id:"mock-graphql-context-factory-function",level:3},{value:"In Directory <code>test/_Mocks_/mockContextCreator</code>",id:"in-directory-test_mocks_mockcontextcreator",level:4},{value:"Purpose",id:"purpose",level:4},{value:"Usage",id:"usage",level:4},{value:"Importing the Mock Context",id:"importing-the-mock-context",level:4},{value:"Creating a Mock Context",id:"creating-a-mock-context",level:4},{value:"For an Unauthenticated User",id:"for-an-unauthenticated-user",level:5},{value:"For an Authenticated User",id:"for-an-authenticated-user",level:5},{value:"Components in Mock Context",id:"components-in-mock-context",level:4},{value:"Return Value",id:"return-value",level:4},{value:"How Contributors Should Use It",id:"how-contributors-should-use-it",level:3},{value:"Unit Testing Resolvers (With exposed mocks for verification)",id:"unit-testing-resolvers-with-exposed-mocks-for-verification",level:4},{value:"Key Benefits",id:"key-benefits",level:3},{value:"<strong>Simplified Call Signature</strong>",id:"simplified-call-signature",level:3},{value:"GraphQL Resolver Type Safety Guidelines",id:"graphql-resolver-type-safety-guidelines",level:3},{value:"Best Practices",id:"best-practices",level:4},{value:"Correct Example",id:"correct-example",level:4},{value:"Incorrect Example",id:"incorrect-example",level:4},{value:"Key Rules",id:"key-rules",level:4},{value:"Future Considerations",id:"future-considerations",level:3},{value:"Writing Reliable Concurrent Tests",id:"writing-reliable-concurrent-tests",level:3},{value:"Guideline Violation Example",id:"guideline-violation-example",level:4},{value:"Guideline Compliance Example",id:"guideline-compliance-example",level:4},{value:"Test DB Usage",id:"test-db-usage",level:2},{value:"Environment Variables",id:"environment-variables",level:2},{value:"Sample DB Login Credentials",id:"sample-db-login-credentials",level:2},{value:"Accessing the API",id:"accessing-the-api",level:2},{value:"Validation",id:"validation",level:3},{value:"GraphQL",id:"graphql",level:3},{value:"Interactive Web Queries With GraphiQL",id:"interactive-web-queries-with-graphiql",level:4},{value:"Programmatic Queries With GraphQL",id:"programmatic-queries-with-graphql",level:4},{value:"Subscriptions with GraphQL",id:"subscriptions-with-graphql",level:4},{value:"Accessing the API in Talawa App Using Remote Access",id:"accessing-the-api-in-talawa-app-using-remote-access",level:4},{value:"Interactive Testing",id:"interactive-testing",level:2},{value:"Using Curl",id:"using-curl",level:3},{value:"Sign-in",id:"sign-in",level:4},{value:"Organization Creation",id:"organization-creation",level:4},{value:"Using GraphiQL",id:"using-graphiql",level:3},{value:"Signing in as Administrator",id:"signing-in-as-administrator",level:4},{value:"Mutations",id:"mutations",level:4},{value:"Promote a Registered User to an Administrator",id:"promote-a-registered-user-to-an-administrator",level:5},{value:"Creating Organizations",id:"creating-organizations",level:5},{value:"Create an Organization Member",id:"create-an-organization-member",level:5},{value:"Queries",id:"queries",level:4},{value:"Query Organization Data",id:"query-organization-data",level:5},{value:"Query User Data with Organizations",id:"query-user-data-with-organizations",level:5},{value:"Database Management",id:"database-management",level:2},{value:"Interactive Production DB Access",id:"interactive-production-db-access",level:3},{value:"Interactive Test DB Access",id:"interactive-test-db-access",level:3},{value:"Modifying Tables (CLI)",id:"modifying-tables-cli",level:3},{value:"1. Remove Old Tables",id:"1-remove-old-tables",level:4},{value:"2. Remove Old Schema",id:"2-remove-old-schema",level:4},{value:"3. Remove Old Drizzle Migrations",id:"3-remove-old-drizzle-migrations",level:4},{value:"4. Generate New Drizzle Migrations",id:"4-generate-new-drizzle-migrations",level:4},{value:"5. Apply Migrations to the Database",id:"5-apply-migrations-to-the-database",level:4},{value:"6. Validation (Access Updated Tables)",id:"6-validation-access-updated-tables",level:4},{value:"Object Storage Management",id:"object-storage-management",level:2},{value:"MinIO Access in Production",id:"minio-access-in-production",level:3},{value:"MinIO Access in Development",id:"minio-access-in-development",level:3},{value:"Resetting Docker",id:"resetting-docker",level:2},{value:"Mock Isolation &amp; Cleanup",id:"mock-isolation--cleanup",level:2},{value:"The Rule",id:"the-rule",level:3},{value:"How to Implement",id:"how-to-implement",level:3},{value:"Choosing the Right Cleanup Method",id:"choosing-the-right-cleanup-method",level:3},{value:"Why?",id:"why",level:3},{value:"Verification",id:"verification",level:3},{value:"Environment Variables",id:"environment-variables-1",level:3},{value:"Troubleshooting",id:"troubleshooting",level:3}];function c(e){const n={a:"a",code:"code",em:"em",h2:"h2",h3:"h3",h4:"h4",h5:"h5",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.p,{children:"This section covers important tests to validate the operation of the API."}),"\n",(0,t.jsx)(n.h2,{id:"introduction",children:"Introduction"}),"\n",(0,t.jsx)(n.p,{children:"It is important to test our code. If you are a contributor, please follow the guidance on this page."}),"\n",(0,t.jsx)(n.h3,{id:"developers-using-microsoft-windows",children:"Developers Using Microsoft Windows"}),"\n",(0,t.jsx)(n.p,{children:"All our workflows use Linux based commands, therefore if you are a developer who codes in Microsoft Windows then we strongly suggest that you use the Windows Subsystem for Linux (WSL) as your command line interface (CLI)."}),"\n",(0,t.jsxs)(n.h3,{id:"the-tests-directory",children:["The ",(0,t.jsx)(n.code,{children:"tests/"})," Directory"]}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"tests/"})," directory contains the code for performing api tests against Talawa API. The tests in this directory and its various subdirectories must follow the practices of black box testing and most of them should be written to be able to run concurrently."]}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["Tests for files in the ",(0,t.jsx)(n.code,{children:"src/"})," directory must only be placed in the equivalent subdirectory under the ",(0,t.jsx)(n.code,{children:"tests/"})," directory."]}),"\n",(0,t.jsxs)(n.li,{children:["Test files must have a ",(0,t.jsx)(n.code,{children:".test.ts"})," extension."]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"The rest of this page will assist you in being an active contributor to the code base."}),"\n",(0,t.jsx)(n.h2,{id:"quick-start",children:"Quick Start"}),"\n",(0,t.jsx)(n.h3,{id:"running-tests",children:"Running Tests"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Run all tests:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"pnpm run check_tests\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Run specific test file:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"pnpm run check_tests -- /path/to/test/file\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Run with coverage:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"pnpm run run_tests\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Run with test sharding:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"pnpm run test:shard\n"})}),"\n",(0,t.jsx)(n.h3,{id:"linting-and-formatting",children:"Linting and Formatting"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Fix linting & formatting issues:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"pnpm run format:fix\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Check linting & formatting:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"pnpm run format:check\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Check for sanitization issues:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"pnpm run lint:sanitization\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Check TSDoc comments:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"pnpm run lint:tsdoc\n"})}),"\n",(0,t.jsx)(n.h3,{id:"type-checking",children:"Type Checking"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Run TypeScript type checker:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"pnpm run typecheck\n"})}),"\n",(0,t.jsx)(n.h2,{id:"code-coverage-flags",children:"Code Coverage Flags"}),"\n",(0,t.jsx)(n.p,{children:"We use Codecov flags to separate and track coverage metrics for different types of tests:"}),"\n",(0,t.jsx)(n.h3,{id:"unit-flag",children:"Unit Flag"}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"unit"})," flag tracks coverage for:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"test/unit/"}),": Unit tests for isolated logic"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"src/utilities/"}),": Utility functions"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"src/services/"}),": Service layer code"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"integration-flag",children:"Integration Flag"}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"integration"})," flag tracks coverage for:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"test/drizzle/"}),": Database integration tests"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"test/graphql/"}),": GraphQL API integration tests"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"test/install/"}),": Installation and setup tests"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"These flags allow us to monitor coverage separately on the Codecov dashboard, helping identify gaps in either unit or integration test coverage."}),"\n",(0,t.jsx)(n.h2,{id:"linting--static-analysis",children:"Linting & Static Analysis"}),"\n",(0,t.jsxs)(n.p,{children:["We use ",(0,t.jsx)(n.a,{href:"https://biomejs.dev/",children:"Biome"})," for linting and formatting. In addition to standard rules, we have custom plugins enabled to enforce security best practices."]}),"\n",(0,t.jsx)(n.h3,{id:"biome-plugins",children:"Biome Plugins"}),"\n",(0,t.jsx)(n.p,{children:"We have a custom GritQL plugin enabled to detect potential security issues."}),"\n",(0,t.jsx)(n.h4,{id:"require_escapehtml",children:(0,t.jsx)(n.code,{children:"require_escapeHTML"})}),"\n",(0,t.jsxs)(n.p,{children:["This plugin is designed to enhance security by detecting potential Cross-Site Scripting (XSS) vulnerabilities in Pothos GraphQL resolvers. It checks if ",(0,t.jsx)(n.code,{children:"t.string"})," fields with a ",(0,t.jsx)(n.code,{children:"resolve"})," function are using the ",(0,t.jsx)(n.code,{children:"escapeHTML"})," utility."]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"This feature is active and will impact testing results."})," If your code triggers this warning, you must address it either by sanitizing the output or by explicitly suppressing the warning if it is a false positive."]}),"\n",(0,t.jsx)(n.h5,{id:"why-is-this-important",children:"Why is this important?"}),"\n",(0,t.jsxs)(n.p,{children:["When returning user-generated content (like bios, descriptions, comments) in a GraphQL API, it is crucial to sanitize the output to prevent malicious scripts from being executed in the client's browser. The ",(0,t.jsx)(n.code,{children:"escapeHTML"})," function performs this sanitization."]}),"\n",(0,t.jsx)(n.h5,{id:"what-it-detects",children:"What it detects"}),"\n",(0,t.jsxs)(n.p,{children:["The plugin looks for ",(0,t.jsx)(n.code,{children:"t.string(...)"})," definitions that:"]}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["Have a ",(0,t.jsx)(n.code,{children:"resolve"})," property."]}),"\n",(0,t.jsxs)(n.li,{children:["Do ",(0,t.jsx)(n.strong,{children:"not"})," contain a call to ",(0,t.jsx)(n.code,{children:"escapeHTML(...)"})," within the resolver."]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Example that triggers a warning:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"t.string({\n  resolve: (parent) => parent.bio, // Warning: Missing escapeHTML\n});\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Example that passes:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:'import { escapeHTML } from "~/src/utilities/sanitizer";\n\nt.string({\n  resolve: (parent) => escapeHTML(parent.bio), // Safe\n});\n'})}),"\n",(0,t.jsx)(n.h5,{id:"false-positives--limitations",children:"False Positives & Limitations"}),"\n",(0,t.jsx)(n.p,{children:"This pattern is a heuristic and may flag safe code:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Safe Strings:"})," IDs, Enums, numbers converted to strings, or hardcoded strings do not need sanitization but will still be flagged if they are in a ",(0,t.jsx)(n.code,{children:"t.string"})," resolver."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"External Sanitization:"})," If you sanitize the string ",(0,t.jsx)(n.em,{children:"before"})," the resolver or in a separate function call that isn't named ",(0,t.jsx)(n.code,{children:"escapeHTML"}),", the plugin will not detect it.","\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"const safeBio = escapeHTML(user.bio);\nt.string({ resolve: () => safeBio });  // Warning: Plugin only sees the resolver body\n"})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Pattern Scope:"})," It currently only matches ",(0,t.jsx)(n.code,{children:"t.string(...)"}),". It does not catch ",(0,t.jsx)(n.code,{children:"t.field({ type: 'String', ... })"}),"."]}),"\n"]}),"\n",(0,t.jsx)(n.h5,{id:"how-to-suppress",children:"How to Suppress"}),"\n",(0,t.jsx)(n.p,{children:"If you are certain a field is safe (e.g., it returns a database ID), you can suppress the warning."}),"\n",(0,t.jsxs)(n.p,{children:["Since this is a custom GritQL plugin, standard ",(0,t.jsx)(n.code,{children:"biome-ignore"})," comments might not work depending on the Biome version and integration."]}),"\n",(0,t.jsxs)(n.p,{children:["If ",(0,t.jsx)(n.code,{children:"biome-ignore"})," does not work, you can exclude specific files in ",(0,t.jsx)(n.code,{children:"biome.jsonc"})," or refactor the code to make the safety explicit (e.g., using a helper function that includes ",(0,t.jsx)(n.code,{children:"escapeHTML"})," in its name, or just adding a comment explaining why it's safe if the warning is non-blocking)."]}),"\n",(0,t.jsx)(n.h2,{id:"testing-philosophy",children:"Testing Philosophy"}),"\n",(0,t.jsx)(n.p,{children:"Black box testing in this context means we test Talawa API from the perspective of a client making requests to it. This also means that we must only communicate with Talawa API during the tests with its publicly exposed interface."}),"\n",(0,t.jsx)(n.p,{children:"In the context of the rest api interfaces exposed by Talawa API it means making standard HTTP calls using methods like GET, POST, PATCH, PUT, DELETE etc., and asserting against the HTTP responses."}),"\n",(0,t.jsx)(n.p,{children:"In the context of the graphql api interfaces exposed by Talawa API it means triggering standard graphql query, mutation and subscription operations against the graphql api endpoint(over HTTP POST method for our use case) and asserting against the graphql responses."}),"\n",(0,t.jsx)(n.h3,{id:"unit-tests-vs-integration-testing",children:"Unit Tests vs Integration Testing"}),"\n",(0,t.jsx)(n.p,{children:"The current codebase has the simplest implementation for graphql which is doing everything within resolvers. It is good for now because it lets the project move fast, break things and quickly iterate on changes. When a stable api is reached, then the project can be architected into something that is more suited to unit tests."}),"\n",(0,t.jsx)(n.p,{children:"We started implementing integration tests because for the current requirements the best kind of testing is to ensure that the graphql operations return what they are expected to return when talawa clients make those operations."}),"\n",(0,t.jsx)(n.p,{children:"The GraphQL schema cannot be tested without running the graphql server itself because it is an internal implementation detail of the graphql engine. The old approach, when the API used a MongoDB backend, only tested the resolvers which does not account for this."}),"\n",(0,t.jsx)(n.p,{children:"The end users will be interacting with the graphql schema and not the typescript graphql resolvers. So, the tests should be written in a way that asserts against the runtime behavior of that graphql schema."}),"\n",(0,t.jsx)(n.h4,{id:"integration-testing",children:"Integration Testing"}),"\n",(0,t.jsx)(n.p,{children:"Based on this design, we only do integration testing for GraphQL queries and mutations in these folders."}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"src/Graphql/mutation"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"src/Graphql/query"})}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"NOTE:"})," No unit testing is done in these folders."]}),"\n",(0,t.jsx)(n.h4,{id:"unit-testing",children:"Unit Testing"}),"\n",(0,t.jsx)(n.p,{children:"We only do unit testing the return type of the Graphql types resolver in these folders."}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"src/graphql/types/*"})}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"NOTE:"})," No integration testing is done in these folders."]}),"\n",(0,t.jsx)(n.h3,{id:"directory-structure",children:"Directory Structure"}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"tests/server.ts"})," file exports the Talawa API server instance that can be imported and used in different api tests. This Talawa API server instance is shared between api tests."]}),"\n",(0,t.jsx)(n.p,{children:"There aren't any other strict structure requirements for the this directory."}),"\n",(0,t.jsx)(n.h3,{id:"mock-graphql-context-factory-function",children:"Mock GraphQL Context Factory Function"}),"\n",(0,t.jsxs)(n.h4,{id:"in-directory-test_mocks_mockcontextcreator",children:["In Directory ",(0,t.jsx)(n.code,{children:"test/_Mocks_/mockContextCreator"})]}),"\n",(0,t.jsx)(n.h4,{id:"purpose",children:"Purpose"}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"createMockGraphQLContext"})," function provides a ",(0,t.jsx)(n.strong,{children:"fully mocked GraphQL context"})," for unit and integration testing of GraphQL resolvers. It ensures that resolvers can be tested ",(0,t.jsx)(n.strong,{children:"without needing a real database, MinIO storage, or authentication service"})," and works as a centralized mocking mechanism."]}),"\n",(0,t.jsx)(n.h4,{id:"usage",children:"Usage"}),"\n",(0,t.jsx)(n.h4,{id:"importing-the-mock-context",children:"Importing the Mock Context"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:'import { createMockGraphQLContext } from "test/_Mocks_/mockContextCreator";\n'})}),"\n",(0,t.jsx)(n.h4,{id:"creating-a-mock-context",children:"Creating a Mock Context"}),"\n",(0,t.jsx)(n.h5,{id:"for-an-unauthenticated-user",children:"For an Unauthenticated User"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"const { context, mocks } = createMockGraphQLContext({ isAuthenticated: false });\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"context.currentClient.isAuthenticated"})," will be ",(0,t.jsx)(n.code,{children:"false"}),"."]}),"\n",(0,t.jsx)(n.h5,{id:"for-an-authenticated-user",children:"For an Authenticated User"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:'const { context, mocks } = createMockGraphQLContext({\n  isAuthenticated: true,\n  userId: "user123",\n});\n'})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"context.currentClient.user.id"})," will be ",(0,t.jsx)(n.code,{children:'"user123"'}),"."]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h4,{id:"components-in-mock-context",children:"Components in Mock Context"}),"\n",(0,t.jsx)(n.p,{children:"The mock context provides the following:"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Component"}),(0,t.jsx)(n.th,{children:"Description"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"currentClient"})}),(0,t.jsx)(n.td,{children:"Simulates authenticated/unauthenticated users."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"drizzleClient"})}),(0,t.jsxs)(n.td,{children:["Mocked database client (",(0,t.jsx)(n.code,{children:"createMockDrizzleClient"}),")."]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"envConfig"})}),(0,t.jsxs)(n.td,{children:["Mocked environment variables (",(0,t.jsx)(n.code,{children:"API_BASE_URL"}),")."]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"jwt.sign"})}),(0,t.jsxs)(n.td,{children:["Mocked JWT generator (",(0,t.jsx)(n.code,{children:"vi.fn()"})," returning a test token)."]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"log"})}),(0,t.jsxs)(n.td,{children:["Mocked logger (",(0,t.jsx)(n.code,{children:"createMockLogger"}),")."]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"minio"})}),(0,t.jsxs)(n.td,{children:["Mocked MinIO client for object storage (",(0,t.jsx)(n.code,{children:"createMockMinioClient"}),")."]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"pubsub"})}),(0,t.jsxs)(n.td,{children:["Mocked pub-sub system for GraphQL subscriptions (",(0,t.jsx)(n.code,{children:"createMockPubSub"}),")."]})]})]})]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h4,{id:"return-value",children:"Return Value"}),"\n",(0,t.jsx)(n.p,{children:"The function returns an object with two properties:"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Property"}),(0,t.jsx)(n.th,{children:"Description"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"context"})}),(0,t.jsx)(n.td,{children:"The complete mocked GraphQL context to pass to resolvers"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"mocks"})}),(0,t.jsx)(n.td,{children:"Direct access to individual mock instances for setting expectations"})]})]})]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h3,{id:"how-contributors-should-use-it",children:"How Contributors Should Use It"}),"\n",(0,t.jsx)(n.p,{children:"Follow these steps:"}),"\n",(0,t.jsx)(n.h4,{id:"unit-testing-resolvers-with-exposed-mocks-for-verification",children:"Unit Testing Resolvers (With exposed mocks for verification)"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:'test("should return user data", async () => {\n  // Create context with mocks\n  const { context, mocks } = createMockGraphQLContext({\n    isAuthenticated: true,\n    userId: "user123",\n  });\n\n  // Configure mock behavior if needed\n  mocks.drizzleClient.query.mockResolvedValue([\n    { id: "user123", name: "Test User" },\n  ]);\n\n  // Call your resolver\n  const result = await userResolver({}, {}, context);\n\n  // Verify results\n  expect(result.id).toBe("user123");\n\n  // Verify interactions with dependencies\n  expect(mocks.drizzleClient.query).toHaveBeenCalledWith(\n    expect.stringContaining("SELECT"),\n    expect.arrayContaining(["user123"])\n  );\n});\n'})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h3,{id:"key-benefits",children:"Key Benefits"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Exposed Mocks"})," \u2013 Direct access to mock instances for setting expectations and verifying calls."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Type Safety"})," \u2013 Proper TypeScript typing for all mocked components."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Scalable"})," \u2013 Any future changes in ",(0,t.jsx)(n.code,{children:"GraphQLContext"})," can be updated in one place, ensuring a single source of truth."]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"simplified-call-signature",children:(0,t.jsx)(n.strong,{children:"Simplified Call Signature"})}),"\n",(0,t.jsx)(n.p,{children:"The function supports both simple and object-based parameter styles:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:'// Legacy style (still supported)\nconst { context, mocks } = createMockGraphQLContext(true, "user123");\n\n// New object-based style (recommended)\nconst { context, mocks } = createMockGraphQLContext({\n  isAuthenticated: true,\n  userId: "user123",\n});\n'})}),"\n",(0,t.jsx)(n.h3,{id:"graphql-resolver-type-safety-guidelines",children:"GraphQL Resolver Type Safety Guidelines"}),"\n",(0,t.jsx)(n.h4,{id:"best-practices",children:"Best Practices"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Use Schema-Generated Types Only"}),"\n"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Derive types from ",(0,t.jsx)(n.code,{children:"context.ts"})," and GraphQL schema. Avoid custom types."]}),"\n"]}),"\n",(0,t.jsxs)(n.ol,{start:"2",children:["\n",(0,t.jsxs)(n.li,{children:["Stick to ",(0,t.jsx)(n.code,{children:"GraphQLContext"})]}),"\n"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["All resolvers must use ",(0,t.jsx)(n.code,{children:"GraphQLContext"})," from ",(0,t.jsx)(n.code,{children:"context.ts"}),"."]}),"\n"]}),"\n",(0,t.jsxs)(n.ol,{start:"3",children:["\n",(0,t.jsx)(n.li,{children:"Leverage Drizzle ORM Types"}),"\n"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Use ",(0,t.jsx)(n.code,{children:"typeof table.$inferSelect"})," for entity types. Never define manually."]}),"\n"]}),"\n",(0,t.jsxs)(n.ol,{start:"4",children:["\n",(0,t.jsx)(n.li,{children:"Only detach if needed for mock testing and ensure it follows correct typeSafety"}),"\n"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h4,{id:"correct-example",children:"Correct Example"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:'\nimport { eq } from "drizzle-orm";\nimport { eventsTable } from "~/src/drizzle/tables/events";\nimport type { GraphQLContext } from "../../context";\ntype EventsTable = typeof eventsTable.$inferSelect;\nexport const resolver = async (\n  parent: EventsTable,\n  _args: Record<string, never>,\n  ctx: GraphQLContext,\n) => {\n  if (!ctx.currentClient.isAuthenticated) throw new Error("Authentication required");\n  return ctx.drizzleClient.query.usersTable.findFirst({\n    where: eq(ctx.usersTable.id, parent.updaterId),\n  });\n};\n\n'})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h4,{id:"incorrect-example",children:"Incorrect Example"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:'\nimport type { CustomContextType } from "../../customContext"; //  Custom context\nimport type { EventType } from "../../types/Event"; //  Manual type\nexport const resolver = async (\n  parent: EventType, //  Avoid this\n  _args: Record<string, never>,\n  ctx: CustomContextType, //  Avoid this\n) => { /* Inconsistent and error-prone */ };\n\n'})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h4,{id:"key-rules",children:"Key Rules"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Always use ",(0,t.jsx)(n.code,{children:"GraphQLContext"})," from ",(0,t.jsx)(n.code,{children:"context.ts"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:["Use ",(0,t.jsx)(n.code,{children:"typeof table.$inferSelect"})," for Drizzle entities."]}),"\n",(0,t.jsx)(n.li,{children:"Never define custom types for resolvers."}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"This ensures type safety and consistency across your GraphQL resolvers."}),"\n",(0,t.jsx)(n.h3,{id:"future-considerations",children:"Future Considerations"}),"\n",(0,t.jsx)(n.p,{children:"In the future, there might be a requirement to run some tests sequentially. When that moment arrives, separating sequential and parallel tests into separate directories and using separate Vitest configuration for them would be the best idea."}),"\n",(0,t.jsx)(n.h3,{id:"writing-reliable-concurrent-tests",children:"Writing Reliable Concurrent Tests"}),"\n",(0,t.jsx)(n.p,{children:"Here are the guidelines for writing non-flaky tests that are able to run concurrently or in parallel:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"All tests must set up their own data to get the application to their desired state. Tests must not assume that the data they need to act on can be dervied from other tests or could pre-exist."}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"All tests must perform write operations only on data associated to them. Tests must not in any way perform write operations on data that isn't associated to them because it could lead to disruption of other tests. The best way to ensure this is to introduce uniqueness to the data created within tests through the usage of cryptographic identifier generators like uuid, cuid, nanoid etc."}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"All tests must either assert against data associated to them or they must change their assertion logic to something that suits asserting against random data."}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Example test suites 1 and 2 depicting the violations and followage of these guidelines:"}),"\n",(0,t.jsx)(n.h4,{id:"guideline-violation-example",children:"Guideline Violation Example"}),"\n",(0,t.jsx)(n.p,{children:"This example show a violation of the guidelines."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:'// Test suite 1\nsuite.concurrent("flaky concurrent tests", async () => {\n  test.concurrent("create user test", async () => {\n    const userData = {\n      id: "1",\n      name: "user1",\n    };\n    const createdUsers = await fetch.post("/users", {\n      body: [userData],\n    });\n    expect(createdUsers[0]).toEqual(userData);\n  });\n\n  test.concurrent("get user test", async () => {\n    const user = await fetch.get("/users/1");\n    expect(user).toEqual({\n      id: "1",\n      name: "user1",\n    });\n  });\n\n  test.concurrent("update user test", async () => {\n    const updatedUser = await fetch.update("/user/1", {\n      body: {\n        name: "updatedUser1",\n      },\n    });\n    expect(updatedUser).toEqual({\n      id: "1",\n      name: "updatedUser1",\n    });\n  });\n\n  test.concurrent("delete user test", async () => {\n    const deletedUser = await fetch.delete("/user/1");\n    expect(deletedUser).toEqual({\n      id: "1",\n      name: "user1",\n    });\n  });\n\n  test.concurrent("get users test", async () => {\n    await fetch.post("/users", {\n      body: [\n        {\n          id: "2",\n          name: "user2",\n        },\n        {\n          id: "3",\n          name: "user3",\n        },\n        {\n          id: "4",\n          name: "user4",\n        },\n      ],\n    });\n    const users = await fetch.get("/users");\n    expect(users).toHaveLength(3);\n  });\n});\n'})}),"\n",(0,t.jsx)(n.h4,{id:"guideline-compliance-example",children:"Guideline Compliance Example"}),"\n",(0,t.jsx)(n.p,{children:"This example shows compliance with the guidelines."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:'// Test suite 2\nsuite.concurrent("non-flaky concurrent tests", async () => {\n  test.concurrent("create user test", async () => {\n    const userData = {\n      id: randomIdGenerator(),\n      name: `name${randomIdGenerator()}`,\n    };\n    const createdUsers = await fetch.post("/users", {\n      body: [userData],\n    });\n    expect(createdUsers[0]).toEqual(userData);\n  });\n\n  test.concurrent("get user test", async () => {\n    const userData = {\n      id: randomIdGenerator(),\n      name: `name${randomIdGenerator()}`,\n    };\n    await fetch.post("/users", {\n      body: [userData],\n    });\n    const user = await fetch.get(`/users/${userData.id}`);\n    expect(user).toEqual(userData);\n  });\n\n  test.concurrent("update user test", async () => {\n    const userData = {\n      id: randomIdGenerator(),\n      name: `name${randomIdGenerator()}`,\n    };\n    await fetch.post("/users", {\n      body: [userData],\n    });\n    const newName = `newName${randomIdGenerator()}`;\n    const updatedUser = await fetch.update(`/users/${userData.id}`, {\n      body: {\n        name: newName,\n      },\n    });\n    expect(updatedUser).toEqual({\n      id: userData.id,\n      name: newName,\n    });\n  });\n\n  test.concurrent("delete user test", async () => {\n    const userData = {\n      id: randomIdGenerator(),\n      name: `name${randomIdGenerator()}`,\n    };\n    await fetch.post("/users", {\n      body: [userData],\n    });\n    const deletedUser = await fetch.delete(`/users/${userData.id}`);\n    expect(deletedUser).toEqual(userData);\n  });\n\n  test.concurrent("get users test", async () => {\n    const userDataList = [\n      {\n        id: randomIdGenerator(),\n        name: `name${randomIdGenerator()}`,\n      },\n      {\n        id: randomIdGenerator(),\n        name: `name${randomIdGenerator()}`,\n      },\n      {\n        id: randomIdGenerator(),\n        name: `name${randomIdGenerator()}`,\n      },\n    ];\n    await fetch.post("/users", {\n      body: userDataList,\n    });\n    const users = await fetch.get("/users");\n    expect(users).length.greaterThanOrEqual(3);\n  });\n});\n'})}),"\n",(0,t.jsx)(n.h2,{id:"test-db-usage",children:"Test DB Usage"}),"\n",(0,t.jsx)(n.p,{children:"Here is some important information about how the test DB is used both for your tests and the CI/CD pipeline."}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["The ",(0,t.jsx)(n.code,{children:"postgres-test"})," database is strictly meant for testing in all environments. The environment variable value of ",(0,t.jsx)(n.code,{children:"API_POSTGRES_HOST"})," is overwritten from ",(0,t.jsx)(n.code,{children:"postgres"})," to ",(0,t.jsx)(n.code,{children:"postgres-test"})," in all environments where tests are run as shown in ",(0,t.jsx)(n.code,{children:"/test/server.ts"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:["The ",(0,t.jsx)(n.code,{children:"postgres"})," service is not enabled in the CI environment as can be seen in the ",(0,t.jsx)(n.code,{children:"COMPOSE_PROFILES"})," environment variable in ",(0,t.jsx)(n.code,{children:"envFiles/.env.ci"}),". Only the ",(0,t.jsx)(n.code,{children:"postgres_test"})," service is enabled in the CI environment."]}),"\n",(0,t.jsxs)(n.li,{children:["We use two database containers for ",(0,t.jsx)(n.code,{children:"postgres"})," and ",(0,t.jsx)(n.code,{children:"postgres_test"}),", not two databases in a single container because the latter goes against the philosophy of containerization."]}),"\n",(0,t.jsxs)(n.li,{children:["The ",(0,t.jsx)(n.code,{children:"test/"})," folder has an environment variables schema defined in ",(0,t.jsx)(n.code,{children:"test/envConfigSchema.ts"}),". To access ",(0,t.jsx)(n.code,{children:"API_POSTGRES_TEST_HOST"})," you just pass the schema to ",(0,t.jsx)(n.code,{children:"env-schema"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:["We don't use ",(0,t.jsx)(n.code,{children:"postgres_test"})," in the ",(0,t.jsx)(n.code,{children:".env.ci"})," file because the CI/CD pipeline isn't limited to testing. We did this to be future proof."]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"environment-variables",children:"Environment Variables"}),"\n",(0,t.jsxs)(n.p,{children:["If you need to overwrite the environment variables, you have to allow passing those environment variables as arguments as in the createServer function in the ",(0,t.jsx)(n.code,{children:"src/createServer.ts"})," file. This is how ",(0,t.jsx)(n.code,{children:"API_POSTGRES_HOST"})," and ",(0,t.jsx)(n.code,{children:"API_MINIO_END_POINT"})," are overwritten in the tests as explained previously."]}),"\n",(0,t.jsx)(n.h2,{id:"sample-db-login-credentials",children:"Sample DB Login Credentials"}),"\n",(0,t.jsx)(n.p,{children:"If the API:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["is running with an unmodified ",(0,t.jsx)(n.code,{children:".env"})," file copied from ",(0,t.jsx)(n.code,{children:"envFiles/.env.devcontainer"})," and;"]}),"\n",(0,t.jsx)(n.li,{children:"the API sample database is loaded;\nthen you can use these login credentials to access the API via various clients."}),"\n"]}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Email"}),(0,t.jsx)(n.th,{children:"Password"}),(0,t.jsx)(n.th,{children:"User Type"}),(0,t.jsx)(n.th,{children:"Joined Organization"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.a,{href:"mailto:administrator@email.com",children:"administrator@email.com"})}),(0,t.jsx)(n.td,{children:"password"}),(0,t.jsx)(n.td,{children:"Administrator"}),(0,t.jsx)(n.td,{children:"N/A"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.a,{href:"mailto:testsuperadmin@example.com",children:"testsuperadmin@example.com"})}),(0,t.jsx)(n.td,{children:"Pass@123"}),(0,t.jsx)(n.td,{children:"Administrator"}),(0,t.jsx)(n.td,{children:"N/A"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.a,{href:"mailto:testadmin1@example.com",children:"testadmin1@example.com"})}),(0,t.jsx)(n.td,{children:"Pass@123"}),(0,t.jsx)(n.td,{children:"Administrator"}),(0,t.jsx)(n.td,{children:"N/A"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.a,{href:"mailto:testadmin2@example.com",children:"testadmin2@example.com"})}),(0,t.jsx)(n.td,{children:"Pass@123"}),(0,t.jsx)(n.td,{children:"Administrator"}),(0,t.jsx)(n.td,{children:"N/A"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.a,{href:"mailto:testadmin3@example.com",children:"testadmin3@example.com"})}),(0,t.jsx)(n.td,{children:"Pass@123"}),(0,t.jsx)(n.td,{children:"Administrator"}),(0,t.jsx)(n.td,{children:"N/A"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.a,{href:"mailto:testuser1@example.com",children:"testuser1@example.com"})}),(0,t.jsx)(n.td,{children:"Pass@123"}),(0,t.jsx)(n.td,{children:"Regular"}),(0,t.jsx)(n.td,{children:"N/A"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.a,{href:"mailto:testuser2@example.com",children:"testuser2@example.com"})}),(0,t.jsx)(n.td,{children:"Pass@123"}),(0,t.jsx)(n.td,{children:"Regular"}),(0,t.jsx)(n.td,{children:"N/A"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.a,{href:"mailto:testuser3@example.com",children:"testuser3@example.com"})}),(0,t.jsx)(n.td,{children:"Pass@123"}),(0,t.jsx)(n.td,{children:"Regular"}),(0,t.jsx)(n.td,{children:"N/A"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.a,{href:"mailto:testuser4@example.com",children:"testuser4@example.com"})}),(0,t.jsx)(n.td,{children:"Pass@123"}),(0,t.jsx)(n.td,{children:"Regular"}),(0,t.jsx)(n.td,{children:"N/A"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.a,{href:"mailto:testuser5@example.com",children:"testuser5@example.com"})}),(0,t.jsx)(n.td,{children:"Pass@123"}),(0,t.jsx)(n.td,{children:"Regular"}),(0,t.jsx)(n.td,{children:"N/A"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.a,{href:"mailto:testuser6@example.com",children:"testuser6@example.com"})}),(0,t.jsx)(n.td,{children:"Pass@123"}),(0,t.jsx)(n.td,{children:"Regular"}),(0,t.jsx)(n.td,{children:"N/A"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.a,{href:"mailto:testuser7@example.com",children:"testuser7@example.com"})}),(0,t.jsx)(n.td,{children:"Pass@123"}),(0,t.jsx)(n.td,{children:"Regular"}),(0,t.jsx)(n.td,{children:"N/A"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.a,{href:"mailto:testuser8@example.com",children:"testuser8@example.com"})}),(0,t.jsx)(n.td,{children:"Pass@123"}),(0,t.jsx)(n.td,{children:"Regular"}),(0,t.jsx)(n.td,{children:"N/A"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.a,{href:"mailto:testuser9@example.com",children:"testuser9@example.com"})}),(0,t.jsx)(n.td,{children:"Pass@123"}),(0,t.jsx)(n.td,{children:"Regular"}),(0,t.jsx)(n.td,{children:"N/A"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.a,{href:"mailto:testuser10@example.com",children:"testuser10@example.com"})}),(0,t.jsx)(n.td,{children:"Pass@123"}),(0,t.jsx)(n.td,{children:"Regular"}),(0,t.jsx)(n.td,{children:"N/A"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.a,{href:"mailto:testuser11@example.com",children:"testuser11@example.com"})}),(0,t.jsx)(n.td,{children:"Pass@123"}),(0,t.jsx)(n.td,{children:"Regular"}),(0,t.jsx)(n.td,{children:"N/A"})]})]})]}),"\n",(0,t.jsx)(n.h2,{id:"accessing-the-api",children:"Accessing the API"}),"\n",(0,t.jsx)(n.p,{children:"These are some important URLs for coding and troubleshooting:"}),"\n",(0,t.jsx)(n.h3,{id:"validation",children:"Validation"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"By default talawa-api runs on port 4000. It is available on the following endpoint:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"http://127.0.0.1:4000\n"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"If you navigate to the endpoint you and see a JSON response like this."}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "message": "Route GET:/ not found",\n  "error": "Not Found",\n  "statusCode": 404\n}\n'})}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"graphql",children:"GraphQL"}),"\n",(0,t.jsx)(n.p,{children:"This section covers how to access the GraphQL API interface."}),"\n",(0,t.jsx)(n.h4,{id:"interactive-web-queries-with-graphiql",children:"Interactive Web Queries With GraphiQL"}),"\n",(0,t.jsx)(n.p,{children:"You can use GraphiQL to test your GraphQL queries interactively via a web page."}),"\n",(0,t.jsx)(n.p,{children:"The url for accessing the GraphQL Playground is:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"http://127.0.0.1:4000/graphiql\n"})}),"\n",(0,t.jsx)(n.h4,{id:"programmatic-queries-with-graphql",children:"Programmatic Queries With GraphQL"}),"\n",(0,t.jsxs)(n.p,{children:["The graphQL endpoint for handling ",(0,t.jsx)(n.code,{children:"queries"})," and ",(0,t.jsx)(n.code,{children:"mutations"})," is this:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"http://127.0.0.1:4000/graphql\n"})}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["This is the Organization URL to be used for:","\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"The Talawa Mobile app"}),"\n",(0,t.jsx)(n.li,{children:"The Talawa Admin app"}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.li,{children:"If you navigate to the endpoint you and see a JSON response like this."}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{ "data": null, "errors": [{ "message": "Unknown query" }] }\n'})}),"\n",(0,t.jsx)(n.h4,{id:"subscriptions-with-graphql",children:"Subscriptions with GraphQL"}),"\n",(0,t.jsxs)(n.p,{children:["The GraphQL endpoint for handling ",(0,t.jsx)(n.code,{children:"subscriptions"})," is:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"ws://127.0.0.1:4000/graphql\n"})}),"\n",(0,t.jsx)(n.h4,{id:"accessing-the-api-in-talawa-app-using-remote-access",children:"Accessing the API in Talawa App Using Remote Access"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Launch the terminal application on your device."}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Retrieve IPv4 Address:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"For Windows Users"}),": Enter the command ",(0,t.jsx)(n.code,{children:"ipconfig"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"For Linux/OSX Users"}),": Enter the command ",(0,t.jsx)(n.code,{children:"ifconfig"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:["Copy the ",(0,t.jsx)(n.code,{children:"IPv4 Address"})," displayed (e.g., ",(0,t.jsx)(n.code,{children:"192.168.12.233"}),")."]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Make sure both your mobile and your computer are connected to the same network."}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Use the following format for your endpoint:"}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"http://<IPv4 address>:4000/graphql\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Replace ",(0,t.jsx)(n.code,{children:"<IPv4 Address>"})," with the actual IP address you copied in step 2."]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Note"}),": In the Talawa app, type the endpoint URL in the field labeled ",(0,t.jsx)(n.code,{children:"Enter Community URL"}),"."]}),"\n",(0,t.jsx)(n.h2,{id:"interactive-testing",children:"Interactive Testing"}),"\n",(0,t.jsxs)(n.p,{children:["Use the ",(0,t.jsx)(n.code,{children:"API_BASE_URL"})," URL configured in the ",(0,t.jsx)(n.code,{children:".env"})," file. As the endpoint uses GraphQL, the complete URL will be ",(0,t.jsx)(n.code,{children:"API_BASE_URL/graphql"})]}),"\n",(0,t.jsx)(n.h3,{id:"using-curl",children:"Using Curl"}),"\n",(0,t.jsx)(n.p,{children:"This section shows how to do some basic transactions using CURL"}),"\n",(0,t.jsx)(n.h4,{id:"sign-in",children:"Sign-in"}),"\n",(0,t.jsx)(n.p,{children:"This endpoint is used to sign in a user."}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Request:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'\ncurl -X POST -H "Content-Type: application/json" -k <API_BASE_URL>/graphql -d \'{\n  "query": "query signIn($input: QuerySignInInput!) { signIn(input: $input) { authenticationToken user { emailAddress id name } } }",\n  "variables": {\n    "input": {\n      "emailAddress": "administrator@email.com",\n      "password": "password"\n    }\n  }\n}\'\n\n'})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Request Headers:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"Content-Type: application/json"})}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Request Body:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "query": "query signIn($input: QuerySignInInput!) { signIn(input: $input) { authenticationToken user { emailAddress id name } } }",\n  "variables": {\n    "input": {\n      "emailAddress": "administrator@email.com",\n      "password": "password"\n    }\n  }\n}\n'})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Response:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Returns the authentication token and user details (email address, id, and name)."}),"\n"]}),"\n",(0,t.jsx)(n.h4,{id:"organization-creation",children:"Organization Creation"}),"\n",(0,t.jsx)(n.p,{children:"This endpoint is used to create a new organization."}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Request:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'curl -X POST -H "Content-Type: application/json" -H "Authorization: Bearer <your_token>" -k  <API_BASE_URL>/graphql -d \'{\n  "query": "mutation Mutation_createOrganization($input: MutationCreateOrganizationInput!) { createOrganization(input: $input) { id name } }",\n  "variables": {\n    "input": {\n      "name": "name0"\n    }\n  }\n}\'\n'})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Request Headers:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"Content-Type: application/json"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"Authorization: Bearer <your_token>"})}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Request Body:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "query": "mutation Mutation_createOrganization($input: MutationCreateOrganizationInput!) { createOrganization(input: $input) { id name } }",\n  "variables": {\n    "input": {\n      "name": "name0"\n    }\n  }\n}\n'})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Response:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Returns the newly created organization's ID and name."}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"using-graphiql",children:"Using GraphiQL"}),"\n",(0,t.jsx)(n.p,{children:"Here are some basic commands you can use for testing"}),"\n",(0,t.jsx)(n.h4,{id:"signing-in-as-administrator",children:"Signing in as Administrator"}),"\n",(0,t.jsxs)(n.p,{children:["Use the following GraphQL ",(0,t.jsx)(n.strong,{children:"query"})," to get an ",(0,t.jsx)(n.strong,{children:"authentication token"})," for authorization in later queries:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-graphql",children:'query {\n  signIn(\n    input: { emailAddress: "administrator@email.com", password: "password" }\n  ) {\n    authenticationToken\n    user {\n      id\n      name\n    }\n  }\n}\n'})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Example Response:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "data": {\n    "signIn": {\n      "authenticationToken": "YWQ2LWE2OTctMjZjYmFlYjEyYTI1In0sImlhdCI6MTceyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyIjp7ImlkIjoiMDE5NGM5MWQtMDQzYS03zODkzOTM3MiwiZXhwIjo0MzMwOTM5MzcyfQ.jVH3un6CBQ62aD_eXIwghoaQ6ak4ZnYfLgz6uDuZbrM",\n      "user": {\n        "id": "0194c91d-043a-7ad6-a697-26cbaeb12a25",\n        "name": "administrator"\n      }\n    }\n  }\n}\n'})}),"\n",(0,t.jsx)(n.h4,{id:"mutations",children:"Mutations"}),"\n",(0,t.jsx)(n.p,{children:"This section explains how to use interactive GraphQL to make changes to the database."}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"NOTE:"})," For all mutations, make sure the Headers section at the bottom of the page has the Authorization Bearer type method. Use the ",(0,t.jsx)(n.code,{children:"authenticationToken"})," received during login step above. We use that value received previously in this example."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "Authorization": "Bearer YWQ2LWE2OTctMjZjYmFlYjEyYTI1In0sImlhdCI6MTceyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyIjp7ImlkIjoiMDE5NGM5MWQtMDQzYS03zODkzOTM3MiwiZXhwIjo0MzMwOTM5MzcyfQ.jVH3un6CBQ62aD_eXIwghoaQ6ak4ZnYfLgz6uDuZbrM"\n}\n'})}),"\n",(0,t.jsx)(n.h5,{id:"promote-a-registered-user-to-an-administrator",children:"Promote a Registered User to an Administrator"}),"\n",(0,t.jsxs)(n.p,{children:["Use the following GraphQL ",(0,t.jsx)(n.strong,{children:"mutation"})," to assign ",(0,t.jsx)(n.strong,{children:"administrator"})," role to user:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-graphql",children:'mutation {\n  updateUser(input: { id: "user-id", role: administrator }) {\n    id\n    name\n  }\n}\n'})}),"\n",(0,t.jsx)(n.h5,{id:"creating-organizations",children:"Creating Organizations"}),"\n",(0,t.jsxs)(n.p,{children:["Use the following GraphQL ",(0,t.jsx)(n.strong,{children:"mutation"})," to create an organization:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-graphql",children:'mutation {\n  createOrganization(\n    input: {\n      addressLine1: "Los Angeles"\n      addressLine2: "USA"\n      city: "Los Angeles"\n      countryCode: in\n      description: "testing"\n      name: "Test Org 7"\n      postalCode: "876876"\n      state: "California"\n    }\n  ) {\n    id\n  }\n}\n'})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Example Response:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "data": {\n    "createOrganization": {\n      "id": "0194e104-31df-7906-a221-90d80ff27582"\n    }\n  }\n}\n'})}),"\n",(0,t.jsx)(n.h5,{id:"create-an-organization-member",children:"Create an Organization Member"}),"\n",(0,t.jsxs)(n.p,{children:["This ",(0,t.jsx)(n.strong,{children:"mutation"})," is used to add a member to an organization and assign them a role."]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Administrators can add other users and assign roles (administrator or regular)."}),"\n",(0,t.jsx)(n.li,{children:"Non-administrators can only add themselves to an organization."}),"\n",(0,t.jsx)(n.li,{children:"Non-administrators cannot assign roles while adding themselves; they will be assigned the default role (regular)."}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"The example below shows how to add an administrator to an organization:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-graphql",children:'mutation {\n  createOrganizationMembership(\n    input: {\n      memberId: "user-id"\n      organizationId: "org-id"\n      role: administrator\n    }\n  ) {\n    id\n    name\n    addressLine1\n    createdAt\n    members(first: 5) {\n      pageInfo {\n        hasNextPage\n        startCursor\n      }\n      edges {\n        cursor\n        node {\n          id\n          name\n        }\n      }\n    }\n  }\n}\n'})}),"\n",(0,t.jsx)(n.h4,{id:"queries",children:"Queries"}),"\n",(0,t.jsx)(n.p,{children:"This section explains how to use interactive GraphQL to query the database."}),"\n",(0,t.jsx)(n.h5,{id:"query-organization-data",children:"Query Organization Data"}),"\n",(0,t.jsxs)(n.p,{children:["Use the following GraphQL ",(0,t.jsx)(n.strong,{children:"query"})," to query organization data:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-graphql",children:'{\n  organization(input: { id: "0194e11a-1d2f-7425-b447-84e641687570" }) {\n    id\n    name\n    description\n    addressLine1\n    addressLine2\n    city\n    postalCode\n    state\n    countryCode\n  }\n}\n'})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Example Response:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "data": {\n    "organization": {\n      "id": "0194e11a-1d2f-7425-b447-84e641687570",\n      "name": "Test Org 27",\n      "description": "testing",\n      "addressLine1": "Los Angeles",\n      "addressLine2": "USA",\n      "city": "Los Angeles",\n      "postalCode": "876876",\n      "state": "California",\n      "countryCode": "in"\n    }\n  }\n}\n'})}),"\n",(0,t.jsx)(n.h5,{id:"query-user-data-with-organizations",children:"Query User Data with Organizations"}),"\n",(0,t.jsxs)(n.p,{children:["Use the following GraphQL ",(0,t.jsx)(n.strong,{children:"query"})," to query user data including a list of organizations the user is a member of:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-graphql",children:'query {\n  user(input: { id: "user-id" }) {\n    name\n    emailAddress\n    organizationsWhereMember(first: 5, after: null, before: null, last: null) {\n      edges {\n        node {\n          id\n          name\n        }\n      }\n    }\n  }\n}\n'})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Request Headers:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"Content-Type: application/json"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"Authorization: Bearer <your_token>"})}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Example Response:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "data": {\n    "user": {\n      "name": "administrator",\n      "emailAddress": "administrator@email.com",\n      "organizationsWhereMember": {\n        "edges": [\n          {\n            "node": {\n              "id": "019527e1-2f4a-7a89-94b6-193a3e9dfd76",\n              "name": "Test Org 7"\n            }\n          },\n          {\n            "node": {\n              "id": "cd3e4f5b-6a7c-8d9e-0f1a-2b3c4d5e6f7a",\n              "name": "Unity Foundation 3"\n            }\n          },\n          {\n            "node": {\n              "id": "bc2d3e4f-5a6b-7c8d-9e0f-1a2b3c4d5e6f",\n              "name": "Unity Foundation 4"\n            }\n          },\n          {\n            "node": {\n              "id": "ab1c2d3e-4f5b-6a7c-8d9e-0f1a2b3c4d5f",\n              "name": "Unity Foundation 2"\n            }\n          },\n          {\n            "node": {\n              "id": "ab1c2d3e-4f5b-6a7c-8d9e-0f1a2b3c4d5e",\n              "name": "Unity Foundation 1"\n            }\n          }\n        ]\n      }\n    }\n  }\n}\n'})}),"\n",(0,t.jsx)(n.h2,{id:"database-management",children:"Database Management"}),"\n",(0,t.jsx)(n.p,{children:"This section covers easy ways for developers to validate their work by examining the database."}),"\n",(0,t.jsx)(n.p,{children:"We use CloudBeaver which is a lightweight web application designed for comprehensive data management. It allows you to work with various data sources, including SQL, NoSQL, and cloud databases, all through a single secure cloud solution accessible via a browser."}),"\n",(0,t.jsx)(n.h3,{id:"interactive-production-db-access",children:"Interactive Production DB Access"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["Open your preferred browser and navigate to:","\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"http://127.0.0.1:8978/\n"})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["Log in to the CloudBeaver UI using the following credentials (these credentials can be modified in the ",(0,t.jsx)(n.code,{children:".env.devcontainer"})," file by changing the ",(0,t.jsx)(n.code,{children:"CLOUDBEAVER_ADMIN_NAME"})," and ",(0,t.jsx)(n.code,{children:"CLOUDBEAVER_ADMIN_PASSWORD"})," variables):","\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"Username: talawa\nPassword: password\n"})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:['You should now see the CloudBeaver UI. Click on the "New Connection" button and select ',(0,t.jsx)(n.code,{children:"PostgreSQL"})," from the list of available connections."]}),"\n",(0,t.jsxs)(n.li,{children:["Fill in the connection details as follows:","\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"Name: talawa\nHost: postgres\nPort: 5432\nDatabase: talawa\nUsername: talawa\nPassword: password\n"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Note:"})," The host name should match the one specified in the Docker Compose file and credentials should match those specified in the ",(0,t.jsx)(n.code,{children:".env.development"})," file."]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["Check the ",(0,t.jsx)(n.code,{children:"Save credentials for all users with access"})," option to avoid entering the credentials each time."]}),"\n",(0,t.jsxs)(n.li,{children:["Check the following boxes in the Database list:","\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"show all databases\nshow template databases\nshow unavailable databases\nshow database statistics\n"})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["Click ",(0,t.jsx)(n.code,{children:"Create"})," to save the connection."]}),"\n",(0,t.jsxs)(n.li,{children:["You should now see the ",(0,t.jsx)(n.code,{children:"PostgreSql@postgres"})," connection in the list of available connections. Click on the connection to open the database."]}),"\n",(0,t.jsxs)(n.li,{children:["Navigate to ",(0,t.jsx)(n.code,{children:"PostgreSql@postgres > Databases > talawa > Schemas > public > Tables"})," to view the available schemas."]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"interactive-test-db-access",children:"Interactive Test DB Access"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["Click on the ",(0,t.jsx)(n.code,{children:"New Connection"})," button and select ",(0,t.jsx)(n.code,{children:"PostgreSQL"})," from the list of available connections."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Fill in the connection details as follows:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"Name: talawa\nHost: postgrestest\nPort: 5432\nDatabase: talawa\nUsername: talawa\nPassword: password\n"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Note:"})," The host name should match the one specified in the Docker Compose file and credentials should match those specified in the ",(0,t.jsx)(n.code,{children:".env.development"})," file."]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["Check the ",(0,t.jsx)(n.code,{children:"Save credentials for all users with access"})," option to avoid entering the credentials each time."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Check the following boxes in the Database list:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"show all databases\nshow template databases\nshow unavailable databases\nshow database statistics\n"})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["Click ",(0,t.jsx)(n.code,{children:"Create"})," to save the connection."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["You should now see the ",(0,t.jsx)(n.code,{children:"PostgreSql@postgres-test"})," connection in the list of available connections. Click on the connection to open the database."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["Navigate to ",(0,t.jsx)(n.code,{children:"PostgreSql@postgres-test > Databases > talawa > Schemas > public > Tables"})," to view the available tables."]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"modifying-tables-cli",children:"Modifying Tables (CLI)"}),"\n",(0,t.jsxs)(n.p,{children:["To modify the database schema, you can add new tables or update existing ones within the ",(0,t.jsx)(n.code,{children:"src/drizzle/tables"})," directory.Make sure containers are running and Follow the steps below to apply the changes properly:"]}),"\n",(0,t.jsx)(n.h4,{id:"1-remove-old-tables",children:"1. Remove Old Tables"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"docker exec -it talawa-postgres-1 psql -U talawa -d talawa -c \"\nDO \\$\\$\nDECLARE\n    r RECORD;\nBEGIN\n    FOR r IN (SELECT tablename FROM pg_tables WHERE schemaname = 'public')\n    LOOP\n        EXECUTE 'DROP TABLE IF EXISTS ' || quote_ident(r.tablename) || ' CASCADE';\n    END LOOP;\nEND \\$\\$;\"\n"})}),"\n",(0,t.jsx)(n.h4,{id:"2-remove-old-schema",children:"2. Remove Old Schema"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'  docker exec -it talawa-postgres-1 psql -U talawa -d talawa -c "\n  DROP SCHEMA IF EXISTS drizzle CASCADE;\n  DROP TYPE IF EXISTS exception_type CASCADE;\n  DROP TYPE IF EXISTS frequency CASCADE;"\n'})}),"\n",(0,t.jsx)(n.h4,{id:"3-remove-old-drizzle-migrations",children:"3. Remove Old Drizzle Migrations"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"docker exec -it talawa-api-1 /bin/bash -c 'pnpm drop_drizzle_migrations'\n"})}),"\n",(0,t.jsx)(n.h4,{id:"4-generate-new-drizzle-migrations",children:"4. Generate New Drizzle Migrations"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"docker exec -it talawa-api-1 /bin/bash -c 'pnpm generate_drizzle_migrations'\n"})}),"\n",(0,t.jsx)(n.h4,{id:"5-apply-migrations-to-the-database",children:"5. Apply Migrations to the Database"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"docker exec -it talawa-api-1 /bin/bash -c 'pnpm apply_drizzle_migrations'\n"})}),"\n",(0,t.jsx)(n.h4,{id:"6-validation-access-updated-tables",children:"6. Validation (Access Updated Tables)"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"docker restart talawa-cloudbeaver-1\n"})}),"\n",(0,t.jsx)(n.p,{children:"Note: Migrations are applied to postgres-test-1 while running tests for first time, to Re-run tests with updated tables, follow same steps for postgres-test-1."}),"\n",(0,t.jsx)(n.h2,{id:"object-storage-management",children:"Object Storage Management"}),"\n",(0,t.jsx)(n.p,{children:"We use MinIO, a free, open-source object storage server that's compatible with Amazon S3. It's designed for large-scale data storage and can run on-premises or in the cloud."}),"\n",(0,t.jsx)(n.h3,{id:"minio-access-in-production",children:"MinIO Access in Production"}),"\n",(0,t.jsx)(n.p,{children:"This is how you access MinIO in production environments."}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["Open your preferred browser and navigate to:","\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"http://127.0.0.1:9001/\n"})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["Log in to the MinIO UI using the following credentials(these credentials can be modified in the env files by changing the ",(0,t.jsx)(n.code,{children:"MINIO_ROOT_USER"})," and ",(0,t.jsx)(n.code,{children:"MINIO_ROOT_PASSWORD"})," variables):","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Username: ",(0,t.jsx)(n.code,{children:"talawa"})]}),"\n",(0,t.jsxs)(n.li,{children:["Password: ",(0,t.jsx)(n.code,{children:"password"})]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["You should now see the MinIO UI. Click on the ",(0,t.jsx)(n.code,{children:"Login"})," button to access the MinIO dashboard."]}),"\n",(0,t.jsx)(n.li,{children:"You can now view the available buckets and objects in the MinIO dashboard."}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"minio-access-in-development",children:"MinIO Access in Development"}),"\n",(0,t.jsx)(n.p,{children:"This is how you access MinIO in development environments."}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["Open your preferred browser and navigate to:","\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"http://127.0.0.1:9003/\n"})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["Log in to the MinIO UI using the following credentials(these credentials can be modified in the ",(0,t.jsx)(n.code,{children:".env.devcontainer"})," file by changing the ",(0,t.jsx)(n.code,{children:"MINIO_ROOT_USER"})," and ",(0,t.jsx)(n.code,{children:"MINIO_ROOT_PASSWORD"})," variables):","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Username: ",(0,t.jsx)(n.code,{children:"talawa"})]}),"\n",(0,t.jsxs)(n.li,{children:["Password: ",(0,t.jsx)(n.code,{children:"password"})]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["You should now see the MinIO UI. Click on the ",(0,t.jsx)(n.code,{children:"Login"})," button to access the MinIO dashboard."]}),"\n",(0,t.jsx)(n.li,{children:"You can now view the available buckets and objects in the MinIO dashboard."}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"resetting-docker",children:"Resetting Docker"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"NOTE:"})," This applies only to Talawa API developers."]}),"\n",(0,t.jsx)(n.p,{children:"Sometimes you may want to start all over again from scratch. These steps will reset your development docker environment."}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["From the repository's root directory, use this command to shutdown the dev container.","\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"docker compose down\n"})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"WARNING:"})," These commands will stop ",(0,t.jsx)(n.strong,{children:"ALL"})," your Docker processes and delete their volumes. This applies not only to the Talawa API instances, but everything. Use with extreme caution.","\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"docker stop $(docker ps -q)\ndocker rm $(docker ps -a -q)\ndocker rmi $(docker images -q)\ndocker volume prune -f\n"})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["Restart the Docker dev containers to resume your development work.","\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"devcontainer build --workspace-folder .\ndevcontainer up --workspace-folder .\ndocker exec talawa-api-1 /bin/bash -c 'pnpm run start_development_server'\n"})}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Now you can resume your development work."}),"\n",(0,t.jsx)(n.h2,{id:"mock-isolation--cleanup",children:"Mock Isolation & Cleanup"}),"\n",(0,t.jsx)(n.p,{children:"To ensure reliable test execution, especially in parallel environments, it is critical to properly isolate mocks in your tests."}),"\n",(0,t.jsx)(n.h3,{id:"the-rule",children:"The Rule"}),"\n",(0,t.jsxs)(n.p,{children:["If you use ",(0,t.jsx)(n.code,{children:"vi.mock()"}),", ",(0,t.jsx)(n.code,{children:"vi.fn()"}),", or ",(0,t.jsx)(n.code,{children:"vi.spyOn()"})," in a test file, you ",(0,t.jsx)(n.strong,{children:"MUST"})," include a cleanup hook to reset the mocks after each test."]}),"\n",(0,t.jsx)(n.h3,{id:"how-to-implement",children:"How to Implement"}),"\n",(0,t.jsxs)(n.p,{children:["Add the following ",(0,t.jsx)(n.code,{children:"afterEach"})," hook to your test file:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:'import { afterEach, vi } from "vitest";\n\nafterEach(() => {\n  vi.clearAllMocks();\n});\n'})}),"\n",(0,t.jsx)(n.h3,{id:"choosing-the-right-cleanup-method",children:"Choosing the Right Cleanup Method"}),"\n",(0,t.jsx)(n.p,{children:"Vitest provides several cleanup methods. Here's when to use each:"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Method"}),(0,t.jsx)(n.th,{children:"What It Does"}),(0,t.jsx)(n.th,{children:"When to Use"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"vi.clearAllMocks()"})}),(0,t.jsx)(n.td,{children:"Clears call history and results"}),(0,t.jsxs)(n.td,{children:[(0,t.jsx)(n.strong,{children:"Recommended default"})," - Resets mock state while preserving implementation"]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"vi.resetAllMocks()"})}),(0,t.jsxs)(n.td,{children:["Clears history + resets implementation to ",(0,t.jsx)(n.code,{children:"vi.fn()"})]}),(0,t.jsx)(n.td,{children:"When you need to remove custom mock implementations"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"vi.restoreAllMocks()"})}),(0,t.jsx)(n.td,{children:"Clears history + restores original implementation"}),(0,t.jsxs)(n.td,{children:["Only for ",(0,t.jsx)(n.code,{children:"vi.spyOn()"})," - restores the real function"]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"vi.resetModules()"})}),(0,t.jsx)(n.td,{children:"Clears module cache"}),(0,t.jsx)(n.td,{children:"When module-level state causes issues (rare)"})]})]})]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Best Practice:"})," Use ",(0,t.jsx)(n.code,{children:"vi.clearAllMocks()"})," in most cases. It's the safest option that works for all mock types."]}),"\n",(0,t.jsx)(n.h3,{id:"why",children:"Why?"}),"\n",(0,t.jsx)(n.p,{children:"Without this cleanup, mocks from one test can leak into others, causing:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Flaky tests that fail randomly"}),"\n",(0,t.jsx)(n.li,{children:'"Spooky action at a distance" where a change in one file breaks an unrelated test'}),"\n",(0,t.jsx)(n.li,{children:"Failures when running tests in parallel (sharding)"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"verification",children:"Verification"}),"\n",(0,t.jsx)(n.p,{children:"We have a script that verifies this rule. You can run it locally:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"npm run check_mock_isolation\n"})}),"\n",(0,t.jsx)(n.p,{children:"To automatically fix violations:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"npm run check_mock_isolation -- --fix\n"})}),"\n",(0,t.jsx)(n.h3,{id:"environment-variables-1",children:"Environment Variables"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:(0,t.jsx)(n.code,{children:"MOCK_ISOLATION_FAIL_ON_ERROR"})})}),"\n",(0,t.jsx)(n.p,{children:"Controls whether the check fails the build or just warns:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"true"})," - Exits with code 1 if violations are found (fails CI)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"false"})," or unset - Exits with code 0 with warnings (default)"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Example:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"MOCK_ISOLATION_FAIL_ON_ERROR=true npm run check_mock_isolation\n"})}),"\n",(0,t.jsx)(n.h3,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:'"No problems found" but tests still fail in parallel'})}),"\n",(0,t.jsx)(n.p,{children:"Check for:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Global state mutations outside of mocks"}),"\n",(0,t.jsx)(n.li,{children:"Database fixtures not properly isolated"}),"\n",(0,t.jsx)(n.li,{children:"Shared test data between files"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:'"Module mocks not being reset"'})}),"\n",(0,t.jsxs)(n.p,{children:["Use ",(0,t.jsx)(n.code,{children:"vi.resetModules()"})," in addition to ",(0,t.jsx)(n.code,{children:"vi.clearAllMocks()"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"afterEach(() => {\n  vi.clearAllMocks();\n  vi.resetModules();\n});\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:'"Spy on original implementation still called"'})}),"\n",(0,t.jsxs)(n.p,{children:["You're likely using ",(0,t.jsx)(n.code,{children:"vi.spyOn()"}),". Use ",(0,t.jsx)(n.code,{children:"vi.restoreAllMocks()"})," instead:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"afterEach(() => {\n  vi.restoreAllMocks();\n});\n"})})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}}}]);