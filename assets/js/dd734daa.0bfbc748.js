"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[50115],{55288:(e,n,r)=>{r.d(n,{R:()=>o,x:()=>l});var i=r(30758);const s={},t=i.createContext(s);function o(e){const n=i.useContext(t);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),i.createElement(t.Provider,{value:n},e.children)}},59926:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>d,contentTitle:()=>l,default:()=>h,frontMatter:()=>o,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"docs/developer-resources/best-practices/auth","title":"OAuth","description":"This page provides comprehensive documentation for the OAuth implementation in Talawa API, including the base provider class, registry system, and type definitions.","source":"@site/docs/docs/developer-resources/best-practices/OAuth.md","sourceDirName":"docs/developer-resources/best-practices","slug":"/developer-resources/OAuth","permalink":"/docs/developer-resources/OAuth","draft":false,"unlisted":false,"editUrl":"https://github.com/PalisadoesFoundation/talawa-api/edit/develop/docs/docs/docs/developer-resources/best-practices/OAuth.md","tags":[],"version":"current","sidebarPosition":40,"frontMatter":{"id":"auth","title":"OAuth","slug":"/developer-resources/OAuth","sidebar_position":40},"sidebar":"tutorialSidebar","previous":{"title":"Operation","permalink":"/docs/developer-resources/operation"},"next":{"title":"GraphQL Filters & Pagination","permalink":"/docs/developer-resources/graphql-filtering"}}');var s=r(86070),t=r(55288);const o={id:"auth",title:"OAuth",slug:"/developer-resources/OAuth",sidebar_position:40},l=void 0,d={},c=[{value:"Introduction",id:"introduction",level:2},{value:"Architecture Overview",id:"architecture-overview",level:2},{value:"OAuth Accounts Database Table",id:"oauth-accounts-database-table",level:2},{value:"Table Structure",id:"table-structure",level:3},{value:"Field Descriptions",id:"field-descriptions",level:3},{value:"Indexes and Constraints",id:"indexes-and-constraints",level:3},{value:"Relations",id:"relations",level:3},{value:"Usage Examples",id:"usage-examples",level:3},{value:"Querying OAuth Accounts",id:"querying-oauth-accounts",level:4},{value:"Creating OAuth Account Linkage",id:"creating-oauth-account-linkage",level:4},{value:"Updating Last Used Timestamp",id:"updating-last-used-timestamp",level:4},{value:"OAuthAccountProfile Type",id:"oauthaccountprofile-type",level:3},{value:"Data Integrity and Security",id:"data-integrity-and-security",level:3},{value:"OAuth Configuration Functions",id:"oauth-configuration-functions",level:2},{value:"loadOAuthConfig",id:"loadoauthconfig",level:3},{value:"Parameters",id:"parameters",level:4},{value:"Returns",id:"returns",level:4},{value:"Behavior",id:"behavior",level:4},{value:"Environment Variables",id:"environment-variables",level:4},{value:"Usage Example",id:"usage-example",level:4},{value:"Return Structure",id:"return-structure",level:4},{value:"getProviderConfig",id:"getproviderconfig",level:3},{value:"Parameters",id:"parameters-1",level:4},{value:"Returns",id:"returns-1",level:4},{value:"Throws",id:"throws",level:4},{value:"Behavior",id:"behavior-1",level:4},{value:"Usage Example",id:"usage-example-1",level:4},{value:"Error Handling",id:"error-handling",level:4},{value:"Provider Keys",id:"provider-keys",level:4},{value:"BaseOAuthProvider",id:"baseoauthprovider",level:2},{value:"Key Features",id:"key-features",level:3},{value:"Class Definition",id:"class-definition",level:3},{value:"Configuration",id:"configuration",level:3},{value:"Usage Example",id:"usage-example-2",level:3},{value:"Provider Implementations",id:"provider-implementations",level:2},{value:"GitHubOAuthProvider",id:"githuboauthprovider",level:3},{value:"Features",id:"features",level:4},{value:"Usage",id:"usage",level:4},{value:"Required Scopes",id:"required-scopes",level:4},{value:"Environment Variables",id:"environment-variables-1",level:4},{value:"Protected Methods",id:"protected-methods",level:3},{value:"<code>post&lt;T&gt;(url, data, headers?)</code>",id:"postturl-data-headers",level:4},{value:"<code>get&lt;T&gt;(url, headers?)</code>",id:"getturl-headers",level:4},{value:"<code>validateConfig()</code>",id:"validateconfig",level:4},{value:"OAuthProviderRegistry",id:"oauthproviderregistry",level:2},{value:"Key Features",id:"key-features-1",level:3},{value:"Class Definition",id:"class-definition-1",level:3},{value:"Usage Example",id:"usage-example-3",level:3},{value:"Methods",id:"methods",level:3},{value:"<code>getInstance()</code>",id:"getinstance",level:4},{value:"<code>register(provider)</code>",id:"registerprovider",level:4},{value:"<code>get(providerName)</code>",id:"getprovidername",level:4},{value:"<code>has(providerName)</code>",id:"hasprovidername",level:4},{value:"<code>listProviders()</code>",id:"listproviders",level:4},{value:"<code>unregister(providerName)</code> and <code>clear()</code>",id:"unregisterprovidername-and-clear",level:4},{value:"Type Definitions",id:"type-definitions",level:2},{value:"OAuthProviderTokenResponse",id:"oauthprovidertokenresponse",level:3},{value:"OAuthUserProfile",id:"oauthuserprofile",level:3},{value:"OAuthConfig",id:"oauthconfig",level:3},{value:"Error Handling",id:"error-handling-1",level:2},{value:"TokenExchangeError",id:"tokenexchangeerror",level:3},{value:"ProfileFetchError",id:"profilefetcherror",level:3},{value:"OAuthError",id:"oautherror",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"1. Environment Configuration",id:"1-environment-configuration",level:3},{value:"2. Error Handling",id:"2-error-handling",level:3},{value:"3. Testing",id:"3-testing",level:3},{value:"4. Security Considerations",id:"4-security-considerations",level:3},{value:"Provider Implementations",id:"provider-implementations-1",level:2},{value:"GoogleOAuthProvider",id:"googleoauthprovider",level:3},{value:"Features",id:"features-1",level:4},{value:"Usage",id:"usage-1",level:4},{value:"Required Scopes",id:"required-scopes-1",level:4},{value:"Environment Variables",id:"environment-variables-2",level:4}];function a(e){const n={admonition:"admonition",code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.p,{children:"This page provides comprehensive documentation for the OAuth implementation in Talawa API, including the base provider class, registry system, and type definitions."}),"\n",(0,s.jsx)(n.h2,{id:"introduction",children:"Introduction"}),"\n",(0,s.jsx)(n.p,{children:"The Talawa API OAuth system provides a robust and extensible framework for implementing OAuth 2.0 authentication with various providers (Google, GitHub, etc.). The system is built around a modular architecture that allows easy addition of new OAuth providers while maintaining consistent error handling and security practices."}),"\n",(0,s.jsx)(n.h2,{id:"architecture-overview",children:"Architecture Overview"}),"\n",(0,s.jsx)(n.p,{children:"The OAuth system consists of several key components:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"BaseOAuthProvider"}),": Abstract base class that implements common HTTP logic and error handling"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"OAuthProviderRegistry"}),": Singleton registry for managing OAuth provider instances"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"OAuth Accounts Table"}),": Database table for storing OAuth account linkages and provider data"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Type Definitions"}),": TypeScript interfaces for OAuth configurations and responses"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Error Classes"}),": Specialized error classes for different OAuth failure scenarios"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"oauth-accounts-database-table",children:"OAuth Accounts Database Table"}),"\n",(0,s.jsxs)(n.p,{children:["The OAuth accounts table (",(0,s.jsx)(n.code,{children:"oauth_accounts"}),") stores provider-specific account information linked to users. This table serves as the bridge between Talawa users and their external OAuth provider accounts."]}),"\n",(0,s.jsx)(n.h3,{id:"table-structure",children:"Table Structure"}),"\n",(0,s.jsx)(n.p,{children:"The table is defined using Drizzle ORM and includes the following fields:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:'export const oauthAccountsTable = pgTable("oauth_accounts", {\n  // Primary unique identifier\n  id: uuid("id").primaryKey().$default(uuidv7),\n\n  // Foreign key to users table\n  userId: uuid("user_id")\n    .notNull()\n    .references(() => usersTable.id, { onDelete: "cascade" }),\n\n  // OAuth provider information\n  provider: varchar("provider", { length: 50 }).notNull(),\n  providerId: varchar("provider_id", { length: 255 }).notNull(),\n\n  // Account details from provider\n  email: varchar("email", { length: 255 }),\n  profile: jsonb("profile").$type<OAuthAccountProfile>(),\n\n  // Timestamp tracking\n  linkedAt: timestamp("linked_at", {\n    withTimezone: true,\n    mode: "date",\n    precision: 3,\n  })\n    .notNull()\n    .defaultNow(),\n\n  lastUsedAt: timestamp("last_used_at", {\n    withTimezone: true,\n    mode: "date",\n    precision: 3,\n  })\n    .notNull()\n    .defaultNow(),\n});\n'})}),"\n",(0,s.jsx)(n.h3,{id:"field-descriptions",children:"Field Descriptions"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"id"})}),": Primary unique identifier using UUIDv7 for better performance and ordering"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"userId"})}),": Foreign key reference to the user who owns this OAuth account (cascades on delete)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"provider"})}),": OAuth provider name (e.g., 'google', 'github', 'facebook')"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"providerId"})}),": Provider-specific user identifier (unique per provider)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"email"})}),": Email address associated with the OAuth account from the provider"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"profile"})}),": Additional profile data from the OAuth provider stored as JSON"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"linkedAt"})}),": Timestamp when the OAuth account was first linked to the user"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"lastUsedAt"})}),": Timestamp when the OAuth account was last used for authentication"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"indexes-and-constraints",children:"Indexes and Constraints"}),"\n",(0,s.jsx)(n.p,{children:"The table includes several indexes and constraints for data integrity and performance:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:'// Ensures each external provider account is linked only once\nproviderUserUnique: unique("oauth_accounts_provider_provider_id_unique")\n  .on(table.provider, table.providerId),\n\n// Index for efficient user lookups\nuserIdIdx: index("oauth_accounts_user_id_idx").on(table.userId),\n\n// Index for provider-based queries\nproviderIdx: index("oauth_accounts_provider_idx").on(table.provider),\n'})}),"\n",(0,s.jsx)(n.h3,{id:"relations",children:"Relations"}),"\n",(0,s.jsx)(n.p,{children:"The table establishes a many-to-one relationship with the users table:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:'export const oauthAccountsTableRelations = relations(\n  oauthAccountsTable,\n  ({ one }) => ({\n    user: one(usersTable, {\n      fields: [oauthAccountsTable.userId],\n      references: [usersTable.id],\n      relationName: "oauth_accounts.user_id:users.id",\n    }),\n  }),\n);\n'})}),"\n",(0,s.jsx)(n.h3,{id:"usage-examples",children:"Usage Examples"}),"\n",(0,s.jsx)(n.h4,{id:"querying-oauth-accounts",children:"Querying OAuth Accounts"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:'import { db } from "~/src/drizzle/db";\nimport { oauthAccountsTable } from "~/src/drizzle/tables/oauthAccount";\nimport { eq, and } from "drizzle-orm";\n\n// Find all OAuth accounts for a user\nconst userOAuthAccounts = await db\n  .select()\n  .from(oauthAccountsTable)\n  .where(eq(oauthAccountsTable.userId, userId));\n\n// Find specific provider account\nconst googleAccount = await db\n  .select()\n  .from(oauthAccountsTable)\n  .where(\n    and(\n      eq(oauthAccountsTable.userId, userId),\n      eq(oauthAccountsTable.provider, "google"),\n    ),\n  );\n\n// Find account by provider ID\nconst providerAccount = await db\n  .select()\n  .from(oauthAccountsTable)\n  .where(\n    and(\n      eq(oauthAccountsTable.provider, "google"),\n      eq(oauthAccountsTable.providerId, externalUserId),\n    ),\n  );\n'})}),"\n",(0,s.jsx)(n.h4,{id:"creating-oauth-account-linkage",children:"Creating OAuth Account Linkage"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:'import { oauthAccountsTableInsertSchema } from "~/src/drizzle/tables/oauthAccount";\n\n// Validate and create new OAuth account linkage\nconst newOAuthAccount = oauthAccountsTableInsertSchema.parse({\n  userId: user.id,\n  provider: "google",\n  providerId: userProfile.providerId,\n  email: userProfile.email,\n  profile: {\n    name: userProfile.name,\n    picture: userProfile.picture,\n    emailVerified: userProfile.emailVerified,\n  },\n});\n\nconst [createdAccount] = await db\n  .insert(oauthAccountsTable)\n  .values(newOAuthAccount)\n  .returning();\n'})}),"\n",(0,s.jsx)(n.h4,{id:"updating-last-used-timestamp",children:"Updating Last Used Timestamp"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"// Update lastUsedAt when account is used for authentication\nawait db\n  .update(oauthAccountsTable)\n  .set({ lastUsedAt: new Date() })\n  .where(eq(oauthAccountsTable.id, oauthAccountId));\n"})}),"\n",(0,s.jsx)(n.h3,{id:"oauthaccountprofile-type",children:"OAuthAccountProfile Type"}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"profile"})," field stores additional provider data using a typed JSONB column:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"interface OAuthAccountProfile {\n  name?: string;\n  picture?: string;\n  emailVerified?: boolean;\n  [key: string]: any; // Additional provider-specific fields\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"This flexible structure allows storing provider-specific profile information while maintaining type safety for common fields."}),"\n",(0,s.jsx)(n.h3,{id:"data-integrity-and-security",children:"Data Integrity and Security"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Cascade Deletion"}),": When a user is deleted, all linked OAuth accounts are automatically removed"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Unique Constraints"}),": Each external provider account can only be linked to one Talawa user"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Indexing"}),": Optimized queries for user lookups and provider-based searches"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Timezone Support"}),": All timestamps include timezone information for accurate tracking across regions"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"oauth-configuration-functions",children:"OAuth Configuration Functions"}),"\n",(0,s.jsx)(n.p,{children:"The OAuth configuration system provides utility functions for loading and validating OAuth provider configurations from environment variables."}),"\n",(0,s.jsx)(n.h3,{id:"loadoauthconfig",children:"loadOAuthConfig"}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"loadOAuthConfig"})," function loads and validates OAuth configuration from environment variables, automatically enabling or disabling providers based on the availability of required credentials."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"function loadOAuthConfig(env = process.env): OAuthProvidersConfig;\n"})}),"\n",(0,s.jsx)(n.h4,{id:"parameters",children:"Parameters"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"env"})})," (optional): Environment variables object. Defaults to ",(0,s.jsx)(n.code,{children:"process.env"})]}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"returns",children:"Returns"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"OAuthProvidersConfig"})}),": Configuration object containing Google and GitHub provider settings"]}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"behavior",children:"Behavior"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Provider Enablement"}),": Providers are automatically enabled only when all required environment variables are present"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Timeout Handling"}),": Uses ",(0,s.jsx)(n.code,{children:"API_OAUTH_REQUEST_TIMEOUT_MS"})," with fallback to 10000ms (10 seconds)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Error Recovery"}),": Invalid timeout values (NaN) automatically fall back to the default timeout"]}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"environment-variables",children:"Environment Variables"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Google Provider"}),": ",(0,s.jsx)(n.code,{children:"GOOGLE_CLIENT_ID"}),", ",(0,s.jsx)(n.code,{children:"GOOGLE_CLIENT_SECRET"}),", ",(0,s.jsx)(n.code,{children:"GOOGLE_REDIRECT_URI"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"GitHub Provider"}),": ",(0,s.jsx)(n.code,{children:"GITHUB_CLIENT_ID"}),", ",(0,s.jsx)(n.code,{children:"GITHUB_CLIENT_SECRET"}),", ",(0,s.jsx)(n.code,{children:"GITHUB_REDIRECT_URI"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Request Timeout"}),": ",(0,s.jsx)(n.code,{children:"API_OAUTH_REQUEST_TIMEOUT_MS"})," (optional, defaults to 10000)"]}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"usage-example",children:"Usage Example"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:'import { loadOAuthConfig } from "~/src/config/oauth";\n\n// Load configuration from process.env\nconst config = loadOAuthConfig();\n\nif (config.google.enabled) {\n  console.log("Google OAuth is configured");\n  console.log("Timeout:", config.google.requestTimeoutMs);\n}\n\n// Load configuration from custom environment\nconst customEnv = {\n  GOOGLE_CLIENT_ID: "your-google-client-id",\n  GOOGLE_CLIENT_SECRET: "your-google-secret",\n  GOOGLE_REDIRECT_URI: "http://localhost:4000/auth/google/callback",\n  API_OAUTH_REQUEST_TIMEOUT_MS: "15000",\n};\n\nconst customConfig = loadOAuthConfig(customEnv);\n'})}),"\n",(0,s.jsx)(n.h4,{id:"return-structure",children:"Return Structure"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"interface OAuthProvidersConfig {\n  google: {\n    enabled: boolean;\n    clientId: string;\n    clientSecret: string;\n    redirectUri: string;\n    requestTimeoutMs: number;\n  };\n  github: {\n    enabled: boolean;\n    clientId: string;\n    clientSecret: string;\n    redirectUri: string;\n    requestTimeoutMs: number;\n  };\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"getproviderconfig",children:"getProviderConfig"}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"getProviderConfig"})," function retrieves a specific provider's configuration and validates that it's properly configured and enabled."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"function getProviderConfig(\n  provider: ProviderKey,\n  env = process.env,\n): Required<OAuthProviderConfig>;\n"})}),"\n",(0,s.jsx)(n.h4,{id:"parameters-1",children:"Parameters"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"provider"})}),": Provider key (",(0,s.jsx)(n.code,{children:'"google"'})," or ",(0,s.jsx)(n.code,{children:'"github"'}),")"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"env"})})," (optional): Environment variables object. Defaults to ",(0,s.jsx)(n.code,{children:"process.env"})]}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"returns-1",children:"Returns"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"Required<OAuthProviderConfig>"})}),": Complete provider configuration with all required fields"]}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"throws",children:"Throws"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"Error"})}),": When the provider is not properly configured or disabled"]}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"behavior-1",children:"Behavior"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Validation"}),": Ensures the provider is enabled and has all required configuration"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Fallback Timeout"}),": Provides 10000ms fallback if timeout is falsy (defensive programming)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Type Safety"}),": Returns a configuration object with all fields guaranteed to be present"]}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"usage-example-1",children:"Usage Example"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:'import { getProviderConfig } from "~/src/config/oauth";\n\ntry {\n  // Get Google provider configuration\n  const googleConfig = getProviderConfig("google");\n\n  // Safe to use - all fields are guaranteed to be present\n  console.log("Client ID:", googleConfig.clientId);\n  console.log("Timeout:", googleConfig.requestTimeoutMs);\n\n  // Initialize OAuth provider\n  const provider = new GoogleOAuthProvider(googleConfig);\n} catch (error) {\n  console.error("Google OAuth is not configured:", error.message);\n}\n\n// Custom environment example\ntry {\n  const githubConfig = getProviderConfig("github", customEnvironment);\n  // Use configuration...\n} catch (error) {\n  console.error("GitHub OAuth configuration error:", error.message);\n}\n'})}),"\n",(0,s.jsx)(n.h4,{id:"error-handling",children:"Error Handling"}),"\n",(0,s.jsx)(n.p,{children:"The function throws descriptive errors for various configuration issues:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"// Missing environment variables\nthrow new Error('OAuth provider \"google\" is not properly configured');\n\n// This covers scenarios where:\n// - Provider is disabled (missing required credentials)\n// - clientId is missing or empty\n// - clientSecret is missing or empty\n// - redirectUri is missing or empty\n"})}),"\n",(0,s.jsx)(n.h4,{id:"provider-keys",children:"Provider Keys"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:'type ProviderKey = "google" | "github";\n'})}),"\n",(0,s.jsx)(n.p,{children:"Currently supported providers:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:'"google"'})}),": Google OAuth 2.0"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:'"github"'})}),": GitHub OAuth Apps"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"baseoauthprovider",children:"BaseOAuthProvider"}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"BaseOAuthProvider"})," is an abstract base class that provides common functionality for all OAuth providers."]}),"\n",(0,s.jsx)(n.h3,{id:"key-features",children:"Key Features"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"HTTP Request Handling"}),": Built-in POST and GET methods with proper error handling"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Configuration Validation"}),": Ensures required OAuth credentials are present"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"URL Encoding"}),": Automatic conversion of data to URLSearchParams for form submission"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Timeout Management"}),": Configurable request timeouts with sensible defaults"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"class-definition",children:"Class Definition"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"export abstract class BaseOAuthProvider implements IOAuthProvider {\n  protected config: OAuthConfig;\n  protected providerName: string;\n\n  constructor(providerName: string, config: OAuthConfig);\n  abstract exchangeCodeForTokens(\n    code: string,\n    redirectUri: string,\n  ): Promise<OAuthProviderTokenResponse>;\n  abstract getUserProfile(accessToken: string): Promise<OAuthUserProfile>;\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"configuration",children:"Configuration"}),"\n",(0,s.jsxs)(n.p,{children:["The provider requires an ",(0,s.jsx)(n.code,{children:"OAuthConfig"})," object:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"interface OAuthConfig {\n  clientId: string; // Required: OAuth client ID\n  clientSecret: string; // Required: OAuth client secret\n  redirectUri?: string; // Optional: Redirect URI (provider-specific)\n  requestTimeoutMs?: number; // Optional: Request timeout (default: 10000ms)\n}\n"})}),"\n",(0,s.jsxs)(n.admonition,{title:"Security Notice",type:"warning",children:[(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"clientSecret"})," contains sensitive credentials and must:"]}),(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Be used server-side only"}),"\n",(0,s.jsx)(n.li,{children:"Never be logged or exposed in error messages"}),"\n",(0,s.jsx)(n.li,{children:"Be stored securely in environment variables"}),"\n"]})]}),"\n",(0,s.jsx)(n.h3,{id:"usage-example-2",children:"Usage Example"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:'class GoogleOAuthProvider extends BaseOAuthProvider {\n  constructor(config: OAuthConfig) {\n    super("google", config);\n  }\n\n  async exchangeCodeForTokens(\n    code: string,\n    redirectUri: string,\n  ): Promise<OAuthProviderTokenResponse> {\n    return await this.post<OAuthProviderTokenResponse>(\n      "https://oauth2.googleapis.com/token",\n      {\n        grant_type: "authorization_code",\n        client_id: this.config.clientId,\n        client_secret: this.config.clientSecret,\n        code,\n        redirect_uri: redirectUri,\n      },\n    );\n  }\n\n  async getUserProfile(accessToken: string): Promise<OAuthUserProfile> {\n    const response = await this.get<GoogleUserResponse>(\n      "https://www.googleapis.com/oauth2/v2/userinfo",\n      {\n        Authorization: `Bearer ${accessToken}`,\n      },\n    );\n\n    return {\n      providerId: response.id,\n      email: response.email,\n      name: response.name,\n      picture: response.picture,\n      emailVerified: response.verified_email,\n    };\n  }\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"provider-implementations",children:"Provider Implementations"}),"\n",(0,s.jsx)(n.h3,{id:"githuboauthprovider",children:"GitHubOAuthProvider"}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"GitHubOAuthProvider"})," implements OAuth 2.0 authentication with GitHub. It handles the complete authentication flow including token exchange and user profile retrieval."]}),"\n",(0,s.jsx)(n.h4,{id:"features",children:"Features"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Token exchange with GitHub OAuth endpoints"}),"\n",(0,s.jsx)(n.li,{children:"User profile fetching from GitHub API"}),"\n",(0,s.jsx)(n.li,{children:"Automatic email resolution for private email addresses"}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"usage",children:"Usage"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"import { GitHubOAuthProvider } from '~/src/utilities/auth/oauth/providers/GitHubOAuthProvider';\n\nconst provider = new GitHubOAuthProvider({\n  clientId: process.env.GITHUB_CLIENT_ID!,\n  clientSecret: process.env.GITHUB_CLIENT_SECRET!,\n  redirectUri: process.env.GITHUB_REDIRECT_URI,\n});\n\n// Exchange authorization code for tokens\nconst tokens = await provider.exchangeCodeForTokens(authCode, redirectUri);\n\n// Get user profile\nconst profile = await provider.getUserProfile(tokens.access_token);\n"})}),"\n",(0,s.jsx)(n.h4,{id:"required-scopes",children:"Required Scopes"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"user:email"})," - Required to access private email addresses when the primary email is not public"]}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"environment-variables-1",children:"Environment Variables"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"GITHUB_CLIENT_ID"})," - GitHub OAuth app client ID"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"GITHUB_CLIENT_SECRET"})," - GitHub OAuth app client secret"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"GITHUB_REDIRECT_URI"})," - Authorized redirect URI"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"protected-methods",children:"Protected Methods"}),"\n",(0,s.jsx)(n.h4,{id:"postturl-data-headers",children:(0,s.jsx)(n.code,{children:"post<T>(url, data, headers?)"})}),"\n",(0,s.jsx)(n.p,{children:"Makes an HTTP POST request with automatic URL encoding:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"protected async post<T>(\n  url: string,\n  data: Record<string, string> | URLSearchParams,\n  headers?: Record<string, string>\n): Promise<T>\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Parameters:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"url"}),": Target URL for the request"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"data"}),": Request body data (automatically converted to URLSearchParams)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"headers"}),": Optional additional headers"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Returns:"})," Parsed response data"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Throws:"})," ",(0,s.jsx)(n.code,{children:"TokenExchangeError"})," on failure"]}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"getturl-headers",children:(0,s.jsx)(n.code,{children:"get<T>(url, headers?)"})}),"\n",(0,s.jsx)(n.p,{children:"Makes an HTTP GET request:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"protected async get<T>(\n  url: string,\n  headers?: Record<string, string>\n): Promise<T>\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Parameters:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"url"}),": Target URL for the request"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"headers"}),": Optional request headers"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Returns:"})," Parsed response data"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Throws:"})," ",(0,s.jsx)(n.code,{children:"ProfileFetchError"})," on failure"]}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"validateconfig",children:(0,s.jsx)(n.code,{children:"validateConfig()"})}),"\n",(0,s.jsx)(n.p,{children:"Validates that required configuration is present:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"protected validateConfig(): void\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Validates:"})," ",(0,s.jsx)(n.code,{children:"clientId"})," and ",(0,s.jsx)(n.code,{children:"clientSecret"})," are non-empty"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Throws:"})," ",(0,s.jsx)(n.code,{children:"OAuthError"})," with code ",(0,s.jsx)(n.code,{children:"INVALID_CONFIG"})," if validation fails"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"oauthproviderregistry",children:"OAuthProviderRegistry"}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"OAuthProviderRegistry"})," is a singleton class that manages OAuth provider instances throughout the application lifecycle."]}),"\n",(0,s.jsx)(n.h3,{id:"key-features-1",children:"Key Features"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Singleton Pattern"}),": Ensures one registry instance per application"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Provider Management"}),": Register, retrieve, and manage OAuth providers"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Name Normalization"}),": Automatic normalization of provider names (trim, lowercase)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Error Handling"}),": Comprehensive error handling with descriptive messages"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Testing Support"}),": Methods for clearing and unregistering providers"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"class-definition-1",children:"Class Definition"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"export class OAuthProviderRegistry {\n  private providers: Map<string, IOAuthProvider>;\n  private static instance?: OAuthProviderRegistry;\n\n  static getInstance(): OAuthProviderRegistry;\n  register(provider: IOAuthProvider): void;\n  get(providerName: string): IOAuthProvider;\n  has(providerName: string): boolean;\n  listProviders(): string[];\n  unregister(providerName: string): void;\n  clear(): void;\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"usage-example-3",children:"Usage Example"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:'import { OAuthProviderRegistry } from "~/src/utilities/auth/oauth/OAuthProviderRegistry";\nimport { GoogleOAuthProvider } from "~/src/utilities/auth/oauth/providers/GoogleOAuthProvider";\n\n// Get singleton instance\nconst registry = OAuthProviderRegistry.getInstance();\n\n// Register a provider\nconst googleProvider = new GoogleOAuthProvider({\n  clientId: process.env.GOOGLE_CLIENT_ID!,\n  clientSecret: process.env.GOOGLE_CLIENT_SECRET!,\n  redirectUri: process.env.GOOGLE_REDIRECT_URI,\n});\n\nregistry.register(googleProvider);\n\n// Retrieve and use a provider\nconst provider = registry.get("google");\nconst tokenResponse = await provider.exchangeCodeForTokens(code, redirectUri);\nconst userProfile = await provider.getUserProfile(tokenResponse.access_token);\n'})}),"\n",(0,s.jsx)(n.h3,{id:"methods",children:"Methods"}),"\n",(0,s.jsx)(n.h4,{id:"getinstance",children:(0,s.jsx)(n.code,{children:"getInstance()"})}),"\n",(0,s.jsx)(n.p,{children:"Returns the singleton registry instance:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"static getInstance(): OAuthProviderRegistry\n"})}),"\n",(0,s.jsx)(n.h4,{id:"registerprovider",children:(0,s.jsx)(n.code,{children:"register(provider)"})}),"\n",(0,s.jsx)(n.p,{children:"Registers an OAuth provider:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"register(provider: IOAuthProvider): void\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Parameters:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"provider"}),": Provider instance implementing ",(0,s.jsx)(n.code,{children:"IOAuthProvider"})]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Throws:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"OAuthError"})," with code ",(0,s.jsx)(n.code,{children:"INVALID_PROVIDER_NAME"})," if provider name is empty"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"OAuthError"})," with code ",(0,s.jsx)(n.code,{children:"DUPLICATE_PROVIDER"})," if provider already registered"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"getprovidername",children:(0,s.jsx)(n.code,{children:"get(providerName)"})}),"\n",(0,s.jsx)(n.p,{children:"Retrieves a registered provider:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"get(providerName: string): IOAuthProvider\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Parameters:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"providerName"}),": Name of the provider to retrieve"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Returns:"})," Provider instance"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Throws:"})," ",(0,s.jsx)(n.code,{children:"OAuthError"})," with code ",(0,s.jsx)(n.code,{children:"PROVIDER_NOT_FOUND"})," if provider not found"]}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"hasprovidername",children:(0,s.jsx)(n.code,{children:"has(providerName)"})}),"\n",(0,s.jsx)(n.p,{children:"Checks if a provider is registered:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"has(providerName: string): boolean\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Parameters:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"providerName"}),": Name of the provider to check"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Returns:"})," ",(0,s.jsx)(n.code,{children:"true"})," if provider exists, ",(0,s.jsx)(n.code,{children:"false"})," otherwise"]}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"listproviders",children:(0,s.jsx)(n.code,{children:"listProviders()"})}),"\n",(0,s.jsx)(n.p,{children:"Returns all registered provider names:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"listProviders(): string[]\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Returns:"})," Array of registered provider names"]}),"\n"]}),"\n",(0,s.jsxs)(n.h4,{id:"unregisterprovidername-and-clear",children:[(0,s.jsx)(n.code,{children:"unregister(providerName)"})," and ",(0,s.jsx)(n.code,{children:"clear()"})]}),"\n",(0,s.jsx)(n.p,{children:"Testing utilities for removing providers:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"unregister(providerName: string): void  // Remove specific provider\nclear(): void                          // Remove all providers\n"})}),"\n",(0,s.jsx)(n.h2,{id:"type-definitions",children:"Type Definitions"}),"\n",(0,s.jsx)(n.h3,{id:"oauthprovidertokenresponse",children:"OAuthProviderTokenResponse"}),"\n",(0,s.jsx)(n.p,{children:"Response structure from OAuth provider token endpoints:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:'interface OAuthProviderTokenResponse {\n  access_token: string; // Required: OAuth access token\n  token_type: string; // Required: Token type (usually "Bearer")\n  expires_in?: number; // Optional: Token expiration time in seconds\n  refresh_token?: string; // Optional: Refresh token for renewing access\n  scope?: string; // Optional: Granted scopes\n  id_token?: string; // Optional: OpenID Connect ID token\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"oauthuserprofile",children:"OAuthUserProfile"}),"\n",(0,s.jsx)(n.p,{children:"Normalized user profile structure:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"interface OAuthUserProfile {\n  providerId: string; // Required: Unique user ID from provider\n  email?: string; // Optional: User email address\n  name?: string; // Optional: User display name\n  picture?: string; // Optional: User profile picture URL\n  emailVerified?: boolean; // Optional: Email verification status\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"oauthconfig",children:"OAuthConfig"}),"\n",(0,s.jsx)(n.p,{children:"Configuration object for OAuth providers:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"interface OAuthConfig {\n  clientId: string; // Required: OAuth client ID\n  clientSecret: string; // Required: OAuth client secret\n  redirectUri?: string; // Optional: Redirect URI\n  requestTimeoutMs?: number; // Optional: Request timeout (default: 10000ms)\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"error-handling-1",children:"Error Handling"}),"\n",(0,s.jsx)(n.p,{children:"The OAuth system uses specialized error classes for different failure scenarios:"}),"\n",(0,s.jsx)(n.h3,{id:"tokenexchangeerror",children:"TokenExchangeError"}),"\n",(0,s.jsx)(n.p,{children:"Thrown when token exchange fails:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"class TokenExchangeError extends OAuthError {\n  constructor(message: string, details?: string);\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"profilefetcherror",children:"ProfileFetchError"}),"\n",(0,s.jsx)(n.p,{children:"Thrown when user profile retrieval fails:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"class ProfileFetchError extends OAuthError {\n  constructor(message: string);\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"oautherror",children:"OAuthError"}),"\n",(0,s.jsx)(n.p,{children:"Base error class for OAuth-related errors:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"class OAuthError extends Error {\n  constructor(message: string, code: string, statusCode: number);\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"Common error codes:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"INVALID_CONFIG"}),": Configuration validation failed"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"INVALID_PROVIDER_NAME"}),": Provider name is empty or invalid"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"DUPLICATE_PROVIDER"}),": Attempting to register an already registered provider"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"PROVIDER_NOT_FOUND"}),": Requested provider is not registered"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,s.jsx)(n.h3,{id:"1-environment-configuration",children:"1. Environment Configuration"}),"\n",(0,s.jsx)(n.p,{children:"Store OAuth credentials securely in environment variables:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:'const config: OAuthConfig = {\n  clientId: process.env.OAUTH_CLIENT_ID!,\n  clientSecret: process.env.OAUTH_CLIENT_SECRET!,\n  redirectUri: process.env.OAUTH_REDIRECT_URI,\n  requestTimeoutMs: parseInt(process.env.OAUTH_TIMEOUT_MS || "10000"),\n};\n'})}),"\n",(0,s.jsx)(n.h3,{id:"2-error-handling",children:"2. Error Handling"}),"\n",(0,s.jsx)(n.p,{children:"Always handle OAuth errors appropriately by using the centralized OAuthError hierarchy to represent well-defined failure cases with consistent error codes, status codes, and clear semantics:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:'try {\n  const provider = registry.get(providerName);\n  const tokenResponse = await provider.exchangeCodeForTokens(code, redirectUri);\n  const userProfile = await provider.getUserProfile(tokenResponse.access_token);\n\n  // Handle successful authentication\n} catch (error) {\n  if (error instanceof TokenExchangeError) {\n    // Handle token exchange failure\n    logger.error("Token exchange failed:", error.message);\n  } else if (error instanceof ProfileFetchError) {\n    // Handle profile fetch failure\n    logger.error("Profile fetch failed:", error.message);\n  } else if (\n    error instanceof OAuthError &&\n    error.code === "PROVIDER_NOT_FOUND"\n  ) {\n    // Handle unknown provider\n    throw new Error(`Unsupported OAuth provider: ${providerName}`);\n  } else {\n    // Handle unexpected errors\n    throw error;\n  }\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"3-testing",children:"3. Testing"}),"\n",(0,s.jsx)(n.p,{children:"When testing OAuth functionality:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:'import { OAuthProviderRegistry } from "~/src/utilities/auth/oauth/OAuthProviderRegistry";\n\nbeforeEach(() => {\n  // Clear registry before each test\n  const registry = OAuthProviderRegistry.getInstance();\n  registry.clear();\n});\n'})}),"\n",(0,s.jsx)(n.h3,{id:"4-security-considerations",children:"4. Security Considerations"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Never log or expose ",(0,s.jsx)(n.code,{children:"clientSecret"})," in error messages"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"provider-implementations-1",children:"Provider Implementations"}),"\n",(0,s.jsx)(n.h3,{id:"googleoauthprovider",children:"GoogleOAuthProvider"}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"GoogleOAuthProvider"})," is a concrete implementation of the ",(0,s.jsx)(n.code,{children:"BaseOAuthProvider"})," that enables OAuth 2.0 authentication with Google accounts."]}),"\n",(0,s.jsx)(n.h4,{id:"features-1",children:"Features"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Exchanges authorization codes for access tokens via Google OAuth 2.0 token endpoint"}),"\n",(0,s.jsx)(n.li,{children:"Fetches user profile information from Google's userinfo API"}),"\n",(0,s.jsx)(n.li,{children:"Automatically normalizes Google profile data to match Talawa's internal format"}),"\n",(0,s.jsx)(n.li,{children:"Supports optional redirect URI for enhanced security"}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"usage-1",children:"Usage"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:'import { GoogleOAuthProvider } from "~/src/utilities/auth/oauth";\n\n// Initialize the provider\nconst googleProvider = new GoogleOAuthProvider({\n  clientId: process.env.GOOGLE_CLIENT_ID,\n  clientSecret: process.env.GOOGLE_CLIENT_SECRET,\n  redirectUri: process.env.GOOGLE_REDIRECT_URI,\n});\n\n// Exchange authorization code for access token\nconst tokenData = await googleProvider.exchangeCodeForTokens(\n  "authorization_code_from_google",\n);\n// Returns: { access_token: string, token_type: string, expires_in: number, ... }\n\n// Fetch user profile using the access token\nconst userProfile = await googleProvider.getUserProfile(tokenData.access_token);\n// Returns normalized profile: { providerId, email, name, picture, emailVerified }\n'})}),"\n",(0,s.jsx)(n.h4,{id:"required-scopes-1",children:"Required Scopes"}),"\n",(0,s.jsx)(n.p,{children:"When configuring your Google OAuth application, ensure the following scopes are included in your authorization request:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"openid"})," - Required for OpenID Connect authentication"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"email"})," - Access to user's email address"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"profile"})," - Access to user's basic profile information"]}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"environment-variables-2",children:"Environment Variables"}),"\n",(0,s.jsx)(n.p,{children:"The following environment variables must be configured:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"GOOGLE_CLIENT_ID"}),": Your Google OAuth application's client ID"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"GOOGLE_CLIENT_SECRET"}),": Your Google OAuth application's client secret"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"GOOGLE_REDIRECT_URI"}),": The authorized redirect URI configured in your Google OAuth app"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(a,{...e})}):a(e)}}}]);