"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[75155],{55288:(e,n,r)=>{r.d(n,{R:()=>o,x:()=>l});var s=r(30758);const i={},t=s.createContext(i);function o(e){const n=s.useContext(t);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),s.createElement(t.Provider,{value:n},e.children)}},83181:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>d,contentTitle:()=>l,default:()=>g,frontMatter:()=>o,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"docs/developer-resources/best-practices/logging-guide","title":"Logging Guide","description":"This page outlines the structured logging conventions and best practices for the Talawa-API codebase.","source":"@site/docs/docs/developer-resources/best-practices/logging.md","sourceDirName":"docs/developer-resources/best-practices","slug":"/developer-resources/logging-guide","permalink":"/docs/developer-resources/logging-guide","draft":false,"unlisted":false,"editUrl":"https://github.com/PalisadoesFoundation/talawa-api/edit/develop/docs/docs/docs/developer-resources/best-practices/logging.md","tags":[],"version":"current","sidebarPosition":85,"frontMatter":{"id":"logging-guide","title":"Logging Guide","slug":"/developer-resources/logging-guide","sidebar_position":85},"sidebar":"tutorialSidebar","previous":{"title":"Authentication and Authorization Guide","permalink":"/docs/developer-resources/authentication-authorization-guide"},"next":{"title":"Email Service Guide","permalink":"/docs/developer-resources/email-service-guide"}}');var i=r(86070),t=r(55288);const o={id:"logging-guide",title:"Logging Guide",slug:"/developer-resources/logging-guide",sidebar_position:85},l=void 0,d={},c=[{value:"Introduction",id:"introduction",level:2},{value:"The Root Logger",id:"the-root-logger",level:2},{value:"Structured Logging Format",id:"structured-logging-format",level:2},{value:"Standard Fields",id:"standard-fields",level:3},{value:"Log Levels",id:"log-levels",level:2},{value:"Correlation IDs",id:"correlation-ids",level:2},{value:"How It Works",id:"how-it-works",level:3},{value:"Context-Specific Logging",id:"context-specific-logging",level:2},{value:"HTTP Routes",id:"http-routes",level:3},{value:"GraphQL Resolvers",id:"graphql-resolvers",level:3},{value:"Plugin System",id:"plugin-system",level:3},{value:"Background Workers",id:"background-workers",level:3},{value:"Utilities (Outside Request Context)",id:"utilities-outside-request-context",level:3},{value:"What NOT To Do",id:"what-not-to-do",level:2},{value:"Never Use console.*",id:"never-use-console",level:3},{value:"Never Use String-Only Logging",id:"never-use-string-only-logging",level:3},{value:"Never Log Sensitive Data",id:"never-log-sensitive-data",level:3},{value:"Testing with Mocked Loggers",id:"testing-with-mocked-loggers",level:2},{value:"Environment Configuration",id:"environment-configuration",level:2},{value:"Summary",id:"summary",level:2}];function a(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.p,{children:"This page outlines the structured logging conventions and best practices for the Talawa-API codebase."}),"\n",(0,i.jsx)(n.h2,{id:"introduction",children:"Introduction"}),"\n",(0,i.jsxs)(n.p,{children:["Talawa-API uses ",(0,i.jsx)(n.a,{href:"https://github.com/pinojs/pino",children:"Pino"}),", a high-performance JSON logger, integrated with Fastify. All logging should follow structured logging conventions to enable consistent log parsing, monitoring, and debugging."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Key Principles:"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Never use ",(0,i.jsx)(n.code,{children:"console.*"})," statements - they are forbidden by linter rules"]}),"\n",(0,i.jsx)(n.li,{children:"Use structured logging with objects, not string interpolation"}),"\n",(0,i.jsx)(n.li,{children:"Include correlation IDs for request tracing"}),"\n",(0,i.jsx)(n.li,{children:"Use appropriate log levels"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"the-root-logger",children:"The Root Logger"}),"\n",(0,i.jsx)(n.p,{children:"The root logger is the base logger instance used across the application. Import it from:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'import { rootLogger } from "~/src/utilities/logging/logger";\n'})}),"\n",(0,i.jsx)(n.p,{children:"The root logger is pre-configured with:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Service name and environment metadata"}),"\n",(0,i.jsxs)(n.li,{children:["Log level from ",(0,i.jsx)(n.code,{children:"LOG_LEVEL"})," environment variable"]}),"\n",(0,i.jsx)(n.li,{children:"Pretty printing in development mode"}),"\n",(0,i.jsx)(n.li,{children:"Sensitive field redaction (auth headers, passwords, tokens)"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"structured-logging-format",children:"Structured Logging Format"}),"\n",(0,i.jsx)(n.p,{children:"Always use structured logging with an object as the first argument:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'// \u2705 CORRECT - Structured format\nlogger.info({ msg: "User created", userId: user.id });\nlogger.error({ msg: "Failed to fetch data", err: error, endpoint });\nlogger.warn({ msg: "Rate limit exceeded", key, remaining: 0 });\n\n// \u274c WRONG - String interpolation\nlogger.info(`User ${userId} created`);  // No structured data\nconsole.log("User created:", userId);     // Forbidden\n'})}),"\n",(0,i.jsx)(n.h3,{id:"standard-fields",children:"Standard Fields"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Field"}),(0,i.jsx)(n.th,{children:"Description"}),(0,i.jsx)(n.th,{children:"Example"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"msg"})}),(0,i.jsx)(n.td,{children:"Human-readable message"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:'"User created"'})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"err"})}),(0,i.jsx)(n.td,{children:"Error object (for errors)"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:'new Error("Failed")'})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"userId"})}),(0,i.jsx)(n.td,{children:"Associated user ID"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:'"abc123"'})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"pluginId"})}),(0,i.jsx)(n.td,{children:"Plugin identifier"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:'"my-plugin"'})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"action"})}),(0,i.jsx)(n.td,{children:"Operation being performed"}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:'"install"'}),", ",(0,i.jsx)(n.code,{children:'"activate"'})]})]})]})]}),"\n",(0,i.jsx)(n.h2,{id:"log-levels",children:"Log Levels"}),"\n",(0,i.jsx)(n.p,{children:"Use the appropriate log level for each situation:"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Level"}),(0,i.jsx)(n.th,{children:"Usage"}),(0,i.jsx)(n.th,{children:"Example"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"error"})}),(0,i.jsx)(n.td,{children:"Unexpected failures, exceptions"}),(0,i.jsx)(n.td,{children:"Database connection failed"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"warn"})}),(0,i.jsx)(n.td,{children:"Expected issues, degraded behavior"}),(0,i.jsx)(n.td,{children:"Docker not available, rate limit hit"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"info"})}),(0,i.jsx)(n.td,{children:"Significant events"}),(0,i.jsx)(n.td,{children:"Plugin loaded, server started"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"debug"})}),(0,i.jsx)(n.td,{children:"Detailed debugging info"}),(0,i.jsx)(n.td,{children:"Query parameters, cache hits"})]})]})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'// Error - Something went wrong unexpectedly\nlogger.error({ msg: "Database connection failed", err: error });\n\n// Warn - Something expected but notable\nlogger.warn({ msg: "Docker not available. Skipping docker step.", pluginId });\n\n// Info - Standard operational events\nlogger.info({ msg: "Plugin system initialized", successCount: 5, failedCount: 0 });\n\n// Debug - Detailed information for debugging\nlogger.debug({ msg: "Query executed", sql, params });\n'})}),"\n",(0,i.jsx)(n.h2,{id:"correlation-ids",children:"Correlation IDs"}),"\n",(0,i.jsx)(n.p,{children:"Every HTTP request is assigned a correlation ID that flows through the entire request lifecycle. This enables tracing logs across services."}),"\n",(0,i.jsx)(n.h3,{id:"how-it-works",children:"How It Works"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Fastify assigns a unique ID to each request (from ",(0,i.jsx)(n.code,{children:"x-correlation-id"})," header or auto-generated)"]}),"\n",(0,i.jsxs)(n.li,{children:["The ID is attached to the request logger via ",(0,i.jsx)(n.code,{children:"request.log"})]}),"\n",(0,i.jsx)(n.li,{children:"Pass this logger to downstream functions"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'// In route handlers - use request.log\nfastify.get("/api/data", async (request, reply) => {\n  request.log.info({ msg: "Processing request" }); // Includes correlationId\n});\n\n// In GraphQL context - logger is injected\nconst resolver = async (_, args, ctx) => {\n  ctx.log.info({ msg: "Resolver called", args });\n};\n'})}),"\n",(0,i.jsx)(n.h2,{id:"context-specific-logging",children:"Context-Specific Logging"}),"\n",(0,i.jsx)(n.h3,{id:"http-routes",children:"HTTP Routes"}),"\n",(0,i.jsxs)(n.p,{children:["In route handlers, use ",(0,i.jsx)(n.code,{children:"request.log"})," which automatically includes the correlation ID:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'fastify.post("/api/users", async (request, reply) => {\n  request.log.info({ msg: "Creating user" });\n  \n  try {\n    const user = await createUser(request.body);\n    request.log.info({ msg: "User created", userId: user.id });\n    return { user };\n  } catch (error) {\n    request.log.error({ msg: "User creation failed", err: error });\n    throw error;\n  }\n});\n'})}),"\n",(0,i.jsx)(n.h3,{id:"graphql-resolvers",children:"GraphQL Resolvers"}),"\n",(0,i.jsxs)(n.p,{children:["In GraphQL resolvers, use ",(0,i.jsx)(n.code,{children:"ctx.log"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'export const createPlugin = async (_, args, ctx) => {\n  ctx.log.info({ msg: "Installing plugin", pluginId: args.id });\n  // ...\n};\n'})}),"\n",(0,i.jsx)(n.h3,{id:"plugin-system",children:"Plugin System"}),"\n",(0,i.jsx)(n.p,{children:"The plugin context includes a logger. Use optional chaining since the logger might not be available:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'this.pluginContext.logger.info?.({\n  msg: "Plugin activated",\n  pluginId,\n});\n\nthis.pluginContext.logger.error?.({\n  msg: "Failed to load plugin",\n  pluginId,\n  err: error,\n});\n'})}),"\n",(0,i.jsx)(n.h3,{id:"background-workers",children:"Background Workers"}),"\n",(0,i.jsx)(n.p,{children:"Inject the logger into background workers:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'export async function startBackgroundWorker(deps: { logger: Logger }) {\n  const { logger } = deps;\n  \n  logger.info({ msg: "Background worker started" });\n  \n  // Use the injected logger for all operations\n  await processJob(logger);\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"utilities-outside-request-context",children:"Utilities (Outside Request Context)"}),"\n",(0,i.jsxs)(n.p,{children:["For utilities that don't have a request-scoped logger, use ",(0,i.jsx)(n.code,{children:"rootLogger"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'import { rootLogger } from "~/src/utilities/logging/logger";\n\nexport function someUtility() {\n  rootLogger.info({ msg: "Utility function called" });\n}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"what-not-to-do",children:"What NOT To Do"}),"\n",(0,i.jsx)(n.h3,{id:"never-use-console",children:"Never Use console.*"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'// \u274c FORBIDDEN - Will fail linting\nconsole.log("Debug:", data);\nconsole.error("Error:", error);\nconsole.warn("Warning");\n\n// \u2705 Use proper logger\nlogger.debug({ msg: "Debug", data });\nlogger.error({ msg: "Error", err: error });\nlogger.warn({ msg: "Warning" });\n'})}),"\n",(0,i.jsx)(n.h3,{id:"never-use-string-only-logging",children:"Never Use String-Only Logging"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'// \u274c WRONG - No structured data\nlogger.info("User created successfully");\n\n// \u2705 CORRECT - Include relevant context\nlogger.info({ msg: "User created successfully", userId: user.id });\n'})}),"\n",(0,i.jsx)(n.h3,{id:"never-log-sensitive-data",children:"Never Log Sensitive Data"}),"\n",(0,i.jsx)(n.p,{children:"The logger auto-redacts common sensitive fields, but be mindful:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'// \u274c WRONG - Logging sensitive data\nlogger.info({ msg: "Login attempt", password: req.body.password });\n\n// \u2705 CORRECT - Omit sensitive fields\nlogger.info({ msg: "Login attempt", email: req.body.email });\n'})}),"\n",(0,i.jsx)(n.h2,{id:"testing-with-mocked-loggers",children:"Testing with Mocked Loggers"}),"\n",(0,i.jsx)(n.p,{children:"When testing code that logs, mock the logger:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'function mockLogger() {\n  const base = {\n    info: vi.fn(),\n    warn: vi.fn(),\n    error: vi.fn(),\n    debug: vi.fn(),\n    child: vi.fn().mockImplementation(() => base),\n  };\n  return base;\n}\n\nit("logs when action occurs", async () => {\n  const logger = mockLogger();\n  await someFunction({ logger });\n  \n  expect(logger.info).toHaveBeenCalledWith(\n    expect.objectContaining({\n      msg: "Action completed",\n    })\n  );\n});\n'})}),"\n",(0,i.jsx)(n.h2,{id:"environment-configuration",children:"Environment Configuration"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Variable"}),(0,i.jsx)(n.th,{children:"Default"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"LOG_LEVEL"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"info"})}),(0,i.jsxs)(n.td,{children:["Minimum log level (",(0,i.jsx)(n.code,{children:"debug"}),", ",(0,i.jsx)(n.code,{children:"info"}),", ",(0,i.jsx)(n.code,{children:"warn"}),", ",(0,i.jsx)(n.code,{children:"error"}),")"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"NODE_ENV"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"development"})}),(0,i.jsx)(n.td,{children:"Pretty printing enabled in development"})]})]})]}),"\n",(0,i.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Import"}),": Use ",(0,i.jsx)(n.code,{children:"rootLogger"})," or injected loggers"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Format"}),": Always use ",(0,i.jsx)(n.code,{children:'{ msg: "...", ...fields }'})," structure"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Levels"}),": ",(0,i.jsx)(n.code,{children:"error"})," > ",(0,i.jsx)(n.code,{children:"warn"})," > ",(0,i.jsx)(n.code,{children:"info"})," > ",(0,i.jsx)(n.code,{children:"debug"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Context"}),": Include relevant IDs (",(0,i.jsx)(n.code,{children:"userId"}),", ",(0,i.jsx)(n.code,{children:"pluginId"}),", ",(0,i.jsx)(n.code,{children:"correlationId"}),")"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Errors"}),": Use ",(0,i.jsx)(n.code,{children:'{ msg: "...", err: error }'})," for error objects"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Never"}),": Use ",(0,i.jsx)(n.code,{children:"console.*"})," or log sensitive data"]}),"\n"]})]})}function g(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(a,{...e})}):a(e)}}}]);